(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function e(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(s){if(s.ep)return;s.ep=!0;const a=e(s);fetch(s.href,a)}})();const qt=class qt{constructor(t=0){t<1?(this._ptr=[],this._capacity=0,this._size=0):(this._ptr=new Array(t),this._capacity=t,this._size=0)}at(t){return this._ptr[t]}set(t,e){this._ptr[t]=e}get(t=0){const e=new Array;for(let i=t;i<this._size;i++)e.push(this._ptr[i]);return e}pushBack(t){this._size>=this._capacity&&this.prepareCapacity(this._capacity==0?qt.DefaultSize:this._capacity*2),this._ptr[this._size++]=t}clear(){this._ptr.length=0,this._size=0}getSize(){return this._size}assign(t,e){this._size<t&&this.prepareCapacity(t);for(let s=0;s<t;s++)this._ptr[s]=e;this._size=t}resize(t,e=null){this.updateSize(t,e,!0)}updateSize(t,e=null,i=!0){if(this._size<t)if(this.prepareCapacity(t),i)for(let a=this._size;a<t;a++)typeof e=="function"?this._ptr[a]=JSON.parse(JSON.stringify(new e)):this._ptr[a]=e;else for(let a=this._size;a<t;a++)this._ptr[a]=e;else{const a=this._size-t;this._ptr.splice(this._size-a,a)}this._size=t}insert(t,e,i){let s=t._index;const a=e._index,o=i._index,n=o-a;this.prepareCapacity(this._size+n);const l=this._size-s;if(l>0)for(let u=0;u<l;u++)this._ptr.splice(s+u,0,null);for(let u=a;u<o;u++,s++)this._ptr[s]=e._vector._ptr[u];this._size=this._size+n}remove(t){return t<0||this._size<=t?!1:(this._ptr.splice(t,1),--this._size,!0)}erase(t){const e=t._index;return e<0||this._size<=e?t:(this._ptr.splice(e,1),--this._size,new _e(this,e))}prepareCapacity(t){t>this._capacity&&(this._capacity==0?(this._ptr=new Array(t),this._capacity=t):(this._ptr.length=t,this._capacity=t))}begin(){return this._size==0?this.end():new _e(this,0)}end(){return new _e(this,this._size)}getOffset(t){const e=new qt;return e._ptr=this.get(t),e._size=this.get(t).length,e._capacity=this.get(t).length,e}};qt.DefaultSize=10;let y=qt,_e=class Ye{constructor(t,e){this._vector=t??null,this._index=e??0}set(t){return this._index=t._index,this._vector=t._vector,this}preIncrement(){return++this._index,this}preDecrement(){return--this._index,this}increment(){return new Ye(this._vector,this._index++)}decrement(){return new Ye(this._vector,this._index--)}ptr(){return this._vector._ptr[this._index]}substitution(t){return this._index=t._index,this._vector=t._vector,this}notEqual(t){return this._index!=t._index||this._vector!=t._vector}};var ui;(r=>{r.csmVector=y,r.iterator=_e})(ui||(ui={}));class A{append(t,e){return this.s+=e!==void 0?t.substr(0,e):t,this}expansion(t,e){for(let i=0;i<t;i++)this.append(e);return this}getBytes(){return encodeURIComponent(this.s).replace(/%../g,"x").length}getLength(){return this.s.length}isLess(t){return this.s<t.s}isGreat(t){return this.s>t.s}isEqual(t){return this.s==t}isEmpty(){return this.s.length==0}constructor(t){this.s=t}}var hi;(r=>{r.csmString=A})(hi||(hi={}));class kt{static createIdInternal(t){return new kt(t)}getString(){return this._id}isEqual(t){return typeof t=="string"?this._id.isEqual(t):t instanceof A?this._id.isEqual(t.s):t instanceof kt?this._id.isEqual(t._id.s):!1}isNotEqual(t){return typeof t=="string"?!this._id.isEqual(t):t instanceof A?!this._id.isEqual(t.s):t instanceof kt?!this._id.isEqual(t._id.s):!1}constructor(t){if(typeof t=="string"){this._id=new A(t);return}this._id=t}}var gi;(r=>{r.CubismId=kt})(gi||(gi={}));class Js{constructor(){this._ids=new y}release(){for(let t=0;t<this._ids.getSize();++t)this._ids.set(t,void 0);this._ids=null}registerIds(t){for(let e=0;e<t.length;e++)this.registerId(t[e])}registerId(t){let e=null;if(typeof t=="string"){if((e=this.findId(t))!=null)return e;e=kt.createIdInternal(t),this._ids.pushBack(e)}else return this.registerId(t.s);return e}getId(t){return this.registerId(t)}isExist(t){return typeof t=="string"?this.findId(t)!=null:this.isExist(t.s)}findId(t){for(let e=0;e<this._ids.getSize();++e)if(this._ids.at(e).getString().isEqual(t))return this._ids.at(e);return null}}var ci;(r=>{r.CubismIdManager=Js})(ci||(ci={}));class L{constructor(){this._tr=new Float32Array(16),this.loadIdentity()}static multiply(t,e,i){const s=new Float32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),a=4;for(let o=0;o<a;++o)for(let n=0;n<a;++n)for(let l=0;l<a;++l)s[n+o*4]+=t[l+o*4]*e[n+l*4];for(let o=0;o<16;++o)i[o]=s[o]}loadIdentity(){const t=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);this.setMatrix(t)}setMatrix(t){for(let e=0;e<16;++e)this._tr[e]=t[e]}getArray(){return this._tr}getScaleX(){return this._tr[0]}getScaleY(){return this._tr[5]}getTranslateX(){return this._tr[12]}getTranslateY(){return this._tr[13]}transformX(t){return this._tr[0]*t+this._tr[12]}transformY(t){return this._tr[5]*t+this._tr[13]}invertTransformX(t){return(t-this._tr[12])/this._tr[0]}invertTransformY(t){return(t-this._tr[13])/this._tr[5]}translateRelative(t,e){const i=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,t,e,0,1]);L.multiply(i,this._tr,this._tr)}translate(t,e){this._tr[12]=t,this._tr[13]=e}translateX(t){this._tr[12]=t}translateY(t){this._tr[13]=t}scaleRelative(t,e){const i=new Float32Array([t,0,0,0,0,e,0,0,0,0,1,0,0,0,0,1]);L.multiply(i,this._tr,this._tr)}scale(t,e){this._tr[0]=t,this._tr[5]=e}multiplyByMatrix(t){L.multiply(t.getArray(),this._tr,this._tr)}clone(){const t=new L;for(let e=0;e<this._tr.length;e++)t._tr[e]=this._tr[e];return t}}var di;(r=>{r.CubismMatrix44=L})(di||(di={}));class me{constructor(t,e,i,s){this.x=t,this.y=e,this.width=i,this.height=s}getCenterX(){return this.x+.5*this.width}getCenterY(){return this.y+.5*this.height}getRight(){return this.x+this.width}getBottom(){return this.y+this.height}setRect(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height}expand(t,e){this.x-=t,this.y-=e,this.width+=t*2,this.height+=e*2}}var _i;(r=>{r.csmRect=me})(_i||(_i={}));class ve{static create(){return null}static delete(t){}initialize(t){this._model=t}drawModel(){this.getModel()!=null&&(this.saveProfile(),this.doDrawModel(),this.restoreProfile())}setMvpMatrix(t){this._mvpMatrix4x4.setMatrix(t.getArray())}getMvpMatrix(){return this._mvpMatrix4x4}setModelColor(t,e,i,s){t<0?t=0:t>1&&(t=1),e<0?e=0:e>1&&(e=1),i<0?i=0:i>1&&(i=1),s<0?s=0:s>1&&(s=1),this._modelColor.r=t,this._modelColor.g=e,this._modelColor.b=i,this._modelColor.a=s}getModelColor(){return JSON.parse(JSON.stringify(this._modelColor))}getModelColorWithOpacity(t){const e=this.getModelColor();return e.a*=t,this.isPremultipliedAlpha()&&(e.r*=e.a,e.g*=e.a,e.b*=e.a),e}setIsPremultipliedAlpha(t){this._isPremultipliedAlpha=t}isPremultipliedAlpha(){return this._isPremultipliedAlpha}setIsCulling(t){this._isCulling=t}isCulling(){return this._isCulling}setAnisotropy(t){this._anisotropy=t}getAnisotropy(){return this._anisotropy}getModel(){return this._model}useHighPrecisionMask(t){this._useHighPrecisionMask=t}isUsingHighPrecisionMask(){return this._useHighPrecisionMask}constructor(){this._isCulling=!1,this._isPremultipliedAlpha=!1,this._anisotropy=0,this._model=null,this._modelColor=new j,this._useHighPrecisionMask=!1,this._mvpMatrix4x4=new L,this._mvpMatrix4x4.loadIdentity()}}var ct=(r=>(r[r.CubismBlendMode_Normal=0]="CubismBlendMode_Normal",r[r.CubismBlendMode_Additive=1]="CubismBlendMode_Additive",r[r.CubismBlendMode_Multiplicative=2]="CubismBlendMode_Multiplicative",r))(ct||{});class j{constructor(t=1,e=1,i=1,s=1){this.r=t,this.g=e,this.b=i,this.a=s}}class Ur{constructor(t,e){this._clippingIdList=t,this._clippingIdCount=e,this._allClippedDrawRect=new me,this._layoutBounds=new me,this._clippedDrawableIndexList=[],this._matrixForMask=new L,this._matrixForDraw=new L,this._bufferIndex=0}release(){this._layoutBounds!=null&&(this._layoutBounds=null),this._allClippedDrawRect!=null&&(this._allClippedDrawRect=null),this._clippedDrawableIndexList!=null&&(this._clippedDrawableIndexList=null)}addClippedDrawable(t){this._clippedDrawableIndexList.push(t)}}var mi;(r=>{r.CubismBlendMode=ct,r.CubismRenderer=ve,r.CubismTextureColor=j})(mi||(mi={}));const jr=(r,t,e)=>{ti.print(r,"[CSM]"+t,e)},ne=(r,t,e)=>{jr(r,t+`
`,e)},G=r=>{console.assert(r)};let Zt,F,D,P;Zt=(r,...t)=>{ne(Ct.LogLevel_Debug,"[D]"+r,t)},F=(r,...t)=>{ne(Ct.LogLevel_Info,"[I]"+r,t)},D=(r,...t)=>{ne(Ct.LogLevel_Warning,"[W]"+r,t)},P=(r,...t)=>{ne(Ct.LogLevel_Error,"[E]"+r,t)};class ti{static print(t,e,i){if(t<w.getLoggingLevel())return;const s=w.coreLogFunction;if(!s)return;const a=e.replace(/\{(\d+)\}/g,(o,n)=>i[n]);s(a)}static dumpBytes(t,e,i){for(let s=0;s<i;s++)s%16==0&&s>0?this.print(t,`
`):s%8==0&&s>0&&this.print(t,"  "),this.print(t,"{0} ",[e[s]&255]);this.print(t,`
`)}constructor(){}}var pi;(r=>{r.CubismDebug=ti})(pi||(pi={}));class Ks{constructor(t,e){this.first=t??null,this.second=e??null}}const Jt=class Jt{constructor(t){t!=null?t<1?(this._keyValues=[],this._dummyValue=null,this._size=0):(this._keyValues=new Array(t),this._size=t):(this._keyValues=[],this._dummyValue=null,this._size=0)}release(){this.clear()}appendKey(t){this.prepareCapacity(this._size+1,!1),this._keyValues[this._size]=new Ks(t),this._size+=1}getValue(t){let e=-1;for(let i=0;i<this._size;i++)if(this._keyValues[i].first==t){e=i;break}return e>=0?this._keyValues[e].second:(this.appendKey(t),this._keyValues[this._size-1].second)}setValue(t,e){let i=-1;for(let s=0;s<this._size;s++)if(this._keyValues[s].first==t){i=s;break}i>=0?this._keyValues[i].second=e:(this.appendKey(t),this._keyValues[this._size-1].second=e)}isExist(t){for(let e=0;e<this._size;e++)if(this._keyValues[e].first==t)return!0;return!1}clear(){this._keyValues=void 0,this._keyValues=null,this._keyValues=[],this._size=0}getSize(){return this._size}prepareCapacity(t,e){t>this._keyValues.length&&(this._keyValues.length==0?(!e&&t<Jt.DefaultSize&&(t=Jt.DefaultSize),this._keyValues.length=t):(!e&&t<this._keyValues.length*2&&(t=this._keyValues.length*2),this._keyValues.length=t))}begin(){return new Mt(this,0)}end(){return new Mt(this,this._size)}erase(t){const e=t._index;return e<0||this._size<=e?t:(this._keyValues.splice(e,1),--this._size,new Mt(this,e))}dumpAsInt(){for(let t=0;t<this._size;t++)Zt("{0} ,",this._keyValues[t]),Zt(`
`)}};Jt.DefaultSize=10;let H=Jt;class Mt{constructor(t,e){this._map=t??new H,this._index=e??0}set(t){return this._index=t._index,this._map=t._map,this}preIncrement(){return++this._index,this}preDecrement(){return--this._index,this}increment(){return new Mt(this._map,this._index++)}decrement(){const t=new Mt(this._map,this._index);return this._map=t._map,this._index=t._index,this}ptr(){return this._map._keyValues[this._index]}notEqual(t){return this._index!=t._index||this._map!=t._map}}var fi;(r=>{r.csmMap=H,r.csmPair=Ks,r.iterator=Mt})(fi||(fi={}));class pe{static parseJsonObject(t,e){return Object.keys(t).forEach(i=>{if(typeof t[i]=="boolean"){const s=!!t[i];e.put(i,new K(s))}else if(typeof t[i]=="string"){const s=String(t[i]);e.put(i,new Ut(s))}else if(typeof t[i]=="number"){const s=Number(t[i]);e.put(i,new ye(s))}else t[i]instanceof Array?e.put(i,pe.parseJsonArray(t[i])):t[i]instanceof Object?e.put(i,pe.parseJsonObject(t[i],new Nt)):t[i]==null?e.put(i,new Ot):e.put(i,t[i])}),e}static parseJsonArray(t){const e=new ei;return Object.keys(t).forEach(i=>{if(typeof Number(i)=="number")if(typeof t[i]=="boolean"){const a=!!t[i];e.add(new K(a))}else if(typeof t[i]=="string"){const a=String(t[i]);e.add(new Ut(a))}else if(typeof t[i]=="number"){const a=Number(t[i]);e.add(new ye(a))}else t[i]instanceof Array?e.add(this.parseJsonArray(t[i])):t[i]instanceof Object?e.add(this.parseJsonObject(t[i],new Nt)):t[i]==null?e.add(new Ot):e.add(t[i]);else if(t[i]instanceof Array)e.add(this.parseJsonArray(t[i]));else if(t[i]instanceof Object)e.add(this.parseJsonObject(t[i],new Nt));else if(t[i]==null)e.add(new Ot);else{const a=Array(t[i]);for(let o=0;o<a.length;o++)e.add(a[o])}}),e}}const fe="Error: type mismatch",Xr="Error: index out of bounds";let U=class et{constructor(){}getRawString(t,e){return this.getString(t,e)}toInt(t=0){return t}toFloat(t=0){return t}toBoolean(t=!1){return t}getSize(){return 0}getArray(t=null){return t}getVector(t=new y){return t}getMap(t){return t}getValueByIndex(t){return et.errorValue.setErrorNotForClientCall(fe)}getValueByString(t){return et.nullValue.setErrorNotForClientCall(fe)}getKeys(){return et.dummyKeys}isError(){return!1}isNull(){return!1}isBool(){return!1}isFloat(){return!1}isString(){return!1}isArray(){return!1}isMap(){return!1}equals(t){return!1}isStatic(){return!1}setErrorNotForClientCall(t){return Qt.errorValue}static staticInitializeNotForClientCall(){K.trueValue=new K(!0),K.falseValue=new K(!1),et.errorValue=new Qt("ERROR",!0),et.nullValue=new Ot,et.dummyKeys=new y}static staticReleaseNotForClientCall(){K.trueValue=null,K.falseValue=null,et.errorValue=null,et.nullValue=null,et.dummyKeys=null}};class N{constructor(t,e){this._parseCallback=pe.parseJsonObject,this._error=null,this._lineCount=0,this._root=null,t!=null&&this.parseBytes(t,e,this._parseCallback)}static create(t,e){const i=new N;return i.parseBytes(t,e,i._parseCallback)?i:(N.delete(i),null)}static delete(t){}getRoot(){return this._root}static arrayBufferToString(t){const e=new Uint8Array(t);let i="";for(let s=0,a=e.length;s<a;++s)i+="%"+this.pad(e[s].toString(16));return i=decodeURIComponent(i),i}static pad(t){return t.length<2?"0"+t:t}parseBytes(t,e,i){const s=new Array(1),a=N.arrayBufferToString(t);if(i==null?this._root=this.parseValue(a,e,0,s):this._root=i(JSON.parse(a),new Nt),this._error){let o="\0";return o="Json parse error : @line "+(this._lineCount+1)+`
`,this._root=new Ut(o),F("{0}",this._root.getRawString()),!1}else if(this._root==null)return this._root=new Qt(new A(this._error),!1),!1;return!0}getParseError(){return this._error}checkEndOfFile(){return this._root.getArray()[1].equals("EOF")}parseValue(t,e,i,s){if(this._error)return null;let a=null,o=i,n;for(;o<e;o++)switch(t[o]){case"-":case".":case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":{const u=new Array(1);return n=Yr(t.slice(o),u),s[0]=t.indexOf(u[0]),new ye(n)}case'"':return new Ut(this.parseString(t,e,o+1,s));case"[":return a=this.parseArray(t,e,o+1,s),a;case"{":return a=this.parseObject(t,e,o+1,s),a;case"n":return o+3<e?(a=new Ot,s[0]=o+4):this._error="parse null",a;case"t":return o+3<e?(a=K.trueValue,s[0]=o+4):this._error="parse true",a;case"f":return o+4<e?(a=K.falseValue,s[0]=o+5):this._error="illegal ',' position",a;case",":return this._error="illegal ',' position",null;case"]":return s[0]=o,null;case`
`:this._lineCount++}return this._error="illegal end of value",null}parseString(t,e,i,s){if(this._error)return null;if(!t)return this._error="string is null",null;let a=i,o,n;const l=new A("");let u=i;for(;a<e;a++)switch(o=t[a],o){case'"':return s[0]=a+1,l.append(t.slice(u),a-u),l.s;case"//":if(a++,a-1>u&&l.append(t.slice(u),a-u),u=a+1,a<e)switch(n=t[a],n){case"\\":l.expansion(1,"\\");break;case'"':l.expansion(1,'"');break;case"/":l.expansion(1,"/");break;case"b":l.expansion(1,"\b");break;case"f":l.expansion(1,"\f");break;case"n":l.expansion(1,`
`);break;case"r":l.expansion(1,"\r");break;case"t":l.expansion(1,"	");break;case"u":this._error="parse string/unicord escape not supported";break}else this._error="parse string/escape error"}return this._error="parse string/illegal end",null}parseObject(t,e,i,s){if(this._error)return null;if(!t)return this._error="buffer is null",null;const a=new Nt;let o="",n=i,l="";const u=Array(1);let h=!1;for(;n<e;n++){t:for(;n<e;n++)switch(l=t[n],l){case'"':if(o=this.parseString(t,e,n+1,u),this._error)return null;n=u[0],h=!0;break t;case"}":return s[0]=n+1,a;case":":this._error="illegal ':' position";break;case`
`:this._lineCount++}if(!h)return this._error="key not found",null;h=!1;t:for(;n<e;n++)switch(l=t[n],l){case":":h=!0,n++;break t;case"}":this._error="illegal '}' position";break;case`
`:this._lineCount++}if(!h)return this._error="':' not found",null;const g=this.parseValue(t,e,n,u);if(this._error)return null;n=u[0],a.put(o,g);t:for(;n<e;n++)switch(l=t[n],l){case",":break t;case"}":return s[0]=n+1,a;case`
`:this._lineCount++}}return this._error="illegal end of perseObject",null}parseArray(t,e,i,s){if(this._error)return null;if(!t)return this._error="buffer is null",null;let a=new ei,o=i,n;const l=new Array(1);for(;o<e;o++){const u=this.parseValue(t,e,o,l);if(this._error)return null;o=l[0],u&&a.add(u);t:for(;o<e;o++)switch(n=t[o],n){case",":break t;case"]":return s[0]=o+1,a;case`
`:++this._lineCount}}return a=void 0,this._error="illegal end of parseObject",null}}class ye extends U{constructor(t){super(),this._value=t}isFloat(){return!0}getString(t,e){const i="\0";return this._value=parseFloat(i),this._stringBuffer=i,this._stringBuffer}toInt(t=0){return parseInt(this._value.toString())}toFloat(t=0){return this._value}equals(t){return typeof t=="number"?Math.round(t)?!1:t==this._value:!1}}class K extends U{isBool(){return!0}toBoolean(t=!1){return this._boolValue}getString(t,e){return this._stringBuffer=this._boolValue?"true":"false",this._stringBuffer}equals(t){return typeof t=="boolean"?t==this._boolValue:!1}isStatic(){return!0}constructor(t){super(),this._boolValue=t}}class Ut extends U{constructor(t){super(),typeof t=="string"&&(this._stringBuffer=t),t instanceof A&&(this._stringBuffer=t.s)}isString(){return!0}getString(t,e){return this._stringBuffer}equals(t){return typeof t=="string"?this._stringBuffer==t:t instanceof A?this._stringBuffer==t.s:!1}}class Qt extends Ut{isStatic(){return this._isStatic}setErrorNotForClientCall(t){return this._stringBuffer=t,this}constructor(t,e){typeof t=="string"?super(t):super(t),this._isStatic=e}isError(){return!0}}class Ot extends U{isNull(){return!0}getString(t,e){return this._stringBuffer}isStatic(){return!0}setErrorNotForClientCall(t){return this._stringBuffer=t,Qt.nullValue}constructor(){super(),this._stringBuffer="NullValue"}}class ei extends U{constructor(){super(),this._array=new y}release(){for(let t=this._array.begin();t.notEqual(this._array.end());t.preIncrement()){let e=t.ptr();e&&!e.isStatic()&&(e=void 0,e=null)}}isArray(){return!0}getValueByIndex(t){if(t<0||this._array.getSize()<=t)return U.errorValue.setErrorNotForClientCall(Xr);const e=this._array.at(t);return e??U.nullValue}getValueByString(t){return U.errorValue.setErrorNotForClientCall(fe)}getString(t,e){const i=e+`[
`;for(let s=this._array.begin();s.notEqual(this._array.end());s.increment()){const a=s.ptr();this._stringBuffer+=e+""+a.getString(e+" ")+`
`}return this._stringBuffer=i+e+`]
`,this._stringBuffer}add(t){this._array.pushBack(t)}getVector(t=null){return this._array}getSize(){return this._array.getSize()}}class Nt extends U{constructor(){super(),this._map=new H}release(){const t=this._map.begin();for(;t.notEqual(this._map.end());){let e=t.ptr().second;e&&!e.isStatic()&&(e=void 0,e=null),t.preIncrement()}}isMap(){return!0}getValueByString(t){if(t instanceof A){const e=this._map.getValue(t.s);return e??U.nullValue}for(let e=this._map.begin();e.notEqual(this._map.end());e.preIncrement())if(e.ptr().first==t)return e.ptr().second==null?U.nullValue:e.ptr().second;return U.nullValue}getValueByIndex(t){return U.errorValue.setErrorNotForClientCall(fe)}getString(t,e){this._stringBuffer=e+`{
`;const i=this._map.begin();for(;i.notEqual(this._map.end());){const s=i.ptr().first,a=i.ptr().second;this._stringBuffer+=e+" "+s+" : "+a.getString(e+"   ")+` 
`,i.preIncrement()}return this._stringBuffer+=e+`}
`,this._stringBuffer}getMap(t){return this._map}put(t,e){this._map.setValue(t,e)}getKeys(){if(!this._keys){this._keys=new y;const t=this._map.begin();for(;t.notEqual(this._map.end());){const e=t.ptr().first;this._keys.pushBack(e),t.preIncrement()}}return this._keys}getSize(){return this._keys.getSize()}}var yi;(r=>{r.CubismJson=N,r.JsonArray=ei,r.JsonBoolean=K,r.JsonError=Qt,r.JsonFloat=ye,r.JsonMap=Nt,r.JsonNullvalue=Ot,r.JsonString=Ut,r.Value=U})(yi||(yi={}));function Yr(r,t){let e=0;for(let s=1;;s++){const a=r.slice(s-1,s);if(a=="e"||a=="-"||a=="E")continue;const o=r.substring(0,s),n=Number(o);if(isNaN(n))break;e=s}let i=parseFloat(r);return isNaN(i)&&(i=NaN),t[0]=r.slice(e),i}let W=!1,Pt=!1,Vt=null,Yt=null;const ht=Object.freeze({vertexOffset:0,vertexStep:2});function Ht(r){r&&(r=void 0)}class w{static startUp(t=null){if(W)return F("CubismFramework.startUp() is already done."),W;if(Vt=t,Vt!=null&&Live2DCubismCore.Logging.csmSetLogFunction(Vt.logFunction),W=!0,W){const e=Live2DCubismCore.Version.csmGetVersion(),i=(e&4278190080)>>24,s=(e&16711680)>>16,a=e&65535,o=e;F("Live2D Cubism Core version: {0}.{1}.{2} ({3})",("00"+i).slice(-2),("00"+s).slice(-2),("0000"+a).slice(-4),o)}return F("CubismFramework.startUp() is complete."),W}static cleanUp(){W=!1,Pt=!1,Vt=null,Yt=null}static initialize(t=0){if(G(W),!W){D("CubismFramework is not started.");return}if(Pt){D("CubismFramework.initialize() skipped, already initialized.");return}U.staticInitializeNotForClientCall(),Yt=new Js,Live2DCubismCore.Memory.initializeAmountOfMemory(t),Pt=!0,F("CubismFramework.initialize() is complete.")}static dispose(){if(G(W),!W){D("CubismFramework is not started.");return}if(!Pt){D("CubismFramework.dispose() skipped, not initialized.");return}U.staticReleaseNotForClientCall(),Yt.release(),Yt=null,ve.staticRelease(),Pt=!1,F("CubismFramework.dispose() is complete.")}static isStarted(){return W}static isInitialized(){return Pt}static coreLogFunction(t){Live2DCubismCore.Logging.csmGetLogFunction()&&Live2DCubismCore.Logging.csmGetLogFunction()(t)}static getLoggingLevel(){return Vt!=null?Vt.loggingLevel:5}static getIdManager(){return Yt}constructor(){}}class Gr{}var Ct=(r=>(r[r.LogLevel_Verbose=0]="LogLevel_Verbose",r[r.LogLevel_Debug=1]="LogLevel_Debug",r[r.LogLevel_Info=2]="LogLevel_Info",r[r.LogLevel_Warning=3]="LogLevel_Warning",r[r.LogLevel_Error=4]="LogLevel_Error",r[r.LogLevel_Off=5]="LogLevel_Off",r))(Ct||{}),Si;(r=>{r.Constant=ht,r.csmDelete=Ht,r.CubismFramework=w})(Si||(Si={}));const Ci=1,$r=2,Hr=.8,Wr=-1,qr=1,Jr=-2,Kr=2,Zr=-2,Qr=2,ta="../../Resources/",ea="back_class_normal.png",ia="icon_gear.png",xi=Ct.LogLevel_Verbose,Lt=class Lt{static loadFileAsBytes(t,e){fetch(t).then(i=>i.arrayBuffer()).then(i=>e(i,i.byteLength))}static getDeltaTime(){return this.s_deltaTime}static updateTime(){this.s_currentFrame=Date.now(),this.s_deltaTime=(this.s_currentFrame-this.s_lastFrame)/1e3,this.s_lastFrame=this.s_currentFrame}static printMessage(t){console.log(t)}};Lt.lastUpdate=Date.now(),Lt.s_currentFrame=0,Lt.s_lastFrame=0,Lt.s_deltaTime=0;let k=Lt,E=null,_=null,It=null;class ii{static getInstance(){return It==null&&(It=new ii),It}static releaseInstance(){It!=null&&It.release(),It=null}constructor(){E=document.createElement("canvas"),_=E.getContext("webgl2"),_||(alert("Cannot initialize WebGL. This browser does not support."),_=null,document.body.innerHTML="This browser does not support the <code>&lt;canvas&gt;</code> element.")}release(){}}class sa{constructor(){this._textures=new y}release(){for(let t=this._textures.begin();t.notEqual(this._textures.end());t.preIncrement())_.deleteTexture(t.ptr().id);this._textures=null}createTextureFromPngFile(t,e,i){for(let a=this._textures.begin();a.notEqual(this._textures.end());a.preIncrement())if(a.ptr().fileName==t&&a.ptr().usePremultply==e){a.ptr().img=new Image,a.ptr().img.addEventListener("load",()=>i(a.ptr()),{passive:!0}),a.ptr().img.src=t;return}const s=new Image;s.addEventListener("load",()=>{const a=_.createTexture();_.bindTexture(_.TEXTURE_2D,a),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,_.LINEAR_MIPMAP_LINEAR),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,_.LINEAR),e&&_.pixelStorei(_.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),_.texImage2D(_.TEXTURE_2D,0,_.RGBA,_.RGBA,_.UNSIGNED_BYTE,s),_.generateMipmap(_.TEXTURE_2D),_.bindTexture(_.TEXTURE_2D,null);const o=new ra;o!=null&&(o.fileName=t,o.width=s.width,o.height=s.height,o.id=a,o.img=s,o.usePremultply=e,this._textures.pushBack(o)),i(o)},{passive:!0}),s.src=t}releaseTextures(){for(let t=0;t<this._textures.getSize();t++)this._textures.set(t,null);this._textures.clear()}releaseTextureByTexture(t){for(let e=0;e<this._textures.getSize();e++)if(this._textures.at(e).id==t){this._textures.set(e,null),this._textures.remove(e);break}}releaseTextureByFilePath(t){for(let e=0;e<this._textures.getSize();e++)if(this._textures.at(e).fileName==t){this._textures.set(e,null),this._textures.remove(e);break}}}class ra{constructor(){this.id=null,this.width=0,this.height=0}}class x{constructor(t,e){this.x=t,this.y=e,this.x=t??0,this.y=e??0}add(t){const e=new x(0,0);return e.x=this.x+t.x,e.y=this.y+t.y,e}substract(t){const e=new x(0,0);return e.x=this.x-t.x,e.y=this.y-t.y,e}multiply(t){const e=new x(0,0);return e.x=this.x*t.x,e.y=this.y*t.y,e}multiplyByScaler(t){return this.multiply(new x(t,t))}division(t){const e=new x(0,0);return e.x=this.x/t.x,e.y=this.y/t.y,e}divisionByScalar(t){return this.division(new x(t,t))}getLength(){return Math.sqrt(this.x*this.x+this.y*this.y)}getDistanceWith(t){return Math.sqrt((this.x-t.x)*(this.x-t.x)+(this.y-t.y)*(this.y-t.y))}dot(t){return this.x*t.x+this.y*t.y}normalize(){const t=Math.pow(this.x*this.x+this.y*this.y,.5);this.x=this.x/t,this.y=this.y/t}isEqual(t){return this.x==t.x&&this.y==t.y}isNotEqual(t){return!this.isEqual(t)}}var Mi;(r=>{r.CubismVector2=x})(Mi||(Mi={}));const Dt=class Dt{static range(t,e,i){return t<e?t=e:t>i&&(t=i),t}static sin(t){return Math.sin(t)}static cos(t){return Math.cos(t)}static abs(t){return Math.abs(t)}static sqrt(t){return Math.sqrt(t)}static cbrt(t){if(t===0)return t;let e=t;const i=e<0;i&&(e=-e);let s;return e===1/0?s=1/0:(s=Math.exp(Math.log(e)/3),s=(e/(s*s)+2*s)/3),i?-s:s}static getEasingSine(t){return t<0?0:t>1?1:.5-.5*this.cos(t*Math.PI)}static max(t,e){return t>e?t:e}static min(t,e){return t>e?e:t}static degreesToRadian(t){return t/180*Math.PI}static radianToDegrees(t){return t*180/Math.PI}static directionToRadian(t,e){const i=Math.atan2(e.y,e.x),s=Math.atan2(t.y,t.x);let a=i-s;for(;a<-Math.PI;)a+=Math.PI*2;for(;a>Math.PI;)a-=Math.PI*2;return a}static directionToDegrees(t,e){const i=this.directionToRadian(t,e);let s=this.radianToDegrees(i);return e.x-t.x>0&&(s=-s),s}static radianToDirection(t){const e=new x;return e.x=this.sin(t),e.y=this.cos(t),e}static quadraticEquation(t,e,i){return this.abs(t)<Dt.Epsilon?this.abs(e)<Dt.Epsilon?-i:-i/e:-(e+this.sqrt(e*e-4*t*i))/(2*t)}static cardanoAlgorithmForBezier(t,e,i,s){if(this.sqrt(t)<Dt.Epsilon)return this.range(this.quadraticEquation(e,i,s),0,1);const a=e/t,o=i/t,n=s/t,l=(3*o-a*a)/3,u=l/3,h=(2*a*a*a-9*a*o+27*n)/27,g=h/2,p=g*g+u*u*u,d=.5,c=d+.01;if(p<0){const v=-l/3,B=v*v*v,V=this.sqrt(B),b=-h/(2*V),O=this.range(b,-1,1),Z=Math.acos(O),Bt=2*this.cbrt(V),bt=Bt*this.cos(Z/3)-a/3;if(this.abs(bt-d)<c)return this.range(bt,0,1);const Xt=Bt*this.cos((Z+2*Math.PI)/3)-a/3;if(this.abs(Xt-d)<c)return this.range(Xt,0,1);const zr=Bt*this.cos((Z+4*Math.PI)/3)-a/3;return this.range(zr,0,1)}if(p==0){let v;g<0?v=this.cbrt(-g):v=-this.cbrt(g);const B=2*v-a/3;if(this.abs(B-d)<c)return this.range(B,0,1);const V=-v-a/3;return this.range(V,0,1)}const f=this.sqrt(p),m=this.cbrt(f-g),C=this.cbrt(f+g),S=m-C-a/3;return this.range(S,0,1)}static mod(t,e){if(!isFinite(t)||e===0||isNaN(t)||isNaN(e))return console.warn(`divided: ${t}, divisor: ${e} mod() returns 'NaN'.`),NaN;const i=Math.abs(t),s=Math.abs(e);let a=i-Math.floor(i/s)*s;return a*=Math.sign(t),a}constructor(){}};Dt.Epsilon=1e-5;let M=Dt;var vi;(r=>{r.CubismMath=M})(vi||(vi={}));const wt=Live2DCubismMotionSyncCore.ToPointer,Ge=6;class Zs{constructor(t,e,i,s,a){t.getLength()==0&&P("The audio parameter ID is null."),e.getSize()==0&&P("The array length of IDs differs from the array length of parameter values. Please make them the same"),i.getSize()==0&&P("The model parameter ID array or the model parameter value array length is 0."),.1<=s&&s<=10||P("The value of scale is incorrect. The value is limited to between 0.1 and 10.0."),this._audioParameterId=t,this._modelParameterIds=e,this._modelParameterValues=i,this._scale=s,this._enabled=Number(a)}toNativeArray(t){if(!t&&this._nativeArray)return this._nativeArray;this._nativeArray&&this.releaseNativeArray(),this._nativeArray=new Float32Array(Ge),this._nativeArrayPtr=wt.Malloc(this._nativeArray.length*this._nativeArray.BYTES_PER_ELEMENT);const e=new Array,i=new Array;for(let s=0;s<this._modelParameterIds.getSize();s++)e.push(this._modelParameterIds.at(s).s),i.push(this._modelParameterValues.at(s));return this._nativeArray=wt.ConvertMappingInfoCriToFloat32Array(this._nativeArray,this._nativeArrayPtr,this._audioParameterId.s,e,i,this._modelParameterIds.getSize(),this._scale,this._enabled),this._nativeArray}releaseNativeArray(){this.deallocNativeArrayPtr(),this._nativeArray=void 0}getAudioParameterId(){return this._audioParameterId}getModelParameterIds(){return this._modelParameterIds}getModelParameterValues(){return this._modelParameterValues}getScale(){return this._scale}getEnabled(){return this._enabled}deallocNativeArrayPtr(){wt.Free(this._nativeArray[0]),wt.Free(this._nativeArray[1]),wt.Free(this._nativeArray[2]),wt.Free(this._nativeArrayPtr),this._nativeArrayPtr=0}}var Bi;(r=>{r.CubismMotionSyncEngineMappingInfo=Zs})(Bi||(Bi={}));const Ie=Live2DCubismMotionSyncCore.ToPointer;var at=(r=>(r[r.EngineType_Cri=0]="EngineType_Cri",r[r.EngineType_Unknown=1]="EngineType_Unknown",r))(at||{});class aa{static fmod(t,e){return Number((t-Math.floor(t/e)*e).toPrecision(8))}}class Qs{release(){this.deleteMappingInfoList()}setJObject(t){this.deleteMappingInfoList(),this._infoBufferList=new y,this.ConvertObjectToNative(t)}ConvertObjectToNative(t){const e=t.getSize();for(let s=0;s<e;s++)this._infoBufferList.pushBack(t.at(s).toNativeArray(!0));let i=Ie.Malloc(this._infoBufferList.at(0).length*e*this._infoBufferList.at(0).BYTES_PER_ELEMENT);this._mappingInfoListFirstPtr=i;for(let s=0;s<e;s++){for(let a=0;a<Ge;a++)a==4?Ie.AddValuePtrFloat(i,a*Float32Array.BYTES_PER_ELEMENT,this._infoBufferList.at(s)[a]):Ie.AddValuePtrInt32(i,a*Float32Array.BYTES_PER_ELEMENT,this._infoBufferList.at(s)[a]);i+=Ge*Float32Array.BYTES_PER_ELEMENT}}deleteMappingInfoList(){this._infoBufferList&&(this._infoBufferList.clear(),this._infoBufferList=void 0,this._infoBufferList=null)}getMappingInfoListPtr(){return this._mappingInfoListFirstPtr}}class tr{constructor(t,e,i){this._context=t,this._mapper=e,this._cubismParameterCount=i}release(){var t,e;(t=this._context)==null||t.csmMotionSyncDelete(),this._context=void 0,this._context=null,(e=this._mapper)==null||e.release(),this._mapper=void 0,this._mapper=null,this._cubismParameterCount=0}getContext(){return this._context}getMapper(){return this._mapper}getCubismParameterCount(){return this._cubismParameterCount}}var bi;(r=>{r.MotionSyncUtil=aa,r.MotionSyncContext=tr,r.MappingInfoListMapper=Qs})(bi||(bi={}));const na="Version",we="Meta",oa="SettingCount",Pi="Dictionary",Tt="Id",Te="Name",R="Settings",la="AnalysisType",ua="UseCase",dt="CubismParameters",Vi="Min",Ii="Max",ha="Damper",ga="Smooth",_t="AudioParameters",ca="Scale",da="Enabled",oe="Mappings",_a="Type",wi="Targets",ma="Value",Fe="PostProcessing",pa="BlendRatio",fa="Smoothing",ya="SampleRate";class er{constructor(t,e){this._json=N.create(t,e)}release(){N.delete(this._json)}getVersion(){return this._json.getRoot().getValueByString(na).toInt()}getMeta(){let t=null;t=new Ca,t.settingCount=this.getSettingCount(),t.dictionary=new y;for(let e=0;e<t.settingCount;e++)t.dictionary.pushBack(this.getMetaDictionaryItem(e));return t}getMetaDictionaryItem(t){const e=new Sa;return e.id=new A(this.getIdFromMeta(t)),e.name=new A(this.getName(t)),e}getSettingCount(){return this._json.getRoot().getValueByString(we).getValueByString(oa).toInt()}getIdFromMeta(t){return this._json.getRoot().getValueByString(we).getValueByString(Pi).getValueByIndex(t).getValueByString(Tt).getString()}getName(t){return this._json.getRoot().getValueByString(we).getValueByString(Pi).getValueByIndex(t).getValueByString(Te).getString()}getSetting(t){const e=new ba;switch(e.id=new A(this.getIdFromSettings(t)),this.getAnalysisType(t)){case"CRI":e.analysisType=at.EngineType_Cri;break;default:D("Unknown Settings.AnalysisType."),e.analysisType=at.EngineType_Unknown;break}switch(this.getUseCase(t)){case"Mouth":e.useCase=$e.UseCase_Mouth;break;default:D("Unknown Settings.UseCase."),e.useCase=$e.UseCase_Unknown;break}const a=this._json.getRoot().getValueByString(R).getValueByIndex(t).getValueByString(dt).getSize();e.cubismParameterList=new y;for(let n=0;n<a;n++)e.cubismParameterList.pushBack(this.getCubismParametarsElement(t,n));const o=this._json.getRoot().getValueByString(R).getValueByIndex(t).getValueByString(_t).getSize();e.audioParameterList=new y;for(let n=0;n<o;n++)e.audioParameterList.pushBack(this.getAudioParametersElement(t,n));e.mappingList=new y;for(let n=0;n<o;n++)e.mappingList.pushBack(this.getMappingsElement(t,n,a));return e.blendRatio=this.getBlendRatio(t),e.smoothing=this.getSmoothingFromPostProcessing(t),e.sampleRate=this.getSampleRate(t),e}getIdFromSettings(t){return this._json.getRoot().getValueByString(R).getValueByIndex(t).getValueByString(Tt).getString()}getAnalysisType(t){return this._json.getRoot().getValueByString(R).getValueByIndex(t).getValueByString(la).getString()}getUseCase(t){return this._json.getRoot().getValueByString(R).getValueByIndex(t).getValueByString(ua).getString()}getCubismParametarsElement(t,e){const i=new xa;return i.name=new A(this.getNameFromCubismParameters(t,e)),i.id=new A(this.getIdFromCubismParameters(t,e)),i.min=this.getMinFromCubismParameters(t,e),i.max=this.getMaxFromCubismParameters(t,e),i.damper=this.getDamperFromCubismParameters(t,e),i.smooth=this.getSmoothFromCubismParameters(t,e),i}getNameFromCubismParameters(t,e){return this._json.getRoot().getValueByString(R).getValueByIndex(t).getValueByString(dt).getValueByIndex(e).getValueByString(Te).getString()}getIdFromCubismParameters(t,e){return this._json.getRoot().getValueByString(R).getValueByIndex(t).getValueByString(dt).getValueByIndex(e).getValueByString(Tt).getString()}getMinFromCubismParameters(t,e){return this._json.getRoot().getValueByString(R).getValueByIndex(t).getValueByString(dt).getValueByIndex(e).getValueByString(Vi).toFloat()}getMaxFromCubismParameters(t,e){return this._json.getRoot().getValueByString(R).getValueByIndex(t).getValueByString(dt).getValueByIndex(e).getValueByString(Ii).toFloat()}getDamperFromCubismParameters(t,e){return this._json.getRoot().getValueByString(R).getValueByIndex(t).getValueByString(dt).getValueByIndex(e).getValueByString(ha).toFloat()}getSmoothFromCubismParameters(t,e){return this._json.getRoot().getValueByString(R).getValueByIndex(t).getValueByString(dt).getValueByIndex(e).getValueByString(ga).toFloat()}getAudioParametersElement(t,e){const i=new Ma;return i.name=new A(this.getNameFromAudioParameters(t,e)),i.id=new A(this.getIdFromAudioParameters(t,e)),i.min=this.getMinFromAudioParameters(t,e),i.max=this.getMaxFromAudioParameters(t,e),i.scale=this.getScaleFromAudioParameters(t,e),i.enabled=this.getEnabledFromAudioParameters(t,e),i}getNameFromAudioParameters(t,e){return this._json.getRoot().getValueByString(R).getValueByIndex(t).getValueByString(_t).getValueByIndex(e).getValueByString(Te).getString()}getIdFromAudioParameters(t,e){return this._json.getRoot().getValueByString(R).getValueByIndex(t).getValueByString(_t).getValueByIndex(e).getValueByString(Tt).getString()}getMinFromAudioParameters(t,e){return this._json.getRoot().getValueByString(R).getValueByIndex(t).getValueByString(_t).getValueByIndex(e).getValueByString(Vi).toFloat()}getMaxFromAudioParameters(t,e){return this._json.getRoot().getValueByString(R).getValueByIndex(t).getValueByString(_t).getValueByIndex(e).getValueByString(Ii).toFloat()}getScaleFromAudioParameters(t,e){return this._json.getRoot().getValueByString(R).getValueByIndex(t).getValueByString(_t).getValueByIndex(e).getValueByString(ca).toFloat()}getEnabledFromAudioParameters(t,e){return this._json.getRoot().getValueByString(R).getValueByIndex(t).getValueByString(_t).getValueByIndex(e).getValueByString(da).toBoolean()}getMappingsElement(t,e,i){const s=new Ba;switch(this.getMappingType(t,e)){case"Shape":s.type=He.MappingType_Shape;break;default:D("Unknown Mappings.Type."),s.type=He.MappingType_Unknown;break}s.audioId=new A(this.getAudioParamIdFromMappings(t,e)),s.targetList=new y;for(let o=0;o<i;o++)s.targetList.pushBack(this.getMappingTargetsElement(t,e,o));return s}getMappingTargetsElement(t,e,i){const s=new va;return s.id=new A(this.getCubismIdFromMappingTarget(t,e,i)),s.value=this.getValueFromMappingTarget(t,e,i),s}getMappingType(t,e){return this._json.getRoot().getValueByString(R).getValueByIndex(t).getValueByString(oe).getValueByIndex(e).getValueByString(_a).getString()}getAudioParamIdFromMappings(t,e){return this._json.getRoot().getValueByString(R).getValueByIndex(t).getValueByString(oe).getValueByIndex(e).getValueByString(Tt).getString()}getCubismIdFromMappingTarget(t,e,i){return this._json.getRoot().getValueByString(R).getValueByIndex(t).getValueByString(oe).getValueByIndex(e).getValueByString(wi).getValueByIndex(i).getValueByString(Tt).getString()}getValueFromMappingTarget(t,e,i){return this._json.getRoot().getValueByString(R).getValueByIndex(t).getValueByString(oe).getValueByIndex(e).getValueByString(wi).getValueByIndex(i).getValueByString(ma).toFloat()}getBlendRatio(t){return this._json.getRoot().getValueByString(R).getValueByIndex(t).getValueByString(Fe).getValueByString(pa).toFloat()}getSmoothingFromPostProcessing(t){return this._json.getRoot().getValueByString(R).getValueByIndex(t).getValueByString(Fe).getValueByString(fa).toInt()}getSampleRate(t){return this._json.getRoot().getValueByString(R).getValueByIndex(t).getValueByString(Fe).getValueByString(ya).toFloat()}}var Ti;(r=>{r.CubismMotionSyncDataJson=er})(Ti||(Ti={}));class te{static create(t,e,i){const s=new te;return s.parse(t,e,i),s}static delete(t){t!=null&&(t.release(),t=null)}parse(t,e,i){let s=new er(e,i);if(s._json==null||t==null){D("Failed to parse .motionsync3.json.");return}this._version=s.getVersion(),this._meta=s.getMeta(),this._settings=new y;for(let a=0;a<this._meta.settingCount;a++)this._settings.pushBack(s.getSetting(a));this._settingCount=this._settings.getSize();for(let a=0;a<this._settings.getSize();a++){const o=this._settings.at(a).cubismParameterList,n=o.getSize();for(let l=0;l<n;l++){let u=n;for(let h=0;h<t.getParameterCount();h++)if(t.getParameterId(h).isEqual(o.at(l).id)){u=h;break}o.at(l).parameterIndex=u}}s.release(),s=void 0,s=null}release(){this._version=void 0,this._meta=void 0,this._meta=null,this._settings=void 0,this._settings=null,this._settingCount=0}getVersion(){return this._version}getMeta(){return this._meta}getSetting(t){return this._settings.at(t)}getSettingCount(){return this._settingCount}getMappingInfoList(t){if(this._settings.getSize()<=t)return null;const e=new y,i=this.getSetting(t);for(let s=0;s<i.audioParameterList.getSize();s++){const a=i.audioParameterList.at(s).id,o=new y,n=new y;for(let h=0;h<i.audioParameterList.getSize();h++)if(a.isEqual(i.mappingList.at(h).audioId.s)){for(let g=0;g<i.cubismParameterList.getSize();g++){const p=i.mappingList.at(h).targetList.at(g);o.pushBack(p.id),n.pushBack(p.value)}break}const l=i.audioParameterList.at(s).scale,u=i.audioParameterList.at(s).enabled;e.pushBack(new Zs(a,o,n,l,u))}return e}constructor(){this._version=0,this._meta=null,this._settings=null}}var $e=(r=>(r[r.UseCase_Mouth=0]="UseCase_Mouth",r[r.UseCase_Unknown=1]="UseCase_Unknown",r))($e||{}),He=(r=>(r[r.MappingType_Shape=0]="MappingType_Shape",r[r.MappingType_Unknown=1]="MappingType_Unknown",r))(He||{});class Sa{}class Ca{}class xa{}class Ma{}class va{}class Ba{}class ba{}var Fi;(r=>{r.CubismMotionSyncData=te})(Fi||(Fi={}));const Ft=Live2DCubismMotionSyncCore.ToPointer;class We{constructor(t){this._values=new Array(t),this._valuesCount=t,this._processedSampleCount=0}copy(t){this._values=new Array;for(let e=0;e<t.getValues().length;e++)this._values.push(t.getValues()[e]);this._valuesCount=t.getValuesCount(),this._processedSampleCount=0}toNativeArray(t){return!t&&this._resultArray?this._resultArray:(this._resultArray&&this.releaseNativeArray(),this._resultArray=new Int32Array(this._valuesCount),this._resultArrayPtr=Ft.Malloc(this._resultArray.length*this._resultArray.BYTES_PER_ELEMENT),this._resultArray=Ft.ConvertAnalysisResultToInt32Array(this._resultArray,this._resultArrayPtr,this._valuesCount),this._resultArray)}releaseNativeArray(){this.deallocNativeArrayPtr(),this._resultArray=void 0}release(){this._values=void 0,this._values=null,this._valuesCount=0,this._processedSampleCount=0}getValues(){return this._values}getValuesCount(){return this._valuesCount}getProcessedSampleCount(){return this._processedSampleCount}setProcessedSampleCount(t){this._processedSampleCount=t}ConvertNativeAnalysisResult(t){this.ConvertFromNativeResultValues(),this.ConvertFromNativeProcessedSampleCount(t)}ConvertFromNativeResultValues(){this._values=Ft.GetValuesFromAnalysisResult(this._resultArray[0],this._valuesCount)}ConvertFromNativeProcessedSampleCount(t){this._processedSampleCount=Ft.GetProcessedSampleCountFromAnalysisResult(t+8)}deallocNativeArrayPtr(){Ft.Free(this._resultArray[0]),Ft.Free(this._resultArrayPtr),this._resultArrayPtr=0}}var Ri;(r=>{r.CubismMotionSyncEngineAnalysisResult=We})(Ri||(Ri={}));class ir{createAnalysisResult(){return this.isClosed()||this._mappingInfoArray.getSize()<1?new We(0):new We(this._mappingInfoArray.at(0).getModelParameterValues().getSize())}isClosed(){return this._contextHandle==null}Close(){this.isClosed()||(this._contextHandle.release(),this._contextHandle=void 0,this._contextHandle=null,this._engine.DeleteAssociation(this))}getContextHandle(){return this._contextHandle}getEngine(){return this._engine}getType(){return this._engine.getType()}getRequireSampleCount(){var t,e;return!((t=this.getEngine())!=null&&t.getEngineHandle())||!((e=this.getContextHandle())!=null&&e.getContext())?0:this.getEngine().getEngineHandle().getRequireSampleCount(this.getContextHandle().getContext())}constructor(t,e,i){this._engine=t,this._contextHandle=e,this._mappingInfoArray=i}}var Ei;(r=>{r.ICubismMotionSyncProcessor=ir})(Ei||(Ei={}));const zt=Live2DCubismMotionSyncCore.ToPointer,Pa=2,Va=3;class si{constructor(t=0,e=0){this.SampleRate=t,this.BitDepth=e}toNativeArray(t){!t&&this._nativeArray||(this._nativeArray&&this.releaseNativeArray(),this._nativeArray=new Int32Array(Pa),this._nativeArrayPtr=zt.Malloc(this._nativeArray.length*this._nativeArray.BYTES_PER_ELEMENT),this._nativeArray=zt.ConvertContextConfigCriToInt32Array(this._nativeArray,this._nativeArrayPtr,this.SampleRate,this.BitDepth))}getNativePtr(){return this._nativeArrayPtr}releaseNativeArray(){this.deallocNativeArrayPtr(),this._nativeArray=void 0}deallocNativeArrayPtr(){zt.Free(this._nativeArrayPtr),this._nativeArrayPtr=0}}class Ia{constructor(t=0,e=0,i=0){this.BlendRatio=t,this.Smoothing=e,this.AudioLevelEffectRatio=i}toNativeArray(t){return!t&&this._nativeArray?this._nativeArray:(this._nativeArray&&this.releaseNativeArray(),this._nativeArray=new Float32Array(Va),this._nativeArrayPtr=zt.Malloc(this._nativeArray.length*this._nativeArray.BYTES_PER_ELEMENT),this._nativeArray=zt.ConvertAnalysisConfigToFloat32Array(this._nativeArray,this._nativeArrayPtr,this.BlendRatio,this.Smoothing,this.AudioLevelEffectRatio),this._nativeArray)}releaseNativeArray(){this.deallocNativePtr(),this._nativeArray=void 0}deallocNativePtr(){zt.Free(this._nativeArrayPtr),this._nativeArrayPtr=0}}var Ai;(r=>{r.MotionSyncContextConfig_CRI=si})(Ai||(Ai={}));const Q=Live2DCubismMotionSyncCore.ToPointer;class sr extends ir{getSampleRate(){return this._sampleRate}getBitDepth(){return this._bitDepth}Analyze(t,e,i,s,a,o){const n=t.getSize();if(n<this.getEngine().getEngineHandle().getRequireSampleCount(this.getContextHandle().getContext()))return P("The argument is invalid. Please check that the samples is the correct value."),null;if(!(0<=e&&e<t.getSize()))return P("The value of beginIndex is incorrect. It should be less than the length of samples."),null;if(!(0<=i&&i<=1))return P("The value of blend ratio is incorrect. The value is limited to between 0.0 and 1.0."),null;if(!(1<=s&&s<=100))return P("The value of smoothing is incorrect. The value is limited to between 1 and 100."),null;if(!(0<=a&&a<=1))return P("The value of audio level effect ratio is incorrect. The value is limited to between 0.0 and 1.0."),null;if(!o)return P("The result instance is null."),null;const u=new Ia(i,s,a).toNativeArray(!1);(!this._analysisConfigNativePtr||this._analysisConfigNativePtr==0)&&(this._analysisConfigNativePtr=Q.Malloc(u.length)),Q.AddValuePtrFloat(this._analysisConfigNativePtr,0,u[0]),Q.AddValuePtrInt32(this._analysisConfigNativePtr,4,u[1]),Q.AddValuePtrFloat(this._analysisConfigNativePtr,8,u[2]);const h=o.toNativeArray(!1);return(!this._analysisResultNativePtr||this._analysisResultNativePtr==0)&&(this._analysisResultNativePtr=Q.Malloc(h.length*h.BYTES_PER_ELEMENT)),Q.AddValuePtrInt32(this._analysisResultNativePtr,0,h[0]),Q.AddValuePtrInt32(this._analysisResultNativePtr,4,h[1]),Q.AddValuePtrInt32(this._analysisResultNativePtr,8,h[2]),this.getEngine().getEngineHandle().analyze(this.getContextHandle().getContext(),t._ptr,e,n-e,this._analysisResultNativePtr,this._analysisConfigNativePtr)?(o.ConvertNativeAnalysisResult(this._analysisResultNativePtr),o):(P("Failed to analyze."),null)}constructor(t,e,i,s,a){super(t,e,i),this._sampleRate=s,this._bitDepth=a}release(){Q.Free(this._analysisConfigNativePtr),this._analysisConfigNativePtr=0,Q.Free(this._analysisResultNativePtr),this._analysisResultNativePtr=0}}var Li;(r=>{r.CubismMotionSyncProcessorCRI=sr})(Li||(Li={}));const Di=32;class rr{constructor(t,e,i,s){this._engineHandle=t,this._type=e,this._name=i,this._version=s}getType(){return this._type}getName(){return this._name}getVersion(){return this._version}getEngineHandle(){return this._engineHandle}getProcessors(){return this._processors}isClosed(){return this.getEngineHandle()==null}releaseAllProcessor(){if(!this.isClosed())for(let t=0;t<this._processors.getSize();t++)this._processors.at(t).Close()}close(t){if(!this.isClosed()){if(0<this._processors.getSize())if(t)this.releaseAllProcessor();else return;this.getEngineHandle().disposeEngine(),this._engineHandle=void 0,this._engineHandle=null,Se.deleteAssociation(this)}}DeleteAssociation(t){for(let e=0;e<this._processors.getSize();e++)if(this._processors.at(e)==t){this._processors.at(e).Close(),this._processors.remove(e);break}}}var ki;(r=>{r.ICubismMotionSyncEngine=rr})(ki||(ki={}));const wa=16e3,Ta=128e3;class Fa extends rr{CreateProcessor(t,e,i){if(this.isClosed())return D("[CubismMotionSyncEngineCri.CreateProcessor] Cubism MotionSync Engine is not started.'"),null;if(e.getSize()<1)return D("[CubismMotionSyncEngineCri.CreateProcessor] mappingInfoList size is invalid.'"),null;if(!(wa<=i&&i<=Ta))return D("[CubismMotionSyncEngineCri.CreateProcessor] sampleRate is invalid.'"),null;const s=new si(i,Di),a=new Qs;a.setJObject(e);const o=this.getEngineHandle().createContext(this.getType(),s,a,e.getSize()),n=new tr(o,a,t),l=new sr(this,n,e,i,Di);return this._processors.pushBack(l),l}constructor(t,e,i,s){super(t,e,i,s),this._processors=new y}}var Oi;(r=>{r.MotionSyncContextConfig_CRI=si})(Oi||(Oi={}));const Ni=Live2DCubismMotionSyncCore.ToPointer;class ar{getEngineVersion(){return Live2DCubismMotionSyncCore.CubismMotionSyncEngine.csmMotionSyncGetEngineVersion()}getEngineName(){return new A(Live2DCubismMotionSyncCore.CubismMotionSyncEngine.csmMotionSyncGetEngineName())}initializeEngine(t){return this.isInitialized()?(F("Cubism MotionSync Core already initialized."),!0):(this._isEngineInitialized=!1,Live2DCubismMotionSyncCore.CubismMotionSyncEngine.csmMotionSyncInitializeEngine(t)==Live2DCubismMotionSyncCore.csmMotionSyncFalse?(D("Cubism MotionSync Core Initializing failed."),!1):(this._isEngineInitialized=!0,!0))}disposeEngine(){if(!this.isInitialized()){F("Cubism MotionSync Core initialized yet.");return}Live2DCubismMotionSyncCore.CubismMotionSyncEngine.csmMotionSyncDisposeEngine(),this._isEngineInitialized=!1}createContext(t,e,i,s){if(!this.isInitialized())return F("Cubism MotionSync Core initialized yet."),null;const a=new Live2DCubismMotionSyncCore.Context;let o;switch(t){case at.EngineType_Cri:{const n=e;n==null||n.toNativeArray(!0),o=n==null?void 0:n.getNativePtr()}break;default:return null}return a.csmMotionSyncCreate(o,i.getMappingInfoListPtr(),s),a}clearContext(t){if(!this.isInitialized()){F("Cubism MotionSync Core initialized yet.");return}t==null||t.csmMotionSyncClear()}deleteContext(t){if(!this.isInitialized()){F("Cubism MotionSync Core initialized yet.");return}t==null||t.csmMotionSyncDelete()}getRequireSampleCount(t){return this.isInitialized()?t==null?(F("context is null."),0):t.csmMotionSyncGetRequireSampleCount():(F("Cubism MotionSync Core initialized yet."),0)}analyze(t,e,i,s,a,o){if(!this.isInitialized())return F("Cubism MotionSync Core initialized yet."),!1;if(t==null)return F("context is null."),!1;const n=new Array(s);for(let u=0;u<s;u++)n[u]=e[u+i];return Ni.Free(this._analyzeSamplesPtr),this._analyzeSamplesPtr=Ni.ConvertNumberArrayToFloatArrayPtr(n),t.csmMotionSyncAnalyze(this._analyzeSamplesPtr,s,a,o)==Live2DCubismMotionSyncCore.csmMotionSyncTrue}isInitialized(){return this._isEngineInitialized}}var zi;(r=>{r.CubismMotionSyncEngineLib=ar})(zi||(zi={}));class nr{constructor(t){this._versionNumber=t,this._major=(this._versionNumber&4278190080)>>24,this._minor=(this._versionNumber&16711680)>>16,this._patch=this._versionNumber&65535}getMajor(){return this._major}getMinor(){return this._minor}getPatch(){return this._patch}toString(){return this._major+"."+this._minor+"."+this._patch+"("+this._versionNumber+")"}}var Ui;(r=>{r.CubismMotionSyncEngineVersion=nr})(Ui||(Ui={}));class Se{static initializeEngine(t){let e=new ar;const i=e.getEngineName(),s=this.ToEngineType(i),a=e.getEngineVersion(),o=new nr(a);if(this._engineMap||(this._engineMap=new H),this._engineMap.isExist(s)||(F(i.s+" "+o.toString()),!e.initializeEngine(t)))return e=void 0,e=null,null;let l=null;switch(s){case at.EngineType_Cri:l=new Fa(e,s,i,o);break;default:return e.disposeEngine(),e=void 0,e=null,null}return this._engineMap.appendKey(s),this._engineMap.setValue(s,l),l}static getEngine(t){return this._engineMap&&this._engineMap.isExist(t)?this._engineMap.getValue(t):null}static getEngines(){const t=new y;for(let e=this._engineMap.begin();e!=this._engineMap.end();e.increment())t.pushBack(e.ptr().second);return t}static releaseEngineNotForce(t){this.releaseEngine(t,!1)}static releaseEngine(t,e){t.close(e)}static deleteAllEngine(){const t=this.getEngines();for(let e=0;e<t.getSize();e++)t.at(e).close(!0);this._engineMap.clear()}static ToEngineType(t){let e=at.EngineType_Unknown;return t.s=="Live2DCubismMotionSyncEngine_CRI"&&(e=at.EngineType_Cri),e}static deleteAssociation(t){for(let e=this._engineMap.begin();e!=this._engineMap.end();e.increment())if(e.ptr().first==t.getType()){t=void 0,this._engineMap.erase(e);break}}}var ji;(r=>{r.CubismMotionSyncEngineController=Se})(ji||(ji={}));let tt=!1,Rt=!1,mt=null,it=null;const Ra=2;class z{static startUp(t=null){return tt?(F("CubismMotionSyncFramework.startUp() is already done."),tt):(mt=t,mt!=null&&Live2DCubismMotionSyncCore.Logging.csmMotionSyncSetLogFunction(mt.logFunction),tt=!0,F("CubismMotionSyncFramework.startUp() is complete."),tt)}static cleanUp(){tt=!1,Rt=!1,mt=null}static initialize(){if(G(tt),!tt){D("CubismMotionSyncFramework is not started.");return}if(Rt){D("CubismMotionSyncFramework.initialize() skipped, already initialized.");return}Rt=!0,F("CubismMotionSyncFramework.initialize() is complete.")}static dispose(){if(G(tt),!tt){D("CubismMotionSyncFramework is not started.");return}if(!Rt){D("CubismMotionSyncFramework.dispose() skipped, not initialized.");return}Rt=!1,F("CubismMotionSyncFramework.dispose() is complete.")}static isStarted(){return tt}static isInitialized(){return Rt}static create(t,e,i,s){if(!z.isInitialized())return;const a=te.create(t,e,i);if(!a)return null;const o=new y;for(let n=0;n<a.getSettingCount();n++){let l=null;const u=a.getSetting(n).analysisType;switch(u){case at.EngineType_Cri:l=this.InitializeEngineCri(u,a,n,s);break;default:D("[CubismMotionSync.Create] Index{0}: Can not create processor because `AnalysisType` is unknown.",n);break}l!=null&&o.pushBack(l)}return new z(t,a,o)}static InitializeEngineCri(t,e,i,s){let a=Se.getEngine(t);mt.engineConfig!=null&&(it=new Aa,it.engineConfigBuffer=new Int32Array(Ra),it.engineConfigPtr=Live2DCubismMotionSyncCore.ToPointer.Malloc(it.engineConfigBuffer.length*it.engineConfigBuffer.BYTES_PER_ELEMENT),Live2DCubismMotionSyncCore.ToPointer.ConvertEngineConfigCriToInt32Array(it.engineConfigBuffer,it.engineConfigPtr,mt.engineConfig.Allocator,mt.engineConfig.Deallocator));const o=it!=null?it.engineConfigPtr:0;a||(a=Se.initializeEngine(o));let n=null;return a&&(n=a.CreateProcessor(e.getSetting(i).cubismParameterList.getSize(),e.getMappingInfoList(i),s)),n}static delete(t){z.isInitialized()}setSoundBuffer(t,e,i){z.isInitialized()&&t<this._processorInfoList.getSize()&&(this._processorInfoList.at(t)._sampleBuffer=e,this._processorInfoList.at(t)._sampleBufferIndex=i)}release(){var t;if(z.isInitialized()){te.delete(this._data);for(let e=0;e<this._processorInfoList.getSize();e++)(t=this._processorInfoList.at(e)._processor)==null||t.Close()}}updateParameters(t,e){if(z.isInitialized()){e<0&&(e=0);for(let i=0;i<this._processorInfoList.getSize();i++){this._processorInfoList.at(i)._currentRemainTime+=e;const a=1/this._processorInfoList.at(i)._sampleRate;if(this._processorInfoList.at(i)._lastTotalProcessedCount=0,this._processorInfoList.at(i)._currentRemainTime<a){for(let o=0;o<this._data.getSetting(i).cubismParameterList.getSize();o++)isNaN(this._processorInfoList.at(i)._analysisResult.getValues()[o])||t.setParameterValueByIndex(this._data.getSetting(i).cubismParameterList.at(o).parameterIndex,this._processorInfoList.at(i)._lastDampedList.at(o));continue}this.analyze(t,i),this._processorInfoList.at(i)._currentRemainTime=M.mod(this._processorInfoList.at(i)._currentRemainTime,a);for(let o=0;o<this._data.getSetting(i).cubismParameterList.getSize();o++)isNaN(this._processorInfoList.at(i)._analysisResult.getValues()[o])||t.setParameterValueByIndex(this._data.getSetting(i).cubismParameterList.at(o).parameterIndex,this._processorInfoList.at(i)._lastDampedList.at(o))}}}analyze(t,e){if(!z.isInitialized())return;const i=this._processorInfoList.at(e)._processor,s=this._processorInfoList.at(e)._sampleBuffer;let a=this._processorInfoList.at(e)._sampleBufferIndex;if(i==null||this._processorInfoList.at(e)._sampleBuffer==null)return;let o=null;const n=this._processorInfoList.at(e)._blendRatio,l=this._processorInfoList.at(e)._smoothing,u=this._processorInfoList.at(e)._audioLevelEffectRatio,h=s.getSize();let g=i.getRequireSampleCount();for(let p=0;p<h&&!(h==0||h<=a||h-a<i.getRequireSampleCount());p+=g){switch(i.getType()){case at.EngineType_Cri:o=i.Analyze(s,a,n,l,u,this._processorInfoList.at(e)._analysisResult);break}if(!o)break;const d=o.getProcessedSampleCount();a+=d,this._processorInfoList.at(e)._lastTotalProcessedCount+=d;for(let c=0;c<this._data.getSetting(e).cubismParameterList.getSize();c++){let f=o.getValues()[c];if(isNaN(f))continue;const m=this._data.getSetting(e).cubismParameterList.at(c).smooth,C=this._data.getSetting(e).cubismParameterList.at(c).damper;f=((100-m)*f+this._processorInfoList.at(e)._lastSmoothedList.at(c)*m)/100,this._processorInfoList.at(e)._lastSmoothedList.set(c,f),Math.abs(f-this._processorInfoList.at(e)._lastDampedList.at(c))<C&&(f=this._processorInfoList.at(e)._lastDampedList.at(c)),this._processorInfoList.at(e)._lastDampedList.set(c,f)}g=i.getRequireSampleCount()}}setBlendRatio(t,e){z.isInitialized()&&t<this._processorInfoList.getSize()&&(this._processorInfoList.at(t)._blendRatio=e)}SetSmoothing(t,e){z.isInitialized()&&t<this._processorInfoList.getSize()&&(this._processorInfoList.at(t)._smoothing=e)}SetSampleRate(t,e){z.isInitialized()&&t<this._processorInfoList.getSize()&&(this._processorInfoList.at(t)._sampleRate=e)}getData(){return this._data}getLastTotalProcessedCount(t){return this._processorInfoList.at(t)._lastTotalProcessedCount}constructor(t,e,i){this._data=e,this._processorInfoList=new y;for(let s=0;s<(i==null?void 0:i.getSize());s++)this._processorInfoList.pushBack(new La(i.at(s),t,e.getSetting(s))),this._processorInfoList.at(s).init(e.getSetting(s))}}class Ea{}class Aa{}class La{constructor(t,e,i){this._processor=t,this._blendRatio=0,this._smoothing=1,this._sampleRate=30,this._audioLevelEffectRatio=0,this._sampleBuffer=null,this._sampleBufferIndex=0,this._model=e,this._currentRemainTime=0,this._lastTotalProcessedCount=0,this.init(i),this._analysisResult=this._processor.createAnalysisResult()}init(t){this._currentRemainTime=0,this._lastSmoothedList=new y,this._lastDampedList=new y;for(let e=0;e<t.cubismParameterList.getSize();e++){const i=this._model.getParameterValueByIndex(t.cubismParameterList.at(e).parameterIndex);this._lastSmoothedList.pushBack(i),this._lastDampedList.pushBack(i)}this._blendRatio=t.blendRatio,this._smoothing=t.smoothing,this._sampleRate=t.sampleRate,this._lastTotalProcessedCount=0}}var Xi;(r=>{r.CubismMotionSync=z})(Xi||(Xi={}));class or extends L{constructor(){super(),this._screenLeft=0,this._screenRight=0,this._screenTop=0,this._screenBottom=0,this._maxLeft=0,this._maxRight=0,this._maxTop=0,this._maxBottom=0,this._maxScale=0,this._minScale=0}adjustTranslate(t,e){this._tr[0]*this._maxLeft+(this._tr[12]+t)>this._screenLeft&&(t=this._screenLeft-this._tr[0]*this._maxLeft-this._tr[12]),this._tr[0]*this._maxRight+(this._tr[12]+t)<this._screenRight&&(t=this._screenRight-this._tr[0]*this._maxRight-this._tr[12]),this._tr[5]*this._maxTop+(this._tr[13]+e)<this._screenTop&&(e=this._screenTop-this._tr[5]*this._maxTop-this._tr[13]),this._tr[5]*this._maxBottom+(this._tr[13]+e)>this._screenBottom&&(e=this._screenBottom-this._tr[5]*this._maxBottom-this._tr[13]);const i=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,t,e,0,1]);L.multiply(i,this._tr,this._tr)}adjustScale(t,e,i){const s=this.getMaxScale(),a=this.getMinScale(),o=i*this._tr[0];o<a?this._tr[0]>0&&(i=a/this._tr[0]):o>s&&this._tr[0]>0&&(i=s/this._tr[0]);const n=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,t,e,0,1]),l=new Float32Array([i,0,0,0,0,i,0,0,0,0,1,0,0,0,0,1]),u=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,-t,-e,0,1]);L.multiply(u,this._tr,this._tr),L.multiply(l,this._tr,this._tr),L.multiply(n,this._tr,this._tr)}setScreenRect(t,e,i,s){this._screenLeft=t,this._screenRight=e,this._screenBottom=i,this._screenTop=s}setMaxScreenRect(t,e,i,s){this._maxLeft=t,this._maxRight=e,this._maxTop=s,this._maxBottom=i}setMaxScale(t){this._maxScale=t}setMinScale(t){this._minScale=t}getMaxScale(){return this._maxScale}getMinScale(){return this._minScale}isMaxScale(){return this.getScaleX()>=this._maxScale}isMinScale(){return this.getScaleX()<=this._minScale}getScreenLeft(){return this._screenLeft}getScreenRight(){return this._screenRight}getScreenBottom(){return this._screenBottom}getScreenTop(){return this._screenTop}getMaxLeft(){return this._maxLeft}getMaxRight(){return this._maxRight}getMaxBottom(){return this._maxBottom}getMaxTop(){return this._maxTop}}var Yi;(r=>{r.CubismViewMatrix=or})(Yi||(Yi={}));class Gi{constructor(t,e,i,s,a){this._rect=new Da,this._rect.left=t-i*.5,this._rect.right=t+i*.5,this._rect.up=e+s*.5,this._rect.down=e-s*.5,this._texture=a,this._vertexBuffer=null,this._uvBuffer=null,this._indexBuffer=null,this._positionLocation=null,this._uvLocation=null,this._textureLocation=null,this._positionArray=null,this._uvArray=null,this._indexArray=null,this._firstDraw=!0}release(){this._rect=null,_.deleteTexture(this._texture),this._texture=null,_.deleteBuffer(this._uvBuffer),this._uvBuffer=null,_.deleteBuffer(this._vertexBuffer),this._vertexBuffer=null,_.deleteBuffer(this._indexBuffer),this._indexBuffer=null}getTexture(){return this._texture}render(t){if(this._texture!=null){if(this._firstDraw){this._positionLocation=_.getAttribLocation(t,"position"),_.enableVertexAttribArray(this._positionLocation),this._uvLocation=_.getAttribLocation(t,"uv"),_.enableVertexAttribArray(this._uvLocation),this._textureLocation=_.getUniformLocation(t,"texture"),_.uniform1i(this._textureLocation,0),this._uvArray=new Float32Array([1,0,0,0,0,1,1,1]),this._uvBuffer=_.createBuffer();{const e=E.width,i=E.height;this._positionArray=new Float32Array([(this._rect.right-e*.5)/(e*.5),(this._rect.up-i*.5)/(i*.5),(this._rect.left-e*.5)/(e*.5),(this._rect.up-i*.5)/(i*.5),(this._rect.left-e*.5)/(e*.5),(this._rect.down-i*.5)/(i*.5),(this._rect.right-e*.5)/(e*.5),(this._rect.down-i*.5)/(i*.5)]),this._vertexBuffer=_.createBuffer()}this._indexArray=new Uint16Array([0,1,2,3,2,0]),this._indexBuffer=_.createBuffer(),this._firstDraw=!1}_.bindBuffer(_.ARRAY_BUFFER,this._uvBuffer),_.bufferData(_.ARRAY_BUFFER,this._uvArray,_.STATIC_DRAW),_.vertexAttribPointer(this._uvLocation,2,_.FLOAT,!1,0,0),_.bindBuffer(_.ARRAY_BUFFER,this._vertexBuffer),_.bufferData(_.ARRAY_BUFFER,this._positionArray,_.STATIC_DRAW),_.vertexAttribPointer(this._positionLocation,2,_.FLOAT,!1,0,0),_.bindBuffer(_.ELEMENT_ARRAY_BUFFER,this._indexBuffer),_.bufferData(_.ELEMENT_ARRAY_BUFFER,this._indexArray,_.DYNAMIC_DRAW),_.bindTexture(_.TEXTURE_2D,this._texture),_.drawElements(_.TRIANGLES,this._indexArray.length,_.UNSIGNED_SHORT,0)}}isHit(t,e){const{height:i}=E,s=i-e;return t>=this._rect.left&&t<=this._rect.right&&s<=this._rect.up&&s>=this._rect.down}}class Da{}class ka{constructor(){this._startX=0,this._startY=0,this._lastX=0,this._lastY=0,this._lastX1=0,this._lastY1=0,this._lastX2=0,this._lastY2=0,this._lastTouchDistance=0,this._deltaX=0,this._deltaY=0,this._scale=1,this._touchSingle=!1,this._flipAvailable=!1}getCenterX(){return this._lastX}getCenterY(){return this._lastY}getDeltaX(){return this._deltaX}getDeltaY(){return this._deltaY}getStartX(){return this._startX}getStartY(){return this._startY}getScale(){return this._scale}getX(){return this._lastX}getY(){return this._lastY}getX1(){return this._lastX1}getY1(){return this._lastY1}getX2(){return this._lastX2}getY2(){return this._lastY2}isSingleTouch(){return this._touchSingle}isFlickAvailable(){return this._flipAvailable}disableFlick(){this._flipAvailable=!1}touchesBegan(t,e){this._lastX=t,this._lastY=e,this._startX=t,this._startY=e,this._lastTouchDistance=-1,this._flipAvailable=!0,this._touchSingle=!0}touchesMoved(t,e){this._lastX=t,this._lastY=e,this._lastTouchDistance=-1,this._touchSingle=!0}getFlickDistance(){return this.calculateDistance(this._startX,this._startY,this._lastX,this._lastY)}calculateDistance(t,e,i,s){return Math.sqrt((t-i)*(t-i)+(e-s)*(e-s))}calculateMovingAmount(t,e){if(t>0!=e>0)return 0;const i=t>0?1:-1,s=Math.abs(t),a=Math.abs(e);return i*(s<a?s:a)}}const Oa="../../Resources/",qe=["かめ太_Live2D"],Na=qe.length,za=48e3;class $i{constructor(t=!1,e=new j){this.isOverwritten=t,this.color=e}}class Hi{constructor(t=!1,e=new j){this.isOverwritten=t,this.color=e}}class Ua{constructor(t=!1,e=!1){this.isOverwritten=t,this.isCulling=e}}class lr{update(){this._model.update(),this._model.drawables.resetDynamicFlags()}getPixelsPerUnit(){return this._model==null?0:this._model.canvasinfo.PixelsPerUnit}getCanvasWidth(){return this._model==null?0:this._model.canvasinfo.CanvasWidth/this._model.canvasinfo.PixelsPerUnit}getCanvasHeight(){return this._model==null?0:this._model.canvasinfo.CanvasHeight/this._model.canvasinfo.PixelsPerUnit}saveParameters(){const t=this._model.parameters.count,e=this._savedParameters.getSize();for(let i=0;i<t;++i)i<e?this._savedParameters.set(i,this._parameterValues[i]):this._savedParameters.pushBack(this._parameterValues[i])}getMultiplyColor(t){return this.getOverwriteFlagForModelMultiplyColors()||this.getOverwriteFlagForDrawableMultiplyColors(t)?this._userMultiplyColors.at(t).color:this.getDrawableMultiplyColor(t)}getScreenColor(t){return this.getOverwriteFlagForModelScreenColors()||this.getOverwriteFlagForDrawableScreenColors(t)?this._userScreenColors.at(t).color:this.getDrawableScreenColor(t)}setMultiplyColorByTextureColor(t,e){this.setMultiplyColorByRGBA(t,e.r,e.g,e.b,e.a)}setMultiplyColorByRGBA(t,e,i,s,a=1){this._userMultiplyColors.at(t).color.r=e,this._userMultiplyColors.at(t).color.g=i,this._userMultiplyColors.at(t).color.b=s,this._userMultiplyColors.at(t).color.a=a}setScreenColorByTextureColor(t,e){this.setScreenColorByRGBA(t,e.r,e.g,e.b,e.a)}setScreenColorByRGBA(t,e,i,s,a=1){this._userScreenColors.at(t).color.r=e,this._userScreenColors.at(t).color.g=i,this._userScreenColors.at(t).color.b=s,this._userScreenColors.at(t).color.a=a}getPartMultiplyColor(t){return this._userPartMultiplyColors.at(t).color}getPartScreenColor(t){return this._userPartScreenColors.at(t).color}setPartColor(t,e,i,s,a,o,n){if(o.at(t).color.r=e,o.at(t).color.g=i,o.at(t).color.b=s,o.at(t).color.a=a,o.at(t).isOverwritten)for(let l=0;l<this._partChildDrawables.at(t).getSize();++l){const u=this._partChildDrawables.at(t).at(l);n.at(u).color.r=e,n.at(u).color.g=i,n.at(u).color.b=s,n.at(u).color.a=a}}setPartMultiplyColorByTextureColor(t,e){this.setPartMultiplyColorByRGBA(t,e.r,e.g,e.b,e.a)}setPartMultiplyColorByRGBA(t,e,i,s,a){this.setPartColor(t,e,i,s,a,this._userPartMultiplyColors,this._userMultiplyColors)}setPartScreenColorByTextureColor(t,e){this.setPartScreenColorByRGBA(t,e.r,e.g,e.b,e.a)}setPartScreenColorByRGBA(t,e,i,s,a){this.setPartColor(t,e,i,s,a,this._userPartScreenColors,this._userScreenColors)}getOverwriteFlagForModelMultiplyColors(){return this._isOverwrittenModelMultiplyColors}getOverwriteFlagForModelScreenColors(){return this._isOverwrittenModelScreenColors}setOverwriteFlagForModelMultiplyColors(t){this._isOverwrittenModelMultiplyColors=t}setOverwriteFlagForModelScreenColors(t){this._isOverwrittenModelScreenColors=t}getOverwriteFlagForDrawableMultiplyColors(t){return this._userMultiplyColors.at(t).isOverwritten}getOverwriteFlagForDrawableScreenColors(t){return this._userScreenColors.at(t).isOverwritten}setOverwriteFlagForDrawableMultiplyColors(t,e){this._userMultiplyColors.at(t).isOverwritten=e}setOverwriteFlagForDrawableScreenColors(t,e){this._userScreenColors.at(t).isOverwritten=e}getOverwriteColorForPartMultiplyColors(t){return this._userPartMultiplyColors.at(t).isOverwritten}getOverwriteColorForPartScreenColors(t){return this._userPartScreenColors.at(t).isOverwritten}setOverwriteColorForPartColors(t,e,i,s){i.at(t).isOverwritten=e;for(let a=0;a<this._partChildDrawables.at(t).getSize();++a){const o=this._partChildDrawables.at(t).at(a);s.at(o).isOverwritten=e,e&&(s.at(o).color.r=i.at(t).color.r,s.at(o).color.g=i.at(t).color.g,s.at(o).color.b=i.at(t).color.b,s.at(o).color.a=i.at(t).color.a)}}setOverwriteColorForPartMultiplyColors(t,e){this._userPartMultiplyColors.at(t).isOverwritten=e,this.setOverwriteColorForPartColors(t,e,this._userPartMultiplyColors,this._userMultiplyColors)}setOverwriteColorForPartScreenColors(t,e){this._userPartScreenColors.at(t).isOverwritten=e,this.setOverwriteColorForPartColors(t,e,this._userPartScreenColors,this._userScreenColors)}getDrawableCulling(t){if(this.getOverwriteFlagForModelCullings()||this.getOverwriteFlagForDrawableCullings(t))return this._userCullings.at(t).isCulling;const e=this._model.drawables.constantFlags;return!Live2DCubismCore.Utils.hasIsDoubleSidedBit(e[t])}setDrawableCulling(t,e){this._userCullings.at(t).isCulling=e}getOverwriteFlagForModelCullings(){return this._isOverwrittenCullings}setOverwriteFlagForModelCullings(t){this._isOverwrittenCullings=t}getOverwriteFlagForDrawableCullings(t){return this._userCullings.at(t).isOverwritten}setOverwriteFlagForDrawableCullings(t,e){this._userCullings.at(t).isOverwritten=e}getModelOapcity(){return this._modelOpacity}setModelOapcity(t){this._modelOpacity=t}getModel(){return this._model}getPartIndex(t){let e;const i=this._model.parts.count;for(e=0;e<i;++e)if(t==this._partIds.at(e))return e;return this._notExistPartId.isExist(t)?this._notExistPartId.getValue(t):(e=i+this._notExistPartId.getSize(),this._notExistPartId.setValue(t,e),this._notExistPartOpacities.appendKey(e),e)}getPartId(t){const e=this._model.parts.ids[t];return w.getIdManager().getId(e)}getPartCount(){return this._model.parts.count}setPartOpacityByIndex(t,e){if(this._notExistPartOpacities.isExist(t)){this._notExistPartOpacities.setValue(t,e);return}G(0<=t&&t<this.getPartCount()),this._partOpacities[t]=e}setPartOpacityById(t,e){const i=this.getPartIndex(t);i<0||this.setPartOpacityByIndex(i,e)}getPartOpacityByIndex(t){return this._notExistPartOpacities.isExist(t)?this._notExistPartOpacities.getValue(t):(G(0<=t&&t<this.getPartCount()),this._partOpacities[t])}getPartOpacityById(t){const e=this.getPartIndex(t);return e<0?0:this.getPartOpacityByIndex(e)}getParameterIndex(t){let e;const i=this._model.parameters.count;for(e=0;e<i;++e)if(t==this._parameterIds.at(e))return e;return this._notExistParameterId.isExist(t)?this._notExistParameterId.getValue(t):(e=this._model.parameters.count+this._notExistParameterId.getSize(),this._notExistParameterId.setValue(t,e),this._notExistParameterValues.appendKey(e),e)}getParameterCount(){return this._model.parameters.count}getParameterType(t){return this._model.parameters.types[t]}getParameterMaximumValue(t){return this._model.parameters.maximumValues[t]}getParameterMinimumValue(t){return this._model.parameters.minimumValues[t]}getParameterDefaultValue(t){return this._model.parameters.defaultValues[t]}getParameterId(t){return w.getIdManager().getId(this._model.parameters.ids[t])}getParameterValueByIndex(t){return this._notExistParameterValues.isExist(t)?this._notExistParameterValues.getValue(t):(G(0<=t&&t<this.getParameterCount()),this._parameterValues[t])}getParameterValueById(t){const e=this.getParameterIndex(t);return this.getParameterValueByIndex(e)}setParameterValueByIndex(t,e,i=1){if(this._notExistParameterValues.isExist(t)){this._notExistParameterValues.setValue(t,i==1?e:this._notExistParameterValues.getValue(t)*(1-i)+e*i);return}G(0<=t&&t<this.getParameterCount()),this._model.parameters.maximumValues[t]<e&&(e=this._model.parameters.maximumValues[t]),this._model.parameters.minimumValues[t]>e&&(e=this._model.parameters.minimumValues[t]),this._parameterValues[t]=i==1?e:this._parameterValues[t]=this._parameterValues[t]*(1-i)+e*i}setParameterValueById(t,e,i=1){const s=this.getParameterIndex(t);this.setParameterValueByIndex(s,e,i)}addParameterValueByIndex(t,e,i=1){this.setParameterValueByIndex(t,this.getParameterValueByIndex(t)+e*i)}addParameterValueById(t,e,i=1){const s=this.getParameterIndex(t);this.addParameterValueByIndex(s,e,i)}multiplyParameterValueById(t,e,i=1){const s=this.getParameterIndex(t);this.multiplyParameterValueByIndex(s,e,i)}multiplyParameterValueByIndex(t,e,i=1){this.setParameterValueByIndex(t,this.getParameterValueByIndex(t)*(1+(e-1)*i))}getDrawableIndex(t){const e=this._model.drawables.count;for(let i=0;i<e;++i)if(this._drawableIds.at(i)==t)return i;return-1}getDrawableCount(){return this._model.drawables.count}getDrawableId(t){const e=this._model.drawables.ids;return w.getIdManager().getId(e[t])}getDrawableRenderOrders(){return this._model.drawables.renderOrders}getDrawableTextureIndices(t){return this.getDrawableTextureIndex(t)}getDrawableTextureIndex(t){return this._model.drawables.textureIndices[t]}getDrawableDynamicFlagVertexPositionsDidChange(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasVertexPositionsDidChangeBit(e[t])}getDrawableVertexIndexCount(t){return this._model.drawables.indexCounts[t]}getDrawableVertexCount(t){return this._model.drawables.vertexCounts[t]}getDrawableVertices(t){return this.getDrawableVertexPositions(t)}getDrawableVertexIndices(t){return this._model.drawables.indices[t]}getDrawableVertexPositions(t){return this._model.drawables.vertexPositions[t]}getDrawableVertexUvs(t){return this._model.drawables.vertexUvs[t]}getDrawableOpacity(t){return this._model.drawables.opacities[t]}getDrawableMultiplyColor(t){const e=this._model.drawables.multiplyColors,i=t*4,s=new j;return s.r=e[i],s.g=e[i+1],s.b=e[i+2],s.a=e[i+3],s}getDrawableScreenColor(t){const e=this._model.drawables.screenColors,i=t*4,s=new j;return s.r=e[i],s.g=e[i+1],s.b=e[i+2],s.a=e[i+3],s}getDrawableParentPartIndex(t){return this._model.drawables.parentPartIndices[t]}getDrawableBlendMode(t){const e=this._model.drawables.constantFlags;return Live2DCubismCore.Utils.hasBlendAdditiveBit(e[t])?ct.CubismBlendMode_Additive:Live2DCubismCore.Utils.hasBlendMultiplicativeBit(e[t])?ct.CubismBlendMode_Multiplicative:ct.CubismBlendMode_Normal}getDrawableInvertedMaskBit(t){const e=this._model.drawables.constantFlags;return Live2DCubismCore.Utils.hasIsInvertedMaskBit(e[t])}getDrawableMasks(){return this._model.drawables.masks}getDrawableMaskCounts(){return this._model.drawables.maskCounts}isUsingMasking(){for(let t=0;t<this._model.drawables.count;++t)if(!(this._model.drawables.maskCounts[t]<=0))return!0;return!1}getDrawableDynamicFlagIsVisible(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasIsVisibleBit(e[t])}getDrawableDynamicFlagVisibilityDidChange(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasVisibilityDidChangeBit(e[t])}getDrawableDynamicFlagOpacityDidChange(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasOpacityDidChangeBit(e[t])}getDrawableDynamicFlagRenderOrderDidChange(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasRenderOrderDidChangeBit(e[t])}getDrawableDynamicFlagBlendColorDidChange(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasBlendColorDidChangeBit(e[t])}loadParameters(){let t=this._model.parameters.count;const e=this._savedParameters.getSize();t>e&&(t=e);for(let i=0;i<t;++i)this._parameterValues[i]=this._savedParameters.at(i)}initialize(){G(this._model),this._parameterValues=this._model.parameters.values,this._partOpacities=this._model.parts.opacities,this._parameterMaximumValues=this._model.parameters.maximumValues,this._parameterMinimumValues=this._model.parameters.minimumValues;{const e=this._model.parameters.ids,i=this._model.parameters.count;this._parameterIds.prepareCapacity(i);for(let s=0;s<i;++s)this._parameterIds.pushBack(w.getIdManager().getId(e[s]))}const t=this._model.parts.count;{const e=this._model.parts.ids;this._partIds.prepareCapacity(t);for(let i=0;i<t;++i)this._partIds.pushBack(w.getIdManager().getId(e[i]));this._userPartMultiplyColors.prepareCapacity(t),this._userPartScreenColors.prepareCapacity(t),this._partChildDrawables.prepareCapacity(t)}{const e=this._model.drawables.ids,i=this._model.drawables.count;this._userMultiplyColors.prepareCapacity(i),this._userScreenColors.prepareCapacity(i),this._userCullings.prepareCapacity(i);const s=new Ua(!1,!1);for(let a=0;a<t;++a){const o=new j(1,1,1,1),n=new j(0,0,0,1),l=new Hi(!1,o),u=new Hi(!1,n);this._userPartMultiplyColors.pushBack(l),this._userPartScreenColors.pushBack(u),this._partChildDrawables.pushBack(new y),this._partChildDrawables.at(a).prepareCapacity(i)}for(let a=0;a<i;++a){const o=new j(1,1,1,1),n=new j(0,0,0,1),l=new $i(!1,o),u=new $i(!1,n);this._drawableIds.pushBack(w.getIdManager().getId(e[a])),this._userMultiplyColors.pushBack(l),this._userScreenColors.pushBack(u),this._userCullings.pushBack(s);const h=this.getDrawableParentPartIndex(a);h>=0&&this._partChildDrawables.at(h).pushBack(a)}}}constructor(t){this._model=t,this._parameterValues=null,this._parameterMaximumValues=null,this._parameterMinimumValues=null,this._partOpacities=null,this._savedParameters=new y,this._parameterIds=new y,this._drawableIds=new y,this._partIds=new y,this._isOverwrittenModelMultiplyColors=!1,this._isOverwrittenModelScreenColors=!1,this._isOverwrittenCullings=!1,this._modelOpacity=1,this._userMultiplyColors=new y,this._userScreenColors=new y,this._userCullings=new y,this._userPartMultiplyColors=new y,this._userPartScreenColors=new y,this._partChildDrawables=new y,this._notExistPartId=new H,this._notExistParameterId=new H,this._notExistParameterValues=new H,this._notExistPartOpacities=new H}release(){this._model.release(),this._model=null}}var Wi;(r=>{r.CubismModel=lr})(Wi||(Wi={}));class ae{static create(t,e){let i=null;if(e&&!this.hasMocConsistency(t))return P("Inconsistent MOC3."),i;const s=Live2DCubismCore.Moc.fromArrayBuffer(t);return s&&(i=new ae(s),i._mocVersion=Live2DCubismCore.Version.csmGetMocVersion(s,t)),i}static delete(t){t._moc._release(),t._moc=null,t=null}createModel(){let t=null;const e=Live2DCubismCore.Model.fromMoc(this._moc);return e&&(t=new lr(e),t.initialize(),++this._modelCount),t}deleteModel(t){t!=null&&(t.release(),t=null,--this._modelCount)}constructor(t){this._moc=t,this._modelCount=0,this._mocVersion=0}release(){G(this._modelCount==0),this._moc._release(),this._moc=null}getLatestMocVersion(){return Live2DCubismCore.Version.csmGetLatestMocVersion()}getMocVersion(){return this._mocVersion}static hasMocConsistency(t){return Live2DCubismCore.Moc.prototype.hasMocConsistency(t)===1}}var qi;(r=>{r.CubismMoc=ae})(qi||(qi={}));class Be{static create(){return new Be}static delete(t){}setParameters(t){this._breathParameters=t}getParameters(){return this._breathParameters}updateParameters(t,e){this._currentTime+=e;const i=this._currentTime*2*3.14159;for(let s=0;s<this._breathParameters.getSize();++s){const a=this._breathParameters.at(s);t.addParameterValueById(a.parameterId,a.offset+a.peak*Math.sin(i/a.cycle),a.weight)}}constructor(){this._currentTime=0}}class ja{constructor(t,e,i,s,a){this.parameterId=t??null,this.offset=e??0,this.peak=i??0,this.cycle=s??0,this.weight=a??0}}var Ji;(r=>{r.BreathParameterData=ja,r.CubismBreath=Be})(Ji||(Ji={}));const Kt=class Kt{static create(t=null){return new Kt(t)}static delete(t){}setBlinkingInterval(t){this._blinkingIntervalSeconds=t}setBlinkingSetting(t,e,i){this._closingSeconds=t,this._closedSeconds=e,this._openingSeconds=i}setParameterIds(t){this._parameterIds=t}getParameterIds(){return this._parameterIds}updateParameters(t,e){this._userTimeSeconds+=e;let i,s=0;switch(this._blinkingState){case 2:s=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._closingSeconds,s>=1&&(s=1,this._blinkingState=3,this._stateStartTimeSeconds=this._userTimeSeconds),i=1-s;break;case 3:s=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._closedSeconds,s>=1&&(this._blinkingState=4,this._stateStartTimeSeconds=this._userTimeSeconds),i=0;break;case 4:s=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._openingSeconds,s>=1&&(s=1,this._blinkingState=1,this._nextBlinkingTime=this.determinNextBlinkingTiming()),i=s;break;case 1:this._nextBlinkingTime<this._userTimeSeconds&&(this._blinkingState=2,this._stateStartTimeSeconds=this._userTimeSeconds),i=1;break;case 0:default:this._blinkingState=1,this._nextBlinkingTime=this.determinNextBlinkingTiming(),i=1;break}Kt.CloseIfZero||(i=-i);for(let o=0;o<this._parameterIds.getSize();++o)t.setParameterValueById(this._parameterIds.at(o),i)}constructor(t){if(this._blinkingState=0,this._nextBlinkingTime=0,this._stateStartTimeSeconds=0,this._blinkingIntervalSeconds=4,this._closingSeconds=.1,this._closedSeconds=.05,this._openingSeconds=.15,this._userTimeSeconds=0,this._parameterIds=new y,t!=null)for(let e=0;e<t.getEyeBlinkParameterCount();++e)this._parameterIds.pushBack(t.getEyeBlinkParameterId(e))}determinNextBlinkingTiming(){const t=Math.random();return this._userTimeSeconds+t*(2*this._blinkingIntervalSeconds-1)}};Kt.CloseIfZero=!0;let Ce=Kt;var ur=(r=>(r[r.EyeState_First=0]="EyeState_First",r[r.EyeState_Interval=1]="EyeState_Interval",r[r.EyeState_Closing=2]="EyeState_Closing",r[r.EyeState_Closed=3]="EyeState_Closed",r[r.EyeState_Opening=4]="EyeState_Opening",r))(ur||{}),Ki;(r=>{r.CubismEyeBlink=Ce,r.EyeState=ur})(Ki||(Ki={}));const Xa=.001,Re=.5,Zi="FadeInTime",Qi="Link",Ya="Groups",Ga="Id";class ee{static create(t,e){const i=N.create(t,e);if(!i)return null;const s=new ee,a=i.getRoot();a.getValueByString(Zi).isNull()||(s._fadeTimeSeconds=a.getValueByString(Zi).toFloat(Re),s._fadeTimeSeconds<=0&&(s._fadeTimeSeconds=Re));const o=a.getValueByString(Ya),n=o.getSize();for(let l=0;l<n;++l){const u=o.getValueByIndex(l),h=u.getSize();let g=0;for(let p=0;p<h;++p){const d=u.getValueByIndex(p),c=new ie,f=w.getIdManager().getId(d.getValueByString(Ga).getRawString());if(c.partId=f,!d.getValueByString(Qi).isNull()){const m=d.getValueByString(Qi),C=m.getSize();for(let S=0;S<C;++S){const v=new ie,B=w.getIdManager().getId(m.getValueByIndex(S).getString());v.partId=B,c.link.pushBack(v)}}s._partGroups.pushBack(c.clone()),++g}s._partGroupCounts.pushBack(g)}return N.delete(i),s}static delete(t){}updateParameters(t,e){t!=this._lastModel&&this.reset(t),this._lastModel=t,e<0&&(e=0);let i=0;for(let s=0;s<this._partGroupCounts.getSize();s++){const a=this._partGroupCounts.at(s);this.doFade(t,e,i,a),i+=a}this.copyPartOpacities(t)}reset(t){let e=0;for(let i=0;i<this._partGroupCounts.getSize();++i){const s=this._partGroupCounts.at(i);for(let a=e;a<e+s;++a){this._partGroups.at(a).initialize(t);const o=this._partGroups.at(a).partIndex,n=this._partGroups.at(a).parameterIndex;if(!(o<0)){t.setPartOpacityByIndex(o,a==e?1:0),t.setParameterValueByIndex(n,a==e?1:0);for(let l=0;l<this._partGroups.at(a).link.getSize();++l)this._partGroups.at(a).link.at(l).initialize(t)}}e+=s}}copyPartOpacities(t){for(let e=0;e<this._partGroups.getSize();++e){const i=this._partGroups.at(e);if(i.link.getSize()==0)continue;const s=this._partGroups.at(e).partIndex,a=t.getPartOpacityByIndex(s);for(let o=0;o<i.link.getSize();++o){const l=i.link.at(o).partIndex;l<0||t.setPartOpacityByIndex(l,a)}}}doFade(t,e,i,s){let a=-1,o=1;const n=.5,l=.15;for(let u=i;u<i+s;++u){const h=this._partGroups.at(u).partIndex,g=this._partGroups.at(u).parameterIndex;if(t.getParameterValueByIndex(g)>Xa){if(a>=0)break;a=u,o=t.getPartOpacityByIndex(h),o+=e/this._fadeTimeSeconds,o>1&&(o=1)}}a<0&&(a=0,o=1);for(let u=i;u<i+s;++u){const h=this._partGroups.at(u).partIndex;if(a==u)t.setPartOpacityByIndex(h,o);else{let g=t.getPartOpacityByIndex(h),p;o<n?p=o*(n-1)/n+1:p=(1-o)*n/(1-n),(1-p)*(1-o)>l&&(p=1-l/(1-o)),g>p&&(g=p),t.setPartOpacityByIndex(h,g)}}}constructor(){this._fadeTimeSeconds=Re,this._lastModel=null,this._partGroups=new y,this._partGroupCounts=new y}}class ie{constructor(t){if(this.parameterIndex=0,this.partIndex=0,this.link=new y,t!=null){this.partId=t.partId;for(const e=t.link.begin();e.notEqual(t.link.end());e.preIncrement())this.link.pushBack(e.ptr().clone())}}assignment(t){this.partId=t.partId;for(const e=t.link.begin();e.notEqual(t.link.end());e.preIncrement())this.link.pushBack(e.ptr().clone());return this}initialize(t){this.parameterIndex=t.getParameterIndex(this.partId),this.partIndex=t.getPartIndex(this.partId),t.setParameterValueByIndex(this.parameterIndex,1)}clone(){const t=new ie;t.partId=this.partId,t.parameterIndex=this.parameterIndex,t.partIndex=this.partIndex,t.link=new y;for(let e=this.link.begin();e.notEqual(this.link.end());e.increment())t.link.pushBack(e.ptr().clone());return t}}var ts;(r=>{r.CubismPose=ee,r.PartData=ie})(ts||(ts={}));class hr extends L{constructor(t,e){super(),this._width=t!==void 0?t:0,this._height=e!==void 0?e:0,this.setHeight(2)}setWidth(t){const e=t/this._width,i=e;this.scale(e,i)}setHeight(t){const e=t/this._height,i=e;this.scale(e,i)}setPosition(t,e){this.translate(t,e)}setCenterPosition(t,e){this.centerX(t),this.centerY(e)}top(t){this.setY(t)}bottom(t){const e=this._height*this.getScaleY();this.translateY(t-e)}left(t){this.setX(t)}right(t){const e=this._width*this.getScaleX();this.translateX(t-e)}centerX(t){const e=this._width*this.getScaleX();this.translateX(t-e/2)}setX(t){this.translateX(t)}centerY(t){const e=this._height*this.getScaleY();this.translateY(t-e/2)}setY(t){this.translateY(t)}setupFromLayout(t){const e="width",i="height",s="x",a="y",o="center_x",n="center_y",l="top",u="bottom",h="left",g="right";for(const p=t.begin();p.notEqual(t.end());p.preIncrement()){const d=p.ptr().first,c=p.ptr().second;d==e?this.setWidth(c):d==i&&this.setHeight(c)}for(const p=t.begin();p.notEqual(t.end());p.preIncrement()){const d=p.ptr().first,c=p.ptr().second;d==s?this.setX(c):d==a?this.setY(c):d==o?this.centerX(c):d==n?this.centerY(c):d==l?this.top(c):d==u?this.bottom(c):d==h?this.left(c):d==g&&this.right(c)}}}var es;(r=>{r.CubismModelMatrix=hr})(es||(es={}));const Ee=30,is=.01;class gr{constructor(){this._faceTargetX=0,this._faceTargetY=0,this._faceX=0,this._faceY=0,this._faceVX=0,this._faceVY=0,this._lastTimeSeconds=0,this._userTimeSeconds=0}update(t){this._userTimeSeconds+=t;const i=40/10*1/Ee;if(this._lastTimeSeconds==0){this._lastTimeSeconds=this._userTimeSeconds;return}const s=(this._userTimeSeconds-this._lastTimeSeconds)*Ee;this._lastTimeSeconds=this._userTimeSeconds;const o=.15*Ee,n=s*i/o,l=this._faceTargetX-this._faceX,u=this._faceTargetY-this._faceY;if(M.abs(l)<=is&&M.abs(u)<=is)return;const h=M.sqrt(l*l+u*u),g=i*l/h,p=i*u/h;let d=g-this._faceVX,c=p-this._faceVY;const f=M.sqrt(d*d+c*c);(f<-n||f>n)&&(d*=n/f,c*=n/f),this._faceVX+=d,this._faceVY+=c;{const m=.5*(M.sqrt(n*n+16*n*h-8*n*h)-n),C=M.sqrt(this._faceVX*this._faceVX+this._faceVY*this._faceVY);C>m&&(this._faceVX*=m/C,this._faceVY*=m/C)}this._faceX+=this._faceVX,this._faceY+=this._faceVY}getX(){return this._faceX}getY(){return this._faceY}set(t,e){this._faceTargetX=t,this._faceTargetY=e}}var ss;(r=>{r.CubismTargetPoint=gr})(ss||(ss={}));class be{constructor(){this.setFinishedMotionHandler=t=>this._onFinishedMotion=t,this.getFinishedMotionHandler=()=>this._onFinishedMotion,this._fadeInSeconds=-1,this._fadeOutSeconds=-1,this._weight=1,this._offsetSeconds=0,this._firedEventValues=new y}static delete(t){t.release(),t=null}release(){this._weight=0}updateParameters(t,e,i){if(!e.isAvailable()||e.isFinished())return;this.setupMotionQueueEntry(e,i);const s=this.updateFadeWeight(e,i);this.doUpdateParameters(t,i,s,e),e.getEndTime()>0&&e.getEndTime()<i&&e.setIsFinished(!0)}setupMotionQueueEntry(t,e){if(t==null||t.isStarted()||!t.isAvailable())return;t.setIsStarted(!0),t.setStartTime(e-this._offsetSeconds),t.setFadeInStartTime(e);const i=this.getDuration();t.getEndTime()<0&&t.setEndTime(i<=0?-1:t.getStartTime()+i)}updateFadeWeight(t,e){t==null&&ti.print(Ct.LogLevel_Error,"motionQueueEntry is null.");let i=this._weight;const s=this._fadeInSeconds==0?1:M.getEasingSine((e-t.getFadeInStartTime())/this._fadeInSeconds),a=this._fadeOutSeconds==0||t.getEndTime()<0?1:M.getEasingSine((t.getEndTime()-e)/this._fadeOutSeconds);return i=i*s*a,t.setState(e,i),G(0<=i&&i<=1),i}setFadeInTime(t){this._fadeInSeconds=t}setFadeOutTime(t){this._fadeOutSeconds=t}getFadeOutTime(){return this._fadeOutSeconds}getFadeInTime(){return this._fadeInSeconds}setWeight(t){this._weight=t}getWeight(){return this._weight}getDuration(){return-1}getLoopDuration(){return-1}setOffsetTime(t){this._offsetSeconds=t}getFiredEvent(t,e){return this._firedEventValues}isExistModelOpacity(){return!1}getModelOpacityIndex(){return-1}getModelOpacityId(t){return null}getModelOpacityValue(){return 1}}var rs;(r=>{r.ACubismMotion=be})(rs||(rs={}));const $a="FadeInTime",Ha="FadeOutTime",as="Parameters",Wa="Id",qa="Value",le="Blend",Ja="Add",Ka="Multiply",Za="Overwrite",ns=1,Y=class Y extends be{static create(t,e){const i=new Y;return i.parse(t,e),i}doUpdateParameters(t,e,i,s){for(let a=0;a<this._parameters.getSize();++a){const o=this._parameters.at(a);switch(o.blendType){case 0:{t.addParameterValueById(o.parameterId,o.value,i);break}case 1:{t.multiplyParameterValueById(o.parameterId,o.value,i);break}case 2:{t.setParameterValueById(o.parameterId,o.value,i);break}}}}calculateExpressionParameters(t,e,i,s,a,o){if(!(i==null||s==null)&&i.isAvailable()){this._fadeWeight=this.updateFadeWeight(i,e);for(let n=0;n<s.getSize();++n){const l=s.at(n);if(l.parameterId==null)continue;const u=l.overwriteValue=t.getParameterValueById(l.parameterId),h=this.getExpressionParameters();let g=-1;for(let m=0;m<h.getSize();++m)if(l.parameterId==h.at(m).parameterId){g=m;break}if(g<0){a==0?(l.additiveValue=Y.DefaultAdditiveValue,l.multiplyValue=Y.DefaultMultiplyValue,l.overwriteValue=u):(l.additiveValue=this.calculateValue(l.additiveValue,Y.DefaultAdditiveValue,o),l.multiplyValue=this.calculateValue(l.multiplyValue,Y.DefaultMultiplyValue,o),l.overwriteValue=this.calculateValue(l.overwriteValue,u,o));continue}const p=h.at(g).value;let d,c,f;switch(h.at(g).blendType){case 0:d=p,c=Y.DefaultMultiplyValue,f=u;break;case 1:d=Y.DefaultAdditiveValue,c=p,f=u;break;case 2:d=Y.DefaultAdditiveValue,c=Y.DefaultMultiplyValue,f=p;break;default:return}a==0?(l.additiveValue=d,l.multiplyValue=c,l.overwriteValue=f):(l.additiveValue=l.additiveValue*(1-o)+d*o,l.multiplyValue=l.multiplyValue*(1-o)+c*o,l.overwriteValue=l.overwriteValue*(1-o)+f*o)}}}getExpressionParameters(){return this._parameters}getFadeWeight(){return this._fadeWeight}parse(t,e){const i=N.create(t,e);if(!i)return;const s=i.getRoot();this.setFadeInTime(s.getValueByString($a).toFloat(ns)),this.setFadeOutTime(s.getValueByString(Ha).toFloat(ns));const a=s.getValueByString(as).getSize();this._parameters.prepareCapacity(a);for(let o=0;o<a;++o){const n=s.getValueByString(as).getValueByIndex(o),l=w.getIdManager().getId(n.getValueByString(Wa).getRawString()),u=n.getValueByString(qa).toFloat();let h;n.getValueByString(le).isNull()||n.getValueByString(le).getString()==Ja?h=0:n.getValueByString(le).getString()==Ka?h=1:n.getValueByString(le).getString()==Za?h=2:h=0;const g=new dr;g.parameterId=l,g.blendType=h,g.value=u,this._parameters.pushBack(g)}N.delete(i)}calculateValue(t,e,i){return t*(1-i)+e*i}constructor(){super(),this._parameters=new y,this._fadeWeight=0}};Y.DefaultAdditiveValue=0,Y.DefaultMultiplyValue=1;let gt=Y;var cr=(r=>(r[r.Additive=0]="Additive",r[r.Multiply=1]="Multiply",r[r.Overwrite=2]="Overwrite",r))(cr||{});class dr{}var os;(r=>{r.CubismExpressionMotion=gt,r.ExpressionBlendType=cr,r.ExpressionParameter=dr})(os||(os={}));class _r{constructor(){this._autoDelete=!1,this._motion=null,this._available=!0,this._finished=!1,this._started=!1,this._startTimeSeconds=-1,this._fadeInStartTimeSeconds=0,this._endTimeSeconds=-1,this._stateTimeSeconds=0,this._stateWeight=0,this._lastEventCheckSeconds=0,this._motionQueueEntryHandle=this,this._fadeOutSeconds=0,this._isTriggeredFadeOut=!1}release(){this._autoDelete&&this._motion&&be.delete(this._motion)}setFadeOut(t){this._fadeOutSeconds=t,this._isTriggeredFadeOut=!0}startFadeOut(t,e){const i=e+t;this._isTriggeredFadeOut=!0,(this._endTimeSeconds<0||i<this._endTimeSeconds)&&(this._endTimeSeconds=i)}isFinished(){return this._finished}isStarted(){return this._started}getStartTime(){return this._startTimeSeconds}getFadeInStartTime(){return this._fadeInStartTimeSeconds}getEndTime(){return this._endTimeSeconds}setStartTime(t){this._startTimeSeconds=t}setFadeInStartTime(t){this._fadeInStartTimeSeconds=t}setEndTime(t){this._endTimeSeconds=t}setIsFinished(t){this._finished=t}setIsStarted(t){this._started=t}isAvailable(){return this._available}setIsAvailable(t){this._available=t}setState(t,e){this._stateTimeSeconds=t,this._stateWeight=e}getStateTime(){return this._stateTimeSeconds}getStateWeight(){return this._stateWeight}getLastCheckEventSeconds(){return this._lastEventCheckSeconds}setLastCheckEventSeconds(t){this._lastEventCheckSeconds=t}isTriggeredFadeOut(){return this._isTriggeredFadeOut}getFadeOutSeconds(){return this._fadeOutSeconds}getCubismMotion(){return this._motion}}var ls;(r=>{r.CubismMotionQueueEntry=_r})(ls||(ls={}));class ri{constructor(){this._userTimeSeconds=0,this._eventCallBack=null,this._eventCustomData=null,this._motions=new y}release(){for(let t=0;t<this._motions.getSize();++t)this._motions.at(t)&&(this._motions.at(t).release(),this._motions.set(t,null));this._motions=null}startMotion(t,e,i){if(t==null)return mr;let s=null;for(let a=0;a<this._motions.getSize();++a)s=this._motions.at(a),s!=null&&s.setFadeOut(s._motion.getFadeOutTime());return s=new _r,s._autoDelete=e,s._motion=t,this._motions.pushBack(s),s._motionQueueEntryHandle}isFinished(){for(let t=this._motions.begin();t.notEqual(this._motions.end());){let e=t.ptr();if(e==null){t=this._motions.erase(t);continue}if(e._motion==null){e.release(),e=null,t=this._motions.erase(t);continue}if(e.isFinished())t.preIncrement();else return!1}return!0}isFinishedByHandle(t){for(let e=this._motions.begin();e.notEqual(this._motions.end());e.increment()){const i=e.ptr();if(i!=null&&i._motionQueueEntryHandle==t&&!i.isFinished())return!1}return!0}stopAllMotions(){for(let t=this._motions.begin();t.notEqual(this._motions.end());){let e=t.ptr();if(e==null){t=this._motions.erase(t);continue}e.release(),e=null,t=this._motions.erase(t)}}getCubismMotionQueueEntries(){return this._motions}getCubismMotionQueueEntry(t){for(let e=this._motions.begin();e.notEqual(this._motions.end());e.preIncrement()){const i=e.ptr();if(i!=null&&i._motionQueueEntryHandle==t)return i}return null}setEventCallback(t,e=null){this._eventCallBack=t,this._eventCustomData=e}doUpdateMotion(t,e){let i=!1;for(let s=this._motions.begin();s.notEqual(this._motions.end());){let a=s.ptr();if(a==null){s=this._motions.erase(s);continue}const o=a._motion;if(o==null){a.release(),a=null,s=this._motions.erase(s);continue}o.updateParameters(t,a,e),i=!0;const n=o.getFiredEvent(a.getLastCheckEventSeconds()-a.getStartTime(),e-a.getStartTime());for(let l=0;l<n.getSize();++l)this._eventCallBack(this,n.at(l),this._eventCustomData);a.setLastCheckEventSeconds(e),a.isFinished()?(a.release(),a=null,s=this._motions.erase(s)):(a.isTriggeredFadeOut()&&a.startFadeOut(a.getFadeOutSeconds(),e),s.preIncrement())}return i}}const mr=-1;var us;(r=>{r.CubismMotionQueueManager=ri,r.InvalidMotionQueueEntryHandleValue=mr})(us||(us={}));class Qa{}class pr extends ri{constructor(){super(),this._currentPriority=0,this._reservePriority=0,this._expressionParameterValues=new y,this._fadeWeights=new y}release(){this._expressionParameterValues&&(Ht(this._expressionParameterValues),this._expressionParameterValues=null),this._fadeWeights&&(Ht(this._fadeWeights),this._fadeWeights=null)}getCurrentPriority(){return this._currentPriority}getReservePriority(){return this._reservePriority}getFadeWeight(t){return this._fadeWeights.at(t)}setReservePriority(t){this._reservePriority=t}startMotionPriority(t,e,i){return i==this.getReservePriority()&&this.setReservePriority(0),this._currentPriority=i,this._fadeWeights.pushBack(0),this.startMotion(t,e)}updateMotion(t,e){this._userTimeSeconds+=e;let i=!1;const s=this.getCubismMotionQueueEntries();let a=0,o=0;for(let n=this._motions.begin();n.notEqual(this._motions.end());){const l=n.ptr();if(l==null){n=s.erase(n);continue}const u=l.getCubismMotion();if(u==null){Ht(l),n=s.erase(n);continue}const h=u.getExpressionParameters();if(l.isAvailable())for(let g=0;g<h.getSize();++g){if(h.at(g).parameterId==null)continue;let p=-1;for(let c=0;c<this._expressionParameterValues.getSize();++c)if(this._expressionParameterValues.at(c).parameterId==h.at(g).parameterId){p=c;break}if(p>=0)continue;const d=new Qa;d.parameterId=h.at(g).parameterId,d.additiveValue=gt.DefaultAdditiveValue,d.multiplyValue=gt.DefaultMultiplyValue,d.overwriteValue=t.getParameterValueById(d.parameterId),this._expressionParameterValues.pushBack(d)}u.setupMotionQueueEntry(l,this._userTimeSeconds),this._fadeWeights.set(o,u.updateFadeWeight(l,this._userTimeSeconds)),u.calculateExpressionParameters(t,this._userTimeSeconds,l,this._expressionParameterValues,o,this._fadeWeights.at(o)),a+=u.getFadeInTime()==0?1:M.getEasingSine((this._userTimeSeconds-l.getFadeInStartTime())/u.getFadeInTime()),i=!0,l.isTriggeredFadeOut()&&l.startFadeOut(l.getFadeOutSeconds(),this._userTimeSeconds),n.preIncrement(),++o}if(s.getSize()>1&&(s.at(s.getSize()-1).getCubismMotion(),this._fadeWeights.at(this._fadeWeights.getSize()-1)>=1))for(let l=s.getSize()-2;l>=0;--l){const u=s.at(l);Ht(u),s.remove(l),this._fadeWeights.remove(l)}a>1&&(a=1);for(let n=0;n<this._expressionParameterValues.getSize();++n){const l=this._expressionParameterValues.at(n);t.setParameterValueById(l.parameterId,(l.overwriteValue+l.additiveValue)*l.multiplyValue,a),l.additiveValue=gt.DefaultAdditiveValue,l.multiplyValue=gt.DefaultMultiplyValue}return i}}var hs;(r=>{r.CubismExpressionMotionManager=pr})(hs||(hs={}));var q=(r=>(r[r.CubismMotionCurveTarget_Model=0]="CubismMotionCurveTarget_Model",r[r.CubismMotionCurveTarget_Parameter=1]="CubismMotionCurveTarget_Parameter",r[r.CubismMotionCurveTarget_PartOpacity=2]="CubismMotionCurveTarget_PartOpacity",r))(q||{}),J=(r=>(r[r.CubismMotionSegmentType_Linear=0]="CubismMotionSegmentType_Linear",r[r.CubismMotionSegmentType_Bezier=1]="CubismMotionSegmentType_Bezier",r[r.CubismMotionSegmentType_Stepped=2]="CubismMotionSegmentType_Stepped",r[r.CubismMotionSegmentType_InverseStepped=3]="CubismMotionSegmentType_InverseStepped",r))(J||{});class ai{constructor(){this.time=0,this.value=0}}class fr{constructor(){this.evaluate=null,this.basePointIndex=0,this.segmentType=0}}class yr{constructor(){this.type=0,this.segmentCount=0,this.baseSegmentIndex=0,this.fadeInTime=0,this.fadeOutTime=0}}class Sr{constructor(){this.fireTime=0}}class Cr{constructor(){this.duration=0,this.loop=!1,this.curveCount=0,this.eventCount=0,this.fps=0,this.curves=new y,this.segments=new y,this.points=new y,this.events=new y}}var gs;(r=>{r.CubismMotionCurve=yr,r.CubismMotionCurveTarget=q,r.CubismMotionData=Cr,r.CubismMotionEvent=Sr,r.CubismMotionPoint=ai,r.CubismMotionSegment=fr,r.CubismMotionSegmentType=J})(gs||(gs={}));const X="Meta",tn="Duration",en="Loop",sn="AreBeziersRestricted",rn="CurveCount",an="Fps",nn="TotalSegmentCount",on="TotalPointCount",nt="Curves",ln="Target",un="Id",ue="FadeInTime",he="FadeOutTime",cs="Segments",ds="UserData",hn="UserDataCount",gn="TotalUserDataSize",cn="Time",dn="Value";class xr{constructor(t,e){this._json=N.create(t,e)}release(){N.delete(this._json)}getMotionDuration(){return this._json.getRoot().getValueByString(X).getValueByString(tn).toFloat()}isMotionLoop(){return this._json.getRoot().getValueByString(X).getValueByString(en).toBoolean()}getEvaluationOptionFlag(t){return t==0?this._json.getRoot().getValueByString(X).getValueByString(sn).toBoolean():!1}getMotionCurveCount(){return this._json.getRoot().getValueByString(X).getValueByString(rn).toInt()}getMotionFps(){return this._json.getRoot().getValueByString(X).getValueByString(an).toFloat()}getMotionTotalSegmentCount(){return this._json.getRoot().getValueByString(X).getValueByString(nn).toInt()}getMotionTotalPointCount(){return this._json.getRoot().getValueByString(X).getValueByString(on).toInt()}isExistMotionFadeInTime(){return!this._json.getRoot().getValueByString(X).getValueByString(ue).isNull()}isExistMotionFadeOutTime(){return!this._json.getRoot().getValueByString(X).getValueByString(he).isNull()}getMotionFadeInTime(){return this._json.getRoot().getValueByString(X).getValueByString(ue).toFloat()}getMotionFadeOutTime(){return this._json.getRoot().getValueByString(X).getValueByString(he).toFloat()}getMotionCurveTarget(t){return this._json.getRoot().getValueByString(nt).getValueByIndex(t).getValueByString(ln).getRawString()}getMotionCurveId(t){return w.getIdManager().getId(this._json.getRoot().getValueByString(nt).getValueByIndex(t).getValueByString(un).getRawString())}isExistMotionCurveFadeInTime(t){return!this._json.getRoot().getValueByString(nt).getValueByIndex(t).getValueByString(ue).isNull()}isExistMotionCurveFadeOutTime(t){return!this._json.getRoot().getValueByString(nt).getValueByIndex(t).getValueByString(he).isNull()}getMotionCurveFadeInTime(t){return this._json.getRoot().getValueByString(nt).getValueByIndex(t).getValueByString(ue).toFloat()}getMotionCurveFadeOutTime(t){return this._json.getRoot().getValueByString(nt).getValueByIndex(t).getValueByString(he).toFloat()}getMotionCurveSegmentCount(t){return this._json.getRoot().getValueByString(nt).getValueByIndex(t).getValueByString(cs).getVector().getSize()}getMotionCurveSegment(t,e){return this._json.getRoot().getValueByString(nt).getValueByIndex(t).getValueByString(cs).getValueByIndex(e).toFloat()}getEventCount(){return this._json.getRoot().getValueByString(X).getValueByString(hn).toInt()}getTotalEventValueSize(){return this._json.getRoot().getValueByString(X).getValueByString(gn).toInt()}getEventTime(t){return this._json.getRoot().getValueByString(ds).getValueByIndex(t).getValueByString(cn).toFloat()}getEventValue(t){return new A(this._json.getRoot().getValueByString(ds).getValueByIndex(t).getValueByString(dn).getRawString())}}var Mr=(r=>(r[r.EvaluationOptionFlag_AreBeziersRistricted=0]="EvaluationOptionFlag_AreBeziersRistricted",r))(Mr||{}),_s;(r=>{r.CubismMotionJson=xr})(_s||(_s={}));const _n="EyeBlink",mn="LipSync",pn="Model",fn="Parameter",yn="PartOpacity",ge="Opacity",Sn=!1;function $(r,t,e){const i=new ai;return i.time=r.time+(t.time-r.time)*e,i.value=r.value+(t.value-r.value)*e,i}function Cn(r,t){let e=(t-r[0].time)/(r[1].time-r[0].time);return e<0&&(e=0),r[0].value+(r[1].value-r[0].value)*e}function xn(r,t){let e=(t-r[0].time)/(r[3].time-r[0].time);e<0&&(e=0);const i=$(r[0],r[1],e),s=$(r[1],r[2],e),a=$(r[2],r[3],e),o=$(i,s,e),n=$(s,a,e);return $(o,n,e).value}function Mn(r,t){const e=t,i=r[0].time,s=r[3].time,a=r[1].time,o=r[2].time,n=s-3*o+3*a-i,l=3*o-6*a+3*i,u=3*a-3*i,h=i-e,g=M.cardanoAlgorithmForBezier(n,l,u,h),p=$(r[0],r[1],g),d=$(r[1],r[2],g),c=$(r[2],r[3],g),f=$(p,d,g),m=$(d,c,g);return $(f,m,g).value}function vn(r,t){return r[0].value}function Bn(r,t){return r[1].value}function Ae(r,t,e){const i=r.curves.at(t);let s=-1;const a=i.baseSegmentIndex+i.segmentCount;let o=0;for(let l=i.baseSegmentIndex;l<a;++l)if(o=r.segments.at(l).basePointIndex+(r.segments.at(l).segmentType==J.CubismMotionSegmentType_Bezier?3:1),r.points.at(o).time>e){s=l;break}if(s==-1)return r.points.at(o).value;const n=r.segments.at(s);return n.evaluate(r.points.get(n.basePointIndex),e)}class Pe extends be{static create(t,e,i){const s=new Pe;return s.parse(t,e),s._sourceFrameRate=s._motionData.fps,s._loopDurationSeconds=s._motionData.duration,s._onFinishedMotion=i,s}doUpdateParameters(t,e,i,s){this._modelCurveIdEyeBlink==null&&(this._modelCurveIdEyeBlink=w.getIdManager().getId(_n)),this._modelCurveIdLipSync==null&&(this._modelCurveIdLipSync=w.getIdManager().getId(mn)),this._modelCurveIdOpacity==null&&(this._modelCurveIdOpacity=w.getIdManager().getId(ge));let a=e-s.getStartTime();a<0&&(a=0);let o=Number.MAX_VALUE,n=Number.MAX_VALUE;const l=64;let u=0,h=0;this._eyeBlinkParameterIds.getSize()>l&&Zt("too many eye blink targets : {0}",this._eyeBlinkParameterIds.getSize()),this._lipSyncParameterIds.getSize()>l&&Zt("too many lip sync targets : {0}",this._lipSyncParameterIds.getSize());const g=this._fadeInSeconds<=0?1:M.getEasingSine((e-s.getFadeInStartTime())/this._fadeInSeconds),p=this._fadeOutSeconds<=0||s.getEndTime()<0?1:M.getEasingSine((s.getEndTime()-e)/this._fadeOutSeconds);let d,c,f,m=a;if(this._isLoop)for(;m>this._motionData.duration;)m-=this._motionData.duration;const C=this._motionData.curves;for(c=0;c<this._motionData.curveCount&&C.at(c).type==q.CubismMotionCurveTarget_Model;++c)d=Ae(this._motionData,c,m),C.at(c).id==this._modelCurveIdEyeBlink?n=d:C.at(c).id==this._modelCurveIdLipSync?o=d:C.at(c).id==this._modelCurveIdOpacity&&(this._modelOpacity=d,t.setModelOapcity(this.getModelOpacityValue()));for(;c<this._motionData.curveCount&&C.at(c).type==q.CubismMotionCurveTarget_Parameter;++c){if(f=t.getParameterIndex(C.at(c).id),f==-1)continue;const S=t.getParameterValueByIndex(f);if(d=Ae(this._motionData,c,m),n!=Number.MAX_VALUE){for(let B=0;B<this._eyeBlinkParameterIds.getSize()&&B<l;++B)if(this._eyeBlinkParameterIds.at(B)==C.at(c).id){d*=n,h|=1<<B;break}}if(o!=Number.MAX_VALUE){for(let B=0;B<this._lipSyncParameterIds.getSize()&&B<l;++B)if(this._lipSyncParameterIds.at(B)==C.at(c).id){d+=o,u|=1<<B;break}}let v;if(C.at(c).fadeInTime<0&&C.at(c).fadeOutTime<0)v=S+(d-S)*i;else{let B,V;C.at(c).fadeInTime<0?B=g:B=C.at(c).fadeInTime==0?1:M.getEasingSine((e-s.getFadeInStartTime())/C.at(c).fadeInTime),C.at(c).fadeOutTime<0?V=p:V=C.at(c).fadeOutTime==0||s.getEndTime()<0?1:M.getEasingSine((s.getEndTime()-e)/C.at(c).fadeOutTime);const b=this._weight*B*V;v=S+(d-S)*b}t.setParameterValueByIndex(f,v,1)}{if(n!=Number.MAX_VALUE)for(let S=0;S<this._eyeBlinkParameterIds.getSize()&&S<l;++S){const v=t.getParameterValueById(this._eyeBlinkParameterIds.at(S));if(h>>S&1)continue;const B=v+(n-v)*i;t.setParameterValueById(this._eyeBlinkParameterIds.at(S),B)}if(o!=Number.MAX_VALUE)for(let S=0;S<this._lipSyncParameterIds.getSize()&&S<l;++S){const v=t.getParameterValueById(this._lipSyncParameterIds.at(S));if(u>>S&1)continue;const B=v+(o-v)*i;t.setParameterValueById(this._lipSyncParameterIds.at(S),B)}}for(;c<this._motionData.curveCount&&C.at(c).type==q.CubismMotionCurveTarget_PartOpacity;++c)f=t.getParameterIndex(C.at(c).id),f!=-1&&(d=Ae(this._motionData,c,m),t.setParameterValueByIndex(f,d));a>=this._motionData.duration&&(this._isLoop?(s.setStartTime(e),this._isLoopFadeIn&&s.setFadeInStartTime(e)):(this._onFinishedMotion&&this._onFinishedMotion(this),s.setIsFinished(!0))),this._lastWeight=i}setIsLoop(t){this._isLoop=t}isLoop(){return this._isLoop}setIsLoopFadeIn(t){this._isLoopFadeIn=t}isLoopFadeIn(){return this._isLoopFadeIn}getDuration(){return this._isLoop?-1:this._loopDurationSeconds}getLoopDuration(){return this._loopDurationSeconds}setParameterFadeInTime(t,e){const i=this._motionData.curves;for(let s=0;s<this._motionData.curveCount;++s)if(t==i.at(s).id){i.at(s).fadeInTime=e;return}}setParameterFadeOutTime(t,e){const i=this._motionData.curves;for(let s=0;s<this._motionData.curveCount;++s)if(t==i.at(s).id){i.at(s).fadeOutTime=e;return}}getParameterFadeInTime(t){const e=this._motionData.curves;for(let i=0;i<this._motionData.curveCount;++i)if(t==e.at(i).id)return e.at(i).fadeInTime;return-1}getParameterFadeOutTime(t){const e=this._motionData.curves;for(let i=0;i<this._motionData.curveCount;++i)if(t==e.at(i).id)return e.at(i).fadeOutTime;return-1}setEffectIds(t,e){this._eyeBlinkParameterIds=t,this._lipSyncParameterIds=e}constructor(){super(),this._sourceFrameRate=30,this._loopDurationSeconds=-1,this._isLoop=!1,this._isLoopFadeIn=!0,this._lastWeight=0,this._motionData=null,this._modelCurveIdEyeBlink=null,this._modelCurveIdLipSync=null,this._modelCurveIdOpacity=null,this._eyeBlinkParameterIds=null,this._lipSyncParameterIds=null,this._modelOpacity=1}release(){this._motionData=void 0,this._motionData=null}parse(t,e){this._motionData=new Cr;let i=new xr(t,e);if(!i){i.release(),i=void 0;return}this._motionData.duration=i.getMotionDuration(),this._motionData.loop=i.isMotionLoop(),this._motionData.curveCount=i.getMotionCurveCount(),this._motionData.fps=i.getMotionFps(),this._motionData.eventCount=i.getEventCount();const s=i.getEvaluationOptionFlag(Mr.EvaluationOptionFlag_AreBeziersRistricted);i.isExistMotionFadeInTime()?this._fadeInSeconds=i.getMotionFadeInTime()<0?1:i.getMotionFadeInTime():this._fadeInSeconds=1,i.isExistMotionFadeOutTime()?this._fadeOutSeconds=i.getMotionFadeOutTime()<0?1:i.getMotionFadeOutTime():this._fadeOutSeconds=1,this._motionData.curves.updateSize(this._motionData.curveCount,yr,!0),this._motionData.segments.updateSize(i.getMotionTotalSegmentCount(),fr,!0),this._motionData.points.updateSize(i.getMotionTotalPointCount(),ai,!0),this._motionData.events.updateSize(this._motionData.eventCount,Sr,!0);let a=0,o=0;for(let n=0;n<this._motionData.curveCount;++n){i.getMotionCurveTarget(n)==pn?this._motionData.curves.at(n).type=q.CubismMotionCurveTarget_Model:i.getMotionCurveTarget(n)==fn?this._motionData.curves.at(n).type=q.CubismMotionCurveTarget_Parameter:i.getMotionCurveTarget(n)==yn?this._motionData.curves.at(n).type=q.CubismMotionCurveTarget_PartOpacity:D('Warning : Unable to get segment type from Curve! The number of "CurveCount" may be incorrect!'),this._motionData.curves.at(n).id=i.getMotionCurveId(n),this._motionData.curves.at(n).baseSegmentIndex=o,this._motionData.curves.at(n).fadeInTime=i.isExistMotionCurveFadeInTime(n)?i.getMotionCurveFadeInTime(n):-1,this._motionData.curves.at(n).fadeOutTime=i.isExistMotionCurveFadeOutTime(n)?i.getMotionCurveFadeOutTime(n):-1;for(let l=0;l<i.getMotionCurveSegmentCount(n);){switch(l==0?(this._motionData.segments.at(o).basePointIndex=a,this._motionData.points.at(a).time=i.getMotionCurveSegment(n,l),this._motionData.points.at(a).value=i.getMotionCurveSegment(n,l+1),a+=1,l+=2):this._motionData.segments.at(o).basePointIndex=a-1,i.getMotionCurveSegment(n,l)){case J.CubismMotionSegmentType_Linear:{this._motionData.segments.at(o).segmentType=J.CubismMotionSegmentType_Linear,this._motionData.segments.at(o).evaluate=Cn,this._motionData.points.at(a).time=i.getMotionCurveSegment(n,l+1),this._motionData.points.at(a).value=i.getMotionCurveSegment(n,l+2),a+=1,l+=3;break}case J.CubismMotionSegmentType_Bezier:{this._motionData.segments.at(o).segmentType=J.CubismMotionSegmentType_Bezier,s||Sn?this._motionData.segments.at(o).evaluate=xn:this._motionData.segments.at(o).evaluate=Mn,this._motionData.points.at(a).time=i.getMotionCurveSegment(n,l+1),this._motionData.points.at(a).value=i.getMotionCurveSegment(n,l+2),this._motionData.points.at(a+1).time=i.getMotionCurveSegment(n,l+3),this._motionData.points.at(a+1).value=i.getMotionCurveSegment(n,l+4),this._motionData.points.at(a+2).time=i.getMotionCurveSegment(n,l+5),this._motionData.points.at(a+2).value=i.getMotionCurveSegment(n,l+6),a+=3,l+=7;break}case J.CubismMotionSegmentType_Stepped:{this._motionData.segments.at(o).segmentType=J.CubismMotionSegmentType_Stepped,this._motionData.segments.at(o).evaluate=vn,this._motionData.points.at(a).time=i.getMotionCurveSegment(n,l+1),this._motionData.points.at(a).value=i.getMotionCurveSegment(n,l+2),a+=1,l+=3;break}case J.CubismMotionSegmentType_InverseStepped:{this._motionData.segments.at(o).segmentType=J.CubismMotionSegmentType_InverseStepped,this._motionData.segments.at(o).evaluate=Bn,this._motionData.points.at(a).time=i.getMotionCurveSegment(n,l+1),this._motionData.points.at(a).value=i.getMotionCurveSegment(n,l+2),a+=1,l+=3;break}default:{G(0);break}}++this._motionData.curves.at(n).segmentCount,++o}}for(let n=0;n<i.getEventCount();++n)this._motionData.events.at(n).fireTime=i.getEventTime(n),this._motionData.events.at(n).value=i.getEventValue(n);i.release(),i=void 0,i=null}getFiredEvent(t,e){this._firedEventValues.updateSize(0);for(let i=0;i<this._motionData.eventCount;++i)this._motionData.events.at(i).fireTime>t&&this._motionData.events.at(i).fireTime<=e&&this._firedEventValues.pushBack(new A(this._motionData.events.at(i).value.s));return this._firedEventValues}isExistModelOpacity(){for(let t=0;t<this._motionData.curveCount;t++){const e=this._motionData.curves.at(t);if(e.type==q.CubismMotionCurveTarget_Model&&e.id.getString().s.localeCompare(ge)==0)return!0}return!1}getModelOpacityIndex(){if(this.isExistModelOpacity())for(let t=0;t<this._motionData.curveCount;t++){const e=this._motionData.curves.at(t);if(e.type==q.CubismMotionCurveTarget_Model&&e.id.getString().s.localeCompare(ge)==0)return t}return-1}getModelOpacityId(t){if(t!=-1){const e=this._motionData.curves.at(t);if(e.type==q.CubismMotionCurveTarget_Model&&e.id.getString().s.localeCompare(ge)==0)return w.getIdManager().getId(e.id.getString().s)}return null}getModelOpacityValue(){return this._modelOpacity}}var ms;(r=>{r.CubismMotion=Pe})(ms||(ms={}));class vr extends ri{constructor(){super(),this._currentPriority=0,this._reservePriority=0}getCurrentPriority(){return this._currentPriority}getReservePriority(){return this._reservePriority}setReservePriority(t){this._reservePriority=t}startMotionPriority(t,e,i){return i==this._reservePriority&&(this._reservePriority=0),this._currentPriority=i,super.startMotion(t,e)}updateMotion(t,e){this._userTimeSeconds+=e;const i=super.doUpdateMotion(t,this._userTimeSeconds);return this.isFinished()&&(this._currentPriority=0),i}reserveMotion(t){return t<=this._reservePriority||t<=this._currentPriority?!1:(this._reservePriority=t,!0)}}var ps;(r=>{r.CubismMotionManager=vr})(ps||(ps={}));var xe=(r=>(r[r.CubismPhysicsTargetType_Parameter=0]="CubismPhysicsTargetType_Parameter",r))(xe||{}),ut=(r=>(r[r.CubismPhysicsSource_X=0]="CubismPhysicsSource_X",r[r.CubismPhysicsSource_Y=1]="CubismPhysicsSource_Y",r[r.CubismPhysicsSource_Angle=2]="CubismPhysicsSource_Angle",r))(ut||{});class bn{constructor(){this.gravity=new x(0,0),this.wind=new x(0,0)}}class ni{}class Je{}class Br{constructor(){this.initialPosition=new x(0,0),this.position=new x(0,0),this.lastPosition=new x(0,0),this.lastGravity=new x(0,0),this.force=new x(0,0),this.velocity=new x(0,0)}}class br{constructor(){this.normalizationPosition=new Je,this.normalizationAngle=new Je}}class Pr{constructor(){this.source=new ni}}class Vr{constructor(){this.destination=new ni,this.translationScale=new x(0,0)}}class Ir{constructor(){this.settings=new y,this.inputs=new y,this.outputs=new y,this.particles=new y,this.gravity=new x(0,0),this.wind=new x(0,0),this.fps=0}}var fs;(r=>{r.CubismPhysicsInput=Pr,r.CubismPhysicsNormalization=Je,r.CubismPhysicsOutput=Vr,r.CubismPhysicsParameter=ni,r.CubismPhysicsParticle=Br,r.CubismPhysicsRig=Ir,r.CubismPhysicsSource=ut,r.CubismPhysicsSubRig=br,r.CubismPhysicsTargetType=xe,r.PhysicsJsonEffectiveForces=bn})(fs||(fs={}));const Gt="Position",Le="X",De="Y",ke="Angle",ys="Type",Ss="Id",st="Meta",ce="EffectiveForces",Pn="TotalInputCount",Vn="TotalOutputCount",In="PhysicsSettingCount",Cs="Gravity",xs="Wind",wn="VertexCount",Tn="Fps",T="PhysicsSettings",Et="Normalization",Ms="Minimum",vs="Maximum",Bs="Default",bs="Reflect",Ps="Weight",$t="Input",Fn="Source",pt="Output",Rn="Scale",En="VertexIndex",An="Destination",ft="Vertices",Ln="Mobility",Dn="Delay",kn="Radius",On="Acceleration";class wr{constructor(t,e){this._json=N.create(t,e)}release(){N.delete(this._json)}getGravity(){const t=new x(0,0);return t.x=this._json.getRoot().getValueByString(st).getValueByString(ce).getValueByString(Cs).getValueByString(Le).toFloat(),t.y=this._json.getRoot().getValueByString(st).getValueByString(ce).getValueByString(Cs).getValueByString(De).toFloat(),t}getWind(){const t=new x(0,0);return t.x=this._json.getRoot().getValueByString(st).getValueByString(ce).getValueByString(xs).getValueByString(Le).toFloat(),t.y=this._json.getRoot().getValueByString(st).getValueByString(ce).getValueByString(xs).getValueByString(De).toFloat(),t}getFps(){return this._json.getRoot().getValueByString(st).getValueByString(Tn).toFloat(0)}getSubRigCount(){return this._json.getRoot().getValueByString(st).getValueByString(In).toInt()}getTotalInputCount(){return this._json.getRoot().getValueByString(st).getValueByString(Pn).toInt()}getTotalOutputCount(){return this._json.getRoot().getValueByString(st).getValueByString(Vn).toInt()}getVertexCount(){return this._json.getRoot().getValueByString(st).getValueByString(wn).toInt()}getNormalizationPositionMinimumValue(t){return this._json.getRoot().getValueByString(T).getValueByIndex(t).getValueByString(Et).getValueByString(Gt).getValueByString(Ms).toFloat()}getNormalizationPositionMaximumValue(t){return this._json.getRoot().getValueByString(T).getValueByIndex(t).getValueByString(Et).getValueByString(Gt).getValueByString(vs).toFloat()}getNormalizationPositionDefaultValue(t){return this._json.getRoot().getValueByString(T).getValueByIndex(t).getValueByString(Et).getValueByString(Gt).getValueByString(Bs).toFloat()}getNormalizationAngleMinimumValue(t){return this._json.getRoot().getValueByString(T).getValueByIndex(t).getValueByString(Et).getValueByString(ke).getValueByString(Ms).toFloat()}getNormalizationAngleMaximumValue(t){return this._json.getRoot().getValueByString(T).getValueByIndex(t).getValueByString(Et).getValueByString(ke).getValueByString(vs).toFloat()}getNormalizationAngleDefaultValue(t){return this._json.getRoot().getValueByString(T).getValueByIndex(t).getValueByString(Et).getValueByString(ke).getValueByString(Bs).toFloat()}getInputCount(t){return this._json.getRoot().getValueByString(T).getValueByIndex(t).getValueByString($t).getVector().getSize()}getInputWeight(t,e){return this._json.getRoot().getValueByString(T).getValueByIndex(t).getValueByString($t).getValueByIndex(e).getValueByString(Ps).toFloat()}getInputReflect(t,e){return this._json.getRoot().getValueByString(T).getValueByIndex(t).getValueByString($t).getValueByIndex(e).getValueByString(bs).toBoolean()}getInputType(t,e){return this._json.getRoot().getValueByString(T).getValueByIndex(t).getValueByString($t).getValueByIndex(e).getValueByString(ys).getRawString()}getInputSourceId(t,e){return w.getIdManager().getId(this._json.getRoot().getValueByString(T).getValueByIndex(t).getValueByString($t).getValueByIndex(e).getValueByString(Fn).getValueByString(Ss).getRawString())}getOutputCount(t){return this._json.getRoot().getValueByString(T).getValueByIndex(t).getValueByString(pt).getVector().getSize()}getOutputVertexIndex(t,e){return this._json.getRoot().getValueByString(T).getValueByIndex(t).getValueByString(pt).getValueByIndex(e).getValueByString(En).toInt()}getOutputAngleScale(t,e){return this._json.getRoot().getValueByString(T).getValueByIndex(t).getValueByString(pt).getValueByIndex(e).getValueByString(Rn).toFloat()}getOutputWeight(t,e){return this._json.getRoot().getValueByString(T).getValueByIndex(t).getValueByString(pt).getValueByIndex(e).getValueByString(Ps).toFloat()}getOutputDestinationId(t,e){return w.getIdManager().getId(this._json.getRoot().getValueByString(T).getValueByIndex(t).getValueByString(pt).getValueByIndex(e).getValueByString(An).getValueByString(Ss).getRawString())}getOutputType(t,e){return this._json.getRoot().getValueByString(T).getValueByIndex(t).getValueByString(pt).getValueByIndex(e).getValueByString(ys).getRawString()}getOutputReflect(t,e){return this._json.getRoot().getValueByString(T).getValueByIndex(t).getValueByString(pt).getValueByIndex(e).getValueByString(bs).toBoolean()}getParticleCount(t){return this._json.getRoot().getValueByString(T).getValueByIndex(t).getValueByString(ft).getVector().getSize()}getParticleMobility(t,e){return this._json.getRoot().getValueByString(T).getValueByIndex(t).getValueByString(ft).getValueByIndex(e).getValueByString(Ln).toFloat()}getParticleDelay(t,e){return this._json.getRoot().getValueByString(T).getValueByIndex(t).getValueByString(ft).getValueByIndex(e).getValueByString(Dn).toFloat()}getParticleAcceleration(t,e){return this._json.getRoot().getValueByString(T).getValueByIndex(t).getValueByString(ft).getValueByIndex(e).getValueByString(On).toFloat()}getParticleRadius(t,e){return this._json.getRoot().getValueByString(T).getValueByIndex(t).getValueByString(ft).getValueByIndex(e).getValueByString(kn).toFloat()}getParticlePosition(t,e){const i=new x(0,0);return i.x=this._json.getRoot().getValueByString(T).getValueByIndex(t).getValueByString(ft).getValueByIndex(e).getValueByString(Gt).getValueByString(Le).toFloat(),i.y=this._json.getRoot().getValueByString(T).getValueByIndex(t).getValueByString(ft).getValueByIndex(e).getValueByString(Gt).getValueByString(De).toFloat(),i}}var Vs;(r=>{r.CubismPhysicsJson=wr})(Vs||(Vs={}));const Is="X",ws="Y",Ts="Angle",Nn=5,Ke=100,Fs=.001,zn=5;class se{static create(t,e){const i=new se;return i.parse(t,e),i._physicsRig.gravity.y=0,i}static delete(t){t!=null&&(t.release(),t=null)}parse(t,e){this._physicsRig=new Ir;let i=new wr(t,e);this._physicsRig.gravity=i.getGravity(),this._physicsRig.wind=i.getWind(),this._physicsRig.subRigCount=i.getSubRigCount(),this._physicsRig.fps=i.getFps(),this._physicsRig.settings.updateSize(this._physicsRig.subRigCount,br,!0),this._physicsRig.inputs.updateSize(i.getTotalInputCount(),Pr,!0),this._physicsRig.outputs.updateSize(i.getTotalOutputCount(),Vr,!0),this._physicsRig.particles.updateSize(i.getVertexCount(),Br,!0),this._currentRigOutputs.clear(),this._previousRigOutputs.clear();let s=0,a=0,o=0;for(let n=0;n<this._physicsRig.settings.getSize();++n){this._physicsRig.settings.at(n).normalizationPosition.minimum=i.getNormalizationPositionMinimumValue(n),this._physicsRig.settings.at(n).normalizationPosition.maximum=i.getNormalizationPositionMaximumValue(n),this._physicsRig.settings.at(n).normalizationPosition.defalut=i.getNormalizationPositionDefaultValue(n),this._physicsRig.settings.at(n).normalizationAngle.minimum=i.getNormalizationAngleMinimumValue(n),this._physicsRig.settings.at(n).normalizationAngle.maximum=i.getNormalizationAngleMaximumValue(n),this._physicsRig.settings.at(n).normalizationAngle.defalut=i.getNormalizationAngleDefaultValue(n),this._physicsRig.settings.at(n).inputCount=i.getInputCount(n),this._physicsRig.settings.at(n).baseInputIndex=s;for(let h=0;h<this._physicsRig.settings.at(n).inputCount;++h)this._physicsRig.inputs.at(s+h).sourceParameterIndex=-1,this._physicsRig.inputs.at(s+h).weight=i.getInputWeight(n,h),this._physicsRig.inputs.at(s+h).reflect=i.getInputReflect(n,h),i.getInputType(n,h)==Is?(this._physicsRig.inputs.at(s+h).type=ut.CubismPhysicsSource_X,this._physicsRig.inputs.at(s+h).getNormalizedParameterValue=jn):i.getInputType(n,h)==ws?(this._physicsRig.inputs.at(s+h).type=ut.CubismPhysicsSource_Y,this._physicsRig.inputs.at(s+h).getNormalizedParameterValue=Xn):i.getInputType(n,h)==Ts&&(this._physicsRig.inputs.at(s+h).type=ut.CubismPhysicsSource_Angle,this._physicsRig.inputs.at(s+h).getNormalizedParameterValue=Yn),this._physicsRig.inputs.at(s+h).source.targetType=xe.CubismPhysicsTargetType_Parameter,this._physicsRig.inputs.at(s+h).source.id=i.getInputSourceId(n,h);s+=this._physicsRig.settings.at(n).inputCount,this._physicsRig.settings.at(n).outputCount=i.getOutputCount(n),this._physicsRig.settings.at(n).baseOutputIndex=a;const l=new Rs;l.outputs.resize(this._physicsRig.settings.at(n).outputCount);const u=new Rs;u.outputs.resize(this._physicsRig.settings.at(n).outputCount);for(let h=0;h<this._physicsRig.settings.at(n).outputCount;++h)l.outputs.set(h,0),u.outputs.set(h,0),this._physicsRig.outputs.at(a+h).destinationParameterIndex=-1,this._physicsRig.outputs.at(a+h).vertexIndex=i.getOutputVertexIndex(n,h),this._physicsRig.outputs.at(a+h).angleScale=i.getOutputAngleScale(n,h),this._physicsRig.outputs.at(a+h).weight=i.getOutputWeight(n,h),this._physicsRig.outputs.at(a+h).destination.targetType=xe.CubismPhysicsTargetType_Parameter,this._physicsRig.outputs.at(a+h).destination.id=i.getOutputDestinationId(n,h),i.getOutputType(n,h)==Is?(this._physicsRig.outputs.at(a+h).type=ut.CubismPhysicsSource_X,this._physicsRig.outputs.at(a+h).getValue=Gn,this._physicsRig.outputs.at(a+h).getScale=Jn):i.getOutputType(n,h)==ws?(this._physicsRig.outputs.at(a+h).type=ut.CubismPhysicsSource_Y,this._physicsRig.outputs.at(a+h).getValue=$n,this._physicsRig.outputs.at(a+h).getScale=Kn):i.getOutputType(n,h)==Ts&&(this._physicsRig.outputs.at(a+h).type=ut.CubismPhysicsSource_Angle,this._physicsRig.outputs.at(a+h).getValue=Hn,this._physicsRig.outputs.at(a+h).getScale=Zn),this._physicsRig.outputs.at(a+h).reflect=i.getOutputReflect(n,h);this._currentRigOutputs.pushBack(l),this._previousRigOutputs.pushBack(u),a+=this._physicsRig.settings.at(n).outputCount,this._physicsRig.settings.at(n).particleCount=i.getParticleCount(n),this._physicsRig.settings.at(n).baseParticleIndex=o;for(let h=0;h<this._physicsRig.settings.at(n).particleCount;++h)this._physicsRig.particles.at(o+h).mobility=i.getParticleMobility(n,h),this._physicsRig.particles.at(o+h).delay=i.getParticleDelay(n,h),this._physicsRig.particles.at(o+h).acceleration=i.getParticleAcceleration(n,h),this._physicsRig.particles.at(o+h).radius=i.getParticleRadius(n,h),this._physicsRig.particles.at(o+h).position=i.getParticlePosition(n,h);o+=this._physicsRig.settings.at(n).particleCount}this.initialize(),i.release(),i=void 0,i=null}stabilization(t){var f,m;let e,i,s,a;const o=new x;let n,l,u,h;const g=t.getModel().parameters.values,p=t.getModel().parameters.maximumValues,d=t.getModel().parameters.minimumValues,c=t.getModel().parameters.defaultValues;(((f=this._parameterCaches)==null?void 0:f.length)??0)<t.getParameterCount()&&(this._parameterCaches=new Float32Array(t.getParameterCount())),(((m=this._parameterInputCaches)==null?void 0:m.length)??0)<t.getParameterCount()&&(this._parameterInputCaches=new Float32Array(t.getParameterCount()));for(let C=0;C<t.getParameterCount();++C)this._parameterCaches[C]=g[C],this._parameterInputCaches[C]=g[C];for(let C=0;C<this._physicsRig.subRigCount;++C){e={angle:0},o.x=0,o.y=0,n=this._physicsRig.settings.at(C),l=this._physicsRig.inputs.get(n.baseInputIndex),u=this._physicsRig.outputs.get(n.baseOutputIndex),h=this._physicsRig.particles.get(n.baseParticleIndex);for(let S=0;S<n.inputCount;++S)i=l[S].weight/Ke,l[S].sourceParameterIndex==-1&&(l[S].sourceParameterIndex=t.getParameterIndex(l[S].source.id)),l[S].getNormalizedParameterValue(o,e,g[l[S].sourceParameterIndex],d[l[S].sourceParameterIndex],p[l[S].sourceParameterIndex],c[l[S].sourceParameterIndex],n.normalizationPosition,n.normalizationAngle,l[S].reflect,i),this._parameterCaches[l[S].sourceParameterIndex]=g[l[S].sourceParameterIndex];s=M.degreesToRadian(-e.angle),o.x=o.x*M.cos(s)-o.y*M.sin(s),o.y=o.x*M.sin(s)+o.y*M.cos(s),to(h,n.particleCount,o,e.angle,this._options.wind,Fs*n.normalizationPosition.maximum);for(let S=0;S<n.outputCount;++S){const v=u[S].vertexIndex;if(u[S].destinationParameterIndex==-1&&(u[S].destinationParameterIndex=t.getParameterIndex(u[S].destination.id)),v<1||v>=n.particleCount)continue;let B=new x;B=h[v].position.substract(h[v-1].position),a=u[S].getValue(B,h,v,u[S].reflect,this._options.gravity),this._currentRigOutputs.at(C).outputs.set(S,a),this._previousRigOutputs.at(C).outputs.set(S,a);const V=u[S].destinationParameterIndex,b=!Float32Array.prototype.slice&&"subarray"in Float32Array.prototype?JSON.parse(JSON.stringify(g.subarray(V))):g.slice(V);Oe(b,d[V],p[V],a,u[S]);for(let O=V,Z=0;O<this._parameterCaches.length;O++,Z++)g[O]=this._parameterCaches[O]=b[Z]}}}evaluate(t,e){var S,v;let i,s,a,o;const n=new x;let l,u,h,g;if(0>=e)return;const p=t.getModel().parameters.values,d=t.getModel().parameters.maximumValues,c=t.getModel().parameters.minimumValues,f=t.getModel().parameters.defaultValues;let m;if(this._currentRemainTime+=e,this._currentRemainTime>zn&&(this._currentRemainTime=0),(((S=this._parameterCaches)==null?void 0:S.length)??0)<t.getParameterCount()&&(this._parameterCaches=new Float32Array(t.getParameterCount())),(((v=this._parameterInputCaches)==null?void 0:v.length)??0)<t.getParameterCount()){this._parameterInputCaches=new Float32Array(t.getParameterCount());for(let B=0;B<t.getParameterCount();++B)this._parameterInputCaches[B]=p[B]}for(this._physicsRig.fps>0?m=1/this._physicsRig.fps:m=e;this._currentRemainTime>=m;){for(let V=0;V<this._physicsRig.subRigCount;++V){l=this._physicsRig.settings.at(V),h=this._physicsRig.outputs.get(l.baseOutputIndex);for(let b=0;b<l.outputCount;++b)this._previousRigOutputs.at(V).outputs.set(b,this._currentRigOutputs.at(V).outputs.at(b))}const B=m/this._currentRemainTime;for(let V=0;V<t.getParameterCount();++V)this._parameterCaches[V]=this._parameterInputCaches[V]*(1-B)+p[V]*B,this._parameterInputCaches[V]=this._parameterCaches[V];for(let V=0;V<this._physicsRig.subRigCount;++V){i={angle:0},n.x=0,n.y=0,l=this._physicsRig.settings.at(V),u=this._physicsRig.inputs.get(l.baseInputIndex),h=this._physicsRig.outputs.get(l.baseOutputIndex),g=this._physicsRig.particles.get(l.baseParticleIndex);for(let b=0;b<l.inputCount;++b)s=u[b].weight/Ke,u[b].sourceParameterIndex==-1&&(u[b].sourceParameterIndex=t.getParameterIndex(u[b].source.id)),u[b].getNormalizedParameterValue(n,i,this._parameterCaches[u[b].sourceParameterIndex],c[u[b].sourceParameterIndex],d[u[b].sourceParameterIndex],f[u[b].sourceParameterIndex],l.normalizationPosition,l.normalizationAngle,u[b].reflect,s);a=M.degreesToRadian(-i.angle),n.x=n.x*M.cos(a)-n.y*M.sin(a),n.y=n.x*M.sin(a)+n.y*M.cos(a),Qn(g,l.particleCount,n,i.angle,this._options.wind,Fs*l.normalizationPosition.maximum,m,Nn);for(let b=0;b<l.outputCount;++b){const O=h[b].vertexIndex;if(h[b].destinationParameterIndex==-1&&(h[b].destinationParameterIndex=t.getParameterIndex(h[b].destination.id)),O<1||O>=l.particleCount)continue;const Z=new x;Z.x=g[O].position.x-g[O-1].position.x,Z.y=g[O].position.y-g[O-1].position.y,o=h[b].getValue(Z,g,O,h[b].reflect,this._options.gravity),this._currentRigOutputs.at(V).outputs.set(b,o);const vt=h[b].destinationParameterIndex,Bt=!Float32Array.prototype.slice&&"subarray"in Float32Array.prototype?JSON.parse(JSON.stringify(this._parameterCaches.subarray(vt))):this._parameterCaches.slice(vt);Oe(Bt,c[vt],d[vt],o,h[b]);for(let bt=vt,Xt=0;bt<this._parameterCaches.length;bt++,Xt++)this._parameterCaches[bt]=Bt[Xt]}}this._currentRemainTime-=m}const C=this._currentRemainTime/m;this.interpolate(t,C)}interpolate(t,e){let i,s;const a=t.getModel().parameters.values,o=t.getModel().parameters.maximumValues,n=t.getModel().parameters.minimumValues;for(let l=0;l<this._physicsRig.subRigCount;++l){s=this._physicsRig.settings.at(l),i=this._physicsRig.outputs.get(s.baseOutputIndex);for(let u=0;u<s.outputCount;++u){if(i[u].destinationParameterIndex==-1)continue;const h=i[u].destinationParameterIndex,g=!Float32Array.prototype.slice&&"subarray"in Float32Array.prototype?JSON.parse(JSON.stringify(a.subarray(h))):a.slice(h);Oe(g,n[h],o[h],this._previousRigOutputs.at(l).outputs.at(u)*(1-e)+this._currentRigOutputs.at(l).outputs.at(u)*e,i[u]);for(let p=h,d=0;p<a.length;p++,d++)a[p]=g[d]}}}setOptions(t){this._options=t}getOption(){return this._options}constructor(){this._physicsRig=null,this._options=new Tr,this._options.gravity.y=-1,this._options.gravity.x=0,this._options.wind.x=0,this._options.wind.y=0,this._currentRigOutputs=new y,this._previousRigOutputs=new y,this._currentRemainTime=0,this._parameterCaches=null,this._parameterInputCaches=null}release(){this._physicsRig=void 0,this._physicsRig=null}initialize(){let t,e,i;for(let s=0;s<this._physicsRig.subRigCount;++s){e=this._physicsRig.settings.at(s),t=this._physicsRig.particles.get(e.baseParticleIndex),t[0].initialPosition=new x(0,0),t[0].lastPosition=new x(t[0].initialPosition.x,t[0].initialPosition.y),t[0].lastGravity=new x(0,-1),t[0].lastGravity.y*=-1,t[0].velocity=new x(0,0),t[0].force=new x(0,0);for(let a=1;a<e.particleCount;++a)i=new x(0,0),i.y=t[a].radius,t[a].initialPosition=new x(t[a-1].initialPosition.x+i.x,t[a-1].initialPosition.y+i.y),t[a].position=new x(t[a].initialPosition.x,t[a].initialPosition.y),t[a].lastPosition=new x(t[a].initialPosition.x,t[a].initialPosition.y),t[a].lastGravity=new x(0,-1),t[a].lastGravity.y*=-1,t[a].velocity=new x(0,0),t[a].force=new x(0,0)}}}class Tr{constructor(){this.gravity=new x(0,0),this.wind=new x(0,0)}}class Rs{constructor(){this.outputs=new y(0)}}function Un(r){let t=0;return r>0?t=1:r<0&&(t=-1),t}function jn(r,t,e,i,s,a,o,n,l,u){r.x+=oi(e,i,s,a,o.minimum,o.maximum,o.defalut,l)*u}function Xn(r,t,e,i,s,a,o,n,l,u){r.y+=oi(e,i,s,a,o.minimum,o.maximum,o.defalut,l)*u}function Yn(r,t,e,i,s,a,o,n,l,u){t.angle+=oi(e,i,s,a,n.minimum,n.maximum,n.defalut,l)*u}function Gn(r,t,e,i,s){let a=r.x;return i&&(a*=-1),a}function $n(r,t,e,i,s){let a=r.y;return i&&(a*=-1),a}function Hn(r,t,e,i,s){let a;return e>=2?s=t[e-1].position.substract(t[e-2].position):s=s.multiplyByScaler(-1),a=M.directionToRadian(s,r),i&&(a*=-1),a}function Wn(r,t){const e=M.max(r,t),i=M.min(r,t);return M.abs(e-i)}function qn(r,t){return M.min(r,t)+Wn(r,t)/2}function Jn(r,t){return JSON.parse(JSON.stringify(r.x))}function Kn(r,t){return JSON.parse(JSON.stringify(r.y))}function Zn(r,t){return JSON.parse(JSON.stringify(t))}function Qn(r,t,e,i,s,a,o,n){let l,u,h=new x(0,0),g=new x(0,0),p=new x(0,0),d=new x(0,0);r[0].position=new x(e.x,e.y);const c=M.degreesToRadian(i),f=M.radianToDirection(c);f.normalize();for(let m=1;m<t;++m)r[m].force=f.multiplyByScaler(r[m].acceleration).add(s),r[m].lastPosition=new x(r[m].position.x,r[m].position.y),l=r[m].delay*o*30,h=r[m].position.substract(r[m-1].position),u=M.directionToRadian(r[m].lastGravity,f)/n,h.x=M.cos(u)*h.x-h.y*M.sin(u),h.y=M.sin(u)*h.x+h.y*M.cos(u),r[m].position=r[m-1].position.add(h),g=r[m].velocity.multiplyByScaler(l),p=r[m].force.multiplyByScaler(l).multiplyByScaler(l),r[m].position=r[m].position.add(g).add(p),d=r[m].position.substract(r[m-1].position),d.normalize(),r[m].position=r[m-1].position.add(d.multiplyByScaler(r[m].radius)),M.abs(r[m].position.x)<a&&(r[m].position.x=0),l!=0&&(r[m].velocity=r[m].position.substract(r[m].lastPosition),r[m].velocity=r[m].velocity.divisionByScalar(l),r[m].velocity=r[m].velocity.multiplyByScaler(r[m].mobility)),r[m].force=new x(0,0),r[m].lastGravity=new x(f.x,f.y)}function to(r,t,e,i,s,a){let o=new x(0,0);r[0].position=new x(e.x,e.y);const n=M.degreesToRadian(i),l=M.radianToDirection(n);l.normalize();for(let u=1;u<t;++u)r[u].force=l.multiplyByScaler(r[u].acceleration).add(s),r[u].lastPosition=new x(r[u].position.x,r[u].position.y),r[u].velocity=new x(0,0),o=r[u].force,o.normalize(),o=o.multiplyByScaler(r[u].radius),r[u].position=r[u-1].position.add(o),M.abs(r[u].position.x)<a&&(r[u].position.x=0),r[u].force=new x(0,0),r[u].lastGravity=new x(l.x,l.y)}function Oe(r,t,e,i,s){let a;const o=s.getScale(s.translationScale,s.angleScale);a=i*o,a<t?(a<s.valueBelowMinimum&&(s.valueBelowMinimum=a),a=t):a>e&&(a>s.valueExceededMaximum&&(s.valueExceededMaximum=a),a=e);const n=s.weight/Ke;n>=1||(a=r[0]*(1-n)+a*n),r[0]=a}function oi(r,t,e,i,s,a,o,n){let l=0;const u=M.max(e,t);u<r&&(r=u);const h=M.min(e,t);h>r&&(r=h);const g=M.min(s,a),p=M.max(s,a),d=o,c=qn(h,u),f=r-c;switch(Un(f)){case 1:{const m=p-d,C=u-c;C!=0&&(l=f*(m/C),l+=d);break}case-1:{const m=g-d,C=h-c;C!=0&&(l=f*(m/C),l+=d);break}case 0:{l=d;break}}return n?l:l*-1}var Es;(r=>{r.CubismPhysics=se,r.Options=Tr})(Es||(Es={}));const Ne=4,eo=36,io=32;class so{constructor(t){this._renderTextureCount=0,this._clippingMaskBufferSize=256,this._clippingContextListForMask=new y,this._clippingContextListForDraw=new y,this._channelColors=new y,this._tmpBoundsOnModel=new me,this._tmpMatrix=new L,this._tmpMatrixForMask=new L,this._tmpMatrixForDraw=new L,this._clippingContexttConstructor=t;let e=new j;e.r=1,e.g=0,e.b=0,e.a=0,this._channelColors.pushBack(e),e=new j,e.r=0,e.g=1,e.b=0,e.a=0,this._channelColors.pushBack(e),e=new j,e.r=0,e.g=0,e.b=1,e.a=0,this._channelColors.pushBack(e),e=new j,e.r=0,e.g=0,e.b=0,e.a=1,this._channelColors.pushBack(e)}release(){for(let t=0;t<this._clippingContextListForMask.getSize();t++)this._clippingContextListForMask.at(t)&&(this._clippingContextListForMask.at(t).release(),this._clippingContextListForMask.set(t,void 0)),this._clippingContextListForMask.set(t,null);this._clippingContextListForMask=null;for(let t=0;t<this._clippingContextListForDraw.getSize();t++)this._clippingContextListForDraw.set(t,null);this._clippingContextListForDraw=null;for(let t=0;t<this._channelColors.getSize();t++)this._channelColors.set(t,null);this._channelColors=null,this._clearedFrameBufferFlags!=null&&this._clearedFrameBufferFlags.clear(),this._clearedFrameBufferFlags=null}initialize(t,e){e%1!=0&&(D("The number of render textures must be specified as an integer. The decimal point is rounded down and corrected to an integer."),e=~~e),e<1&&D("The number of render textures must be an integer greater than or equal to 1. Set the number of render textures to 1."),this._renderTextureCount=e<1?1:e,this._clearedFrameBufferFlags=new y(this._renderTextureCount);for(let i=0;i<t.getDrawableCount();i++){if(t.getDrawableMaskCounts()[i]<=0){this._clippingContextListForDraw.pushBack(null);continue}let s=this.findSameClip(t.getDrawableMasks()[i],t.getDrawableMaskCounts()[i]);s==null&&(s=new this._clippingContexttConstructor(this,t.getDrawableMasks()[i],t.getDrawableMaskCounts()[i]),this._clippingContextListForMask.pushBack(s)),s.addClippedDrawable(i),this._clippingContextListForDraw.pushBack(s)}}findSameClip(t,e){for(let i=0;i<this._clippingContextListForMask.getSize();i++){const s=this._clippingContextListForMask.at(i),a=s._clippingIdCount;if(a!=e)continue;let o=0;for(let n=0;n<a;n++){const l=s._clippingIdList[n];for(let u=0;u<a;u++)if(t[u]==l){o++;break}}if(o==a)return s}return null}setupMatrixForHighPrecision(t,e){let i=0;for(let s=0;s<this._clippingContextListForMask.getSize();s++){const a=this._clippingContextListForMask.at(s);this.calcClippedDrawTotalBounds(t,a),a._isUsing&&i++}if(i>0){if(this.setupLayoutBounds(0),this._clearedFrameBufferFlags.getSize()!=this._renderTextureCount){this._clearedFrameBufferFlags.clear();for(let s=0;s<this._renderTextureCount;s++)this._clearedFrameBufferFlags.pushBack(!1)}else for(let s=0;s<this._renderTextureCount;s++)this._clearedFrameBufferFlags.set(s,!1);for(let s=0;s<this._clippingContextListForMask.getSize();s++){const a=this._clippingContextListForMask.at(s),o=a._allClippedDrawRect,n=a._layoutBounds,l=.05;let u=0,h=0;const g=t.getPixelsPerUnit(),p=a.getClippingManager().getClippingMaskBufferSize(),d=n.width*p,c=n.height*p;this._tmpBoundsOnModel.setRect(o),this._tmpBoundsOnModel.width*g>d?(this._tmpBoundsOnModel.expand(o.width*l,0),u=n.width/this._tmpBoundsOnModel.width):u=g/d,this._tmpBoundsOnModel.height*g>c?(this._tmpBoundsOnModel.expand(0,o.height*l),h=n.height/this._tmpBoundsOnModel.height):h=g/c,this.createMatrixForMask(e,n,u,h),a._matrixForMask.setMatrix(this._tmpMatrixForMask.getArray()),a._matrixForDraw.setMatrix(this._tmpMatrixForDraw.getArray())}}}createMatrixForMask(t,e,i,s){this._tmpMatrix.loadIdentity(),this._tmpMatrix.translateRelative(-1,-1),this._tmpMatrix.scaleRelative(2,2),this._tmpMatrix.translateRelative(e.x,e.y),this._tmpMatrix.scaleRelative(i,s),this._tmpMatrix.translateRelative(-this._tmpBoundsOnModel.x,-this._tmpBoundsOnModel.y),this._tmpMatrixForMask.setMatrix(this._tmpMatrix.getArray()),this._tmpMatrix.loadIdentity(),this._tmpMatrix.translateRelative(e.x,e.y*(t?-1:1)),this._tmpMatrix.scaleRelative(i,s*(t?-1:1)),this._tmpMatrix.translateRelative(-this._tmpBoundsOnModel.x,-this._tmpBoundsOnModel.y),this._tmpMatrixForDraw.setMatrix(this._tmpMatrix.getArray())}setupLayoutBounds(t){const e=this._renderTextureCount<=1?eo:io*this._renderTextureCount;if(t<=0||t>e){t>e&&P(`not supported mask count : {0}
[Details] render texture count : {1}, mask count : {2}`,t-e,this._renderTextureCount,t);for(let u=0;u<this._clippingContextListForMask.getSize();u++){const h=this._clippingContextListForMask.at(u);h._layoutChannelIndex=0,h._layoutBounds.x=0,h._layoutBounds.y=0,h._layoutBounds.width=1,h._layoutBounds.height=1,h._bufferIndex=0}return}const i=this._renderTextureCount<=1?9:8;let s=t/this._renderTextureCount;const a=t%this._renderTextureCount;s=Math.ceil(s);let o=s/Ne;const n=s%Ne;o=~~o;let l=0;for(let u=0;u<this._renderTextureCount;u++)for(let h=0;h<Ne;h++){let g=o+(h<n?1:0);const p=n+(o<1?-1:0);if(h==p&&a>0&&(g-=u<a?0:1),g!=0)if(g==1){const d=this._clippingContextListForMask.at(l++);d._layoutChannelIndex=h,d._layoutBounds.x=0,d._layoutBounds.y=0,d._layoutBounds.width=1,d._layoutBounds.height=1,d._bufferIndex=u}else if(g==2)for(let d=0;d<g;d++){let c=d%2;c=~~c;const f=this._clippingContextListForMask.at(l++);f._layoutChannelIndex=h,f._layoutBounds.x=c*.5,f._layoutBounds.y=0,f._layoutBounds.width=.5,f._layoutBounds.height=1,f._bufferIndex=u}else if(g<=4)for(let d=0;d<g;d++){let c=d%2,f=d/2;c=~~c,f=~~f;const m=this._clippingContextListForMask.at(l++);m._layoutChannelIndex=h,m._layoutBounds.x=c*.5,m._layoutBounds.y=f*.5,m._layoutBounds.width=.5,m._layoutBounds.height=.5,m._bufferIndex=u}else if(g<=i)for(let d=0;d<g;d++){let c=d%3,f=d/3;c=~~c,f=~~f;const m=this._clippingContextListForMask.at(l++);m._layoutChannelIndex=h,m._layoutBounds.x=c/3,m._layoutBounds.y=f/3,m._layoutBounds.width=1/3,m._layoutBounds.height=1/3,m._bufferIndex=u}else{P(`not supported mask count : {0}
[Details] render texture count : {1}, mask count : {2}`,t-e,this._renderTextureCount,t);for(let d=0;d<g;d++){const c=this._clippingContextListForMask.at(l++);c._layoutChannelIndex=0,c._layoutBounds.x=0,c._layoutBounds.y=0,c._layoutBounds.width=1,c._layoutBounds.height=1,c._bufferIndex=0}}}}calcClippedDrawTotalBounds(t,e){let i=Number.MAX_VALUE,s=Number.MAX_VALUE,a=Number.MIN_VALUE,o=Number.MIN_VALUE;const n=e._clippedDrawableIndexList.length;for(let l=0;l<n;l++){const u=e._clippedDrawableIndexList[l],h=t.getDrawableVertexCount(u),g=t.getDrawableVertices(u);let p=Number.MAX_VALUE,d=Number.MAX_VALUE,c=-Number.MAX_VALUE,f=-Number.MAX_VALUE;const m=h*ht.vertexStep;for(let C=ht.vertexOffset;C<m;C+=ht.vertexStep){const S=g[C],v=g[C+1];S<p&&(p=S),S>c&&(c=S),v<d&&(d=v),v>f&&(f=v)}if(p!=Number.MAX_VALUE)if(p<i&&(i=p),d<s&&(s=d),c>a&&(a=c),f>o&&(o=f),i==Number.MAX_VALUE)e._allClippedDrawRect.x=0,e._allClippedDrawRect.y=0,e._allClippedDrawRect.width=0,e._allClippedDrawRect.height=0,e._isUsing=!1;else{e._isUsing=!0;const C=a-i,S=o-s;e._allClippedDrawRect.x=i,e._allClippedDrawRect.y=s,e._allClippedDrawRect.width=C,e._allClippedDrawRect.height=S}}}getClippingContextListForDraw(){return this._clippingContextListForDraw}getClippingMaskBufferSize(){return this._clippingMaskBufferSize}getRenderTextureCount(){return this._renderTextureCount}getChannelFlagAsColor(t){return this._channelColors.at(t)}setClippingMaskBufferSize(t){this._clippingMaskBufferSize=t}}let yt;const ro=10;class xt{static getInstance(){return yt==null&&(yt=new xt),yt}static deleteInstance(){yt&&(yt.release(),yt=null)}constructor(){this._shaderSets=new y}release(){this.releaseShaderProgram()}setupShaderProgramForDraw(t,e,i){t.isPremultipliedAlpha()||P("NoPremultipliedAlpha is not allowed"),this._shaderSets.getSize()==0&&this.generateShaders();let s,a,o,n;const l=t.getClippingContextBufferForDraw()!=null,u=e.getDrawableInvertedMaskBit(i),h=l?u?2:1:0;let g;switch(e.getDrawableBlendMode(i)){case ct.CubismBlendMode_Normal:default:g=this._shaderSets.at(1+h),s=this.gl.ONE,a=this.gl.ONE_MINUS_SRC_ALPHA,o=this.gl.ONE,n=this.gl.ONE_MINUS_SRC_ALPHA;break;case ct.CubismBlendMode_Additive:g=this._shaderSets.at(4+h),s=this.gl.ONE,a=this.gl.ONE,o=this.gl.ZERO,n=this.gl.ONE;break;case ct.CubismBlendMode_Multiplicative:g=this._shaderSets.at(7+h),s=this.gl.DST_COLOR,a=this.gl.ONE_MINUS_SRC_ALPHA,o=this.gl.ZERO,n=this.gl.ONE;break}this.gl.useProgram(g.shaderProgram),t._bufferData.vertex==null&&(t._bufferData.vertex=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t._bufferData.vertex);const p=e.getDrawableVertices(i);this.gl.bufferData(this.gl.ARRAY_BUFFER,p,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(g.attributePositionLocation),this.gl.vertexAttribPointer(g.attributePositionLocation,2,this.gl.FLOAT,!1,0,0),t._bufferData.uv==null&&(t._bufferData.uv=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t._bufferData.uv);const d=e.getDrawableVertexUvs(i);if(this.gl.bufferData(this.gl.ARRAY_BUFFER,d,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(g.attributeTexCoordLocation),this.gl.vertexAttribPointer(g.attributeTexCoordLocation,2,this.gl.FLOAT,!1,0,0),l){this.gl.activeTexture(this.gl.TEXTURE1);const V=t.getClippingContextBufferForDraw().getClippingManager().getColorBuffer().at(t.getClippingContextBufferForDraw()._bufferIndex);this.gl.bindTexture(this.gl.TEXTURE_2D,V),this.gl.uniform1i(g.samplerTexture1Location,1),this.gl.uniformMatrix4fv(g.uniformClipMatrixLocation,!1,t.getClippingContextBufferForDraw()._matrixForDraw.getArray());const b=t.getClippingContextBufferForDraw()._layoutChannelIndex,O=t.getClippingContextBufferForDraw().getClippingManager().getChannelFlagAsColor(b);this.gl.uniform4f(g.uniformChannelFlagLocation,O.r,O.g,O.b,O.a)}const c=e.getDrawableTextureIndex(i),f=t.getBindedTextures().getValue(c);this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,f),this.gl.uniform1i(g.samplerTexture0Location,0);const m=t.getMvpMatrix();this.gl.uniformMatrix4fv(g.uniformMatrixLocation,!1,m.getArray());const C=t.getModelColorWithOpacity(e.getDrawableOpacity(i)),S=e.getMultiplyColor(i),v=e.getScreenColor(i);this.gl.uniform4f(g.uniformBaseColorLocation,C.r,C.g,C.b,C.a),this.gl.uniform4f(g.uniformMultiplyColorLocation,S.r,S.g,S.b,S.a),this.gl.uniform4f(g.uniformScreenColorLocation,v.r,v.g,v.b,v.a),t._bufferData.index==null&&(t._bufferData.index=this.gl.createBuffer());const B=e.getDrawableVertexIndices(i);this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,t._bufferData.index),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,B,this.gl.DYNAMIC_DRAW),this.gl.blendFuncSeparate(s,a,o,n)}setupShaderProgramForMask(t,e,i){t.isPremultipliedAlpha()||P("NoPremultipliedAlpha is not allowed"),this._shaderSets.getSize()==0&&this.generateShaders();const s=this._shaderSets.at(0);this.gl.useProgram(s.shaderProgram),t._bufferData.vertex==null&&(t._bufferData.vertex=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t._bufferData.vertex);const a=e.getDrawableVertices(i);this.gl.bufferData(this.gl.ARRAY_BUFFER,a,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(s.attributePositionLocation),this.gl.vertexAttribPointer(s.attributePositionLocation,2,this.gl.FLOAT,!1,0,0),t._bufferData.uv==null&&(t._bufferData.uv=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t._bufferData.uv);const o=e.getDrawableTextureIndex(i),n=t.getBindedTextures().getValue(o);this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,n),this.gl.uniform1i(s.samplerTexture0Location,0),t._bufferData.uv==null&&(t._bufferData.uv=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t._bufferData.uv);const l=e.getDrawableVertexUvs(i);this.gl.bufferData(this.gl.ARRAY_BUFFER,l,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(s.attributeTexCoordLocation),this.gl.vertexAttribPointer(s.attributeTexCoordLocation,2,this.gl.FLOAT,!1,0,0),t.getClippingContextBufferForMask();const u=t.getClippingContextBufferForMask()._layoutChannelIndex,h=t.getClippingContextBufferForMask().getClippingManager().getChannelFlagAsColor(u);this.gl.uniform4f(s.uniformChannelFlagLocation,h.r,h.g,h.b,h.a),this.gl.uniformMatrix4fv(s.uniformClipMatrixLocation,!1,t.getClippingContextBufferForMask()._matrixForMask.getArray());const g=t.getClippingContextBufferForMask()._layoutBounds;this.gl.uniform4f(s.uniformBaseColorLocation,g.x*2-1,g.y*2-1,g.getRight()*2-1,g.getBottom()*2-1);const p=e.getMultiplyColor(i),d=e.getScreenColor(i);this.gl.uniform4f(s.uniformMultiplyColorLocation,p.r,p.g,p.b,p.a),this.gl.uniform4f(s.uniformScreenColorLocation,d.r,d.g,d.b,d.a);const c=this.gl.ZERO,f=this.gl.ONE_MINUS_SRC_COLOR,m=this.gl.ZERO,C=this.gl.ONE_MINUS_SRC_ALPHA;t._bufferData.index==null&&(t._bufferData.index=this.gl.createBuffer());const S=e.getDrawableVertexIndices(i);this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,t._bufferData.index),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,S,this.gl.DYNAMIC_DRAW),this.gl.blendFuncSeparate(c,f,m,C)}releaseShaderProgram(){for(let t=0;t<this._shaderSets.getSize();t++)this.gl.deleteProgram(this._shaderSets.at(t).shaderProgram),this._shaderSets.at(t).shaderProgram=0,this._shaderSets.set(t,void 0),this._shaderSets.set(t,null)}generateShaders(){for(let t=0;t<ro;t++)this._shaderSets.pushBack(new Fr);this._shaderSets.at(0).shaderProgram=this.loadShaderProgram(ao,no),this._shaderSets.at(1).shaderProgram=this.loadShaderProgram(oo,lo),this._shaderSets.at(2).shaderProgram=this.loadShaderProgram(As,uo),this._shaderSets.at(3).shaderProgram=this.loadShaderProgram(As,ho),this._shaderSets.at(4).shaderProgram=this._shaderSets.at(1).shaderProgram,this._shaderSets.at(5).shaderProgram=this._shaderSets.at(2).shaderProgram,this._shaderSets.at(6).shaderProgram=this._shaderSets.at(3).shaderProgram,this._shaderSets.at(7).shaderProgram=this._shaderSets.at(1).shaderProgram,this._shaderSets.at(8).shaderProgram=this._shaderSets.at(2).shaderProgram,this._shaderSets.at(9).shaderProgram=this._shaderSets.at(3).shaderProgram,this._shaderSets.at(0).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(0).shaderProgram,"a_position"),this._shaderSets.at(0).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(0).shaderProgram,"a_texCoord"),this._shaderSets.at(0).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"s_texture0"),this._shaderSets.at(0).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_clipMatrix"),this._shaderSets.at(0).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_channelFlag"),this._shaderSets.at(0).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_baseColor"),this._shaderSets.at(0).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_multiplyColor"),this._shaderSets.at(0).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_screenColor"),this._shaderSets.at(1).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(1).shaderProgram,"a_position"),this._shaderSets.at(1).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(1).shaderProgram,"a_texCoord"),this._shaderSets.at(1).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"s_texture0"),this._shaderSets.at(1).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"u_matrix"),this._shaderSets.at(1).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"u_baseColor"),this._shaderSets.at(1).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"u_multiplyColor"),this._shaderSets.at(1).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"u_screenColor"),this._shaderSets.at(2).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(2).shaderProgram,"a_position"),this._shaderSets.at(2).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(2).shaderProgram,"a_texCoord"),this._shaderSets.at(2).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"s_texture0"),this._shaderSets.at(2).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"s_texture1"),this._shaderSets.at(2).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_matrix"),this._shaderSets.at(2).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_clipMatrix"),this._shaderSets.at(2).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_channelFlag"),this._shaderSets.at(2).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_baseColor"),this._shaderSets.at(2).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_multiplyColor"),this._shaderSets.at(2).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_screenColor"),this._shaderSets.at(3).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(3).shaderProgram,"a_position"),this._shaderSets.at(3).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(3).shaderProgram,"a_texCoord"),this._shaderSets.at(3).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"s_texture0"),this._shaderSets.at(3).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"s_texture1"),this._shaderSets.at(3).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_matrix"),this._shaderSets.at(3).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_clipMatrix"),this._shaderSets.at(3).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_channelFlag"),this._shaderSets.at(3).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_baseColor"),this._shaderSets.at(3).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_multiplyColor"),this._shaderSets.at(3).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_screenColor"),this._shaderSets.at(4).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(4).shaderProgram,"a_position"),this._shaderSets.at(4).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(4).shaderProgram,"a_texCoord"),this._shaderSets.at(4).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"s_texture0"),this._shaderSets.at(4).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"u_matrix"),this._shaderSets.at(4).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"u_baseColor"),this._shaderSets.at(4).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"u_multiplyColor"),this._shaderSets.at(4).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"u_screenColor"),this._shaderSets.at(5).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(5).shaderProgram,"a_position"),this._shaderSets.at(5).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(5).shaderProgram,"a_texCoord"),this._shaderSets.at(5).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"s_texture0"),this._shaderSets.at(5).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"s_texture1"),this._shaderSets.at(5).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_matrix"),this._shaderSets.at(5).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_clipMatrix"),this._shaderSets.at(5).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_channelFlag"),this._shaderSets.at(5).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_baseColor"),this._shaderSets.at(5).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_multiplyColor"),this._shaderSets.at(5).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_screenColor"),this._shaderSets.at(6).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(6).shaderProgram,"a_position"),this._shaderSets.at(6).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(6).shaderProgram,"a_texCoord"),this._shaderSets.at(6).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"s_texture0"),this._shaderSets.at(6).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"s_texture1"),this._shaderSets.at(6).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_matrix"),this._shaderSets.at(6).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_clipMatrix"),this._shaderSets.at(6).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_channelFlag"),this._shaderSets.at(6).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_baseColor"),this._shaderSets.at(6).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_multiplyColor"),this._shaderSets.at(6).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_screenColor"),this._shaderSets.at(7).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(7).shaderProgram,"a_position"),this._shaderSets.at(7).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(7).shaderProgram,"a_texCoord"),this._shaderSets.at(7).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"s_texture0"),this._shaderSets.at(7).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"u_matrix"),this._shaderSets.at(7).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"u_baseColor"),this._shaderSets.at(7).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"u_multiplyColor"),this._shaderSets.at(7).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"u_screenColor"),this._shaderSets.at(8).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(8).shaderProgram,"a_position"),this._shaderSets.at(8).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(8).shaderProgram,"a_texCoord"),this._shaderSets.at(8).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"s_texture0"),this._shaderSets.at(8).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"s_texture1"),this._shaderSets.at(8).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_matrix"),this._shaderSets.at(8).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_clipMatrix"),this._shaderSets.at(8).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_channelFlag"),this._shaderSets.at(8).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_baseColor"),this._shaderSets.at(8).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_multiplyColor"),this._shaderSets.at(8).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_screenColor"),this._shaderSets.at(9).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(9).shaderProgram,"a_position"),this._shaderSets.at(9).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(9).shaderProgram,"a_texCoord"),this._shaderSets.at(9).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"s_texture0"),this._shaderSets.at(9).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"s_texture1"),this._shaderSets.at(9).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_matrix"),this._shaderSets.at(9).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_clipMatrix"),this._shaderSets.at(9).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_channelFlag"),this._shaderSets.at(9).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_baseColor"),this._shaderSets.at(9).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_multiplyColor"),this._shaderSets.at(9).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_screenColor")}loadShaderProgram(t,e){let i=this.gl.createProgram(),s=this.compileShaderSource(this.gl.VERTEX_SHADER,t);if(!s)return P("Vertex shader compile error!"),0;let a=this.compileShaderSource(this.gl.FRAGMENT_SHADER,e);return a?(this.gl.attachShader(i,s),this.gl.attachShader(i,a),this.gl.linkProgram(i),this.gl.getProgramParameter(i,this.gl.LINK_STATUS)?(this.gl.deleteShader(s),this.gl.deleteShader(a),i):(P("Failed to link program: {0}",i),this.gl.deleteShader(s),s=0,this.gl.deleteShader(a),a=0,i&&(this.gl.deleteProgram(i),i=0),0)):(P("Vertex shader compile error!"),0)}compileShaderSource(t,e){const i=e,s=this.gl.createShader(t);if(this.gl.shaderSource(s,i),this.gl.compileShader(s),!s){const o=this.gl.getShaderInfoLog(s);P("Shader compile log: {0} ",o)}return this.gl.getShaderParameter(s,this.gl.COMPILE_STATUS)?s:(this.gl.deleteShader(s),null)}setGl(t){this.gl=t}}class Fr{}var Rr=(r=>(r[r.ShaderNames_SetupMask=0]="ShaderNames_SetupMask",r[r.ShaderNames_NormalPremultipliedAlpha=1]="ShaderNames_NormalPremultipliedAlpha",r[r.ShaderNames_NormalMaskedPremultipliedAlpha=2]="ShaderNames_NormalMaskedPremultipliedAlpha",r[r.ShaderNames_NomralMaskedInvertedPremultipliedAlpha=3]="ShaderNames_NomralMaskedInvertedPremultipliedAlpha",r[r.ShaderNames_AddPremultipliedAlpha=4]="ShaderNames_AddPremultipliedAlpha",r[r.ShaderNames_AddMaskedPremultipliedAlpha=5]="ShaderNames_AddMaskedPremultipliedAlpha",r[r.ShaderNames_AddMaskedPremultipliedAlphaInverted=6]="ShaderNames_AddMaskedPremultipliedAlphaInverted",r[r.ShaderNames_MultPremultipliedAlpha=7]="ShaderNames_MultPremultipliedAlpha",r[r.ShaderNames_MultMaskedPremultipliedAlpha=8]="ShaderNames_MultMaskedPremultipliedAlpha",r[r.ShaderNames_MultMaskedPremultipliedAlphaInverted=9]="ShaderNames_MultMaskedPremultipliedAlphaInverted",r))(Rr||{});const ao="attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;varying vec4       v_myPos;uniform mat4       u_clipMatrix;void main(){   gl_Position = u_clipMatrix * a_position;   v_myPos = u_clipMatrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}",no="precision mediump float;varying vec2       v_texCoord;varying vec4       v_myPos;uniform vec4       u_baseColor;uniform vec4       u_channelFlag;uniform sampler2D  s_texture0;void main(){   float isInside =        step(u_baseColor.x, v_myPos.x/v_myPos.w)       * step(u_baseColor.y, v_myPos.y/v_myPos.w)       * step(v_myPos.x/v_myPos.w, u_baseColor.z)       * step(v_myPos.y/v_myPos.w, u_baseColor.w);   gl_FragColor = u_channelFlag * texture2D(s_texture0, v_texCoord).a * isInside;}",oo="attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;uniform mat4       u_matrix;void main(){   gl_Position = u_matrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}",As="attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;varying vec4       v_clipPos;uniform mat4       u_matrix;uniform mat4       u_clipMatrix;void main(){   gl_Position = u_matrix * a_position;   v_clipPos = u_clipMatrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}",lo="precision mediump float;varying vec2       v_texCoord;uniform vec4       u_baseColor;uniform sampler2D  s_texture0;uniform vec4       u_multiplyColor;uniform vec4       u_screenColor;void main(){   vec4 texColor = texture2D(s_texture0, v_texCoord);   texColor.rgb = texColor.rgb * u_multiplyColor.rgb;   texColor.rgb = (texColor.rgb + u_screenColor.rgb * texColor.a) - (texColor.rgb * u_screenColor.rgb);   vec4 color = texColor * u_baseColor;   gl_FragColor = vec4(color.rgb, color.a);}",uo="precision mediump float;varying vec2       v_texCoord;varying vec4       v_clipPos;uniform vec4       u_baseColor;uniform vec4       u_channelFlag;uniform sampler2D  s_texture0;uniform sampler2D  s_texture1;uniform vec4       u_multiplyColor;uniform vec4       u_screenColor;void main(){   vec4 texColor = texture2D(s_texture0, v_texCoord);   texColor.rgb = texColor.rgb * u_multiplyColor.rgb;   texColor.rgb = (texColor.rgb + u_screenColor.rgb * texColor.a) - (texColor.rgb * u_screenColor.rgb);   vec4 col_formask = texColor * u_baseColor;   vec4 clipMask = (1.0 - texture2D(s_texture1, v_clipPos.xy / v_clipPos.w)) * u_channelFlag;   float maskVal = clipMask.r + clipMask.g + clipMask.b + clipMask.a;   col_formask = col_formask * maskVal;   gl_FragColor = col_formask;}",ho="precision mediump float;varying vec2      v_texCoord;varying vec4      v_clipPos;uniform sampler2D s_texture0;uniform sampler2D s_texture1;uniform vec4      u_channelFlag;uniform vec4      u_baseColor;uniform vec4      u_multiplyColor;uniform vec4      u_screenColor;void main(){   vec4 texColor = texture2D(s_texture0, v_texCoord);   texColor.rgb = texColor.rgb * u_multiplyColor.rgb;   texColor.rgb = (texColor.rgb + u_screenColor.rgb * texColor.a) - (texColor.rgb * u_screenColor.rgb);   vec4 col_formask = texColor * u_baseColor;   vec4 clipMask = (1.0 - texture2D(s_texture1, v_clipPos.xy / v_clipPos.w)) * u_channelFlag;   float maskVal = clipMask.r + clipMask.g + clipMask.b + clipMask.a;   col_formask = col_formask * (1.0 - maskVal);   gl_FragColor = col_formask;}";var Ls;(r=>{r.CubismShaderSet=Fr,r.CubismShader_WebGL=xt,r.ShaderNames=Rr})(Ls||(Ls={}));let rt,Me;class Ze extends so{getMaskRenderTexture(){if(this._maskTexture&&this._maskTexture.textures!=null)this._maskTexture.frameNo=this._currentFrameNo;else{this._maskRenderTextures!=null&&this._maskRenderTextures.clear(),this._maskRenderTextures=new y,this._maskColorBuffers!=null&&this._maskColorBuffers.clear(),this._maskColorBuffers=new y;const t=this._clippingMaskBufferSize;for(let e=0;e<this._renderTextureCount;e++)this._maskColorBuffers.pushBack(this.gl.createTexture()),this.gl.bindTexture(this.gl.TEXTURE_2D,this._maskColorBuffers.at(e)),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,t,t,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.bindTexture(this.gl.TEXTURE_2D,null),this._maskRenderTextures.pushBack(this.gl.createFramebuffer()),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this._maskRenderTextures.at(e)),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,this._maskColorBuffers.at(e),0);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,Me),this._maskTexture=new Er(this._currentFrameNo,this._maskRenderTextures)}return this._maskTexture.textures}setGL(t){this.gl=t}constructor(){super(Ar)}setupClippingContext(t,e){this._currentFrameNo++;let i=0;for(let s=0;s<this._clippingContextListForMask.getSize();s++){const a=this._clippingContextListForMask.at(s);this.calcClippedDrawTotalBounds(t,a),a._isUsing&&i++}if(i>0){this.gl.viewport(0,0,this._clippingMaskBufferSize,this._clippingMaskBufferSize),this._currentMaskRenderTexture=this.getMaskRenderTexture().at(0),e.preDraw(),this.setupLayoutBounds(i),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this._currentMaskRenderTexture),this._clearedFrameBufferFlags.getSize()!=this._renderTextureCount&&(this._clearedFrameBufferFlags.clear(),this._clearedFrameBufferFlags=new y(this._renderTextureCount));for(let s=0;s<this._clearedFrameBufferFlags.getSize();s++)this._clearedFrameBufferFlags.set(s,!1);for(let s=0;s<this._clippingContextListForMask.getSize();s++){const a=this._clippingContextListForMask.at(s),o=a._allClippedDrawRect,n=a._layoutBounds,l=.05;let u=0,h=0;const g=this.getMaskRenderTexture().at(a._bufferIndex);this._currentMaskRenderTexture!=g&&(this._currentMaskRenderTexture=g,e.preDraw(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this._currentMaskRenderTexture)),this._tmpBoundsOnModel.setRect(o),this._tmpBoundsOnModel.expand(o.width*l,o.height*l),u=n.width/this._tmpBoundsOnModel.width,h=n.height/this._tmpBoundsOnModel.height,this._tmpMatrix.loadIdentity(),this._tmpMatrix.translateRelative(-1,-1),this._tmpMatrix.scaleRelative(2,2),this._tmpMatrix.translateRelative(n.x,n.y),this._tmpMatrix.scaleRelative(u,h),this._tmpMatrix.translateRelative(-this._tmpBoundsOnModel.x,-this._tmpBoundsOnModel.y),this._tmpMatrixForMask.setMatrix(this._tmpMatrix.getArray()),this._tmpMatrix.loadIdentity(),this._tmpMatrix.translateRelative(n.x,n.y),this._tmpMatrix.scaleRelative(u,h),this._tmpMatrix.translateRelative(-this._tmpBoundsOnModel.x,-this._tmpBoundsOnModel.y),this._tmpMatrixForDraw.setMatrix(this._tmpMatrix.getArray()),a._matrixForMask.setMatrix(this._tmpMatrixForMask.getArray()),a._matrixForDraw.setMatrix(this._tmpMatrixForDraw.getArray());const p=a._clippingIdCount;for(let d=0;d<p;d++){const c=a._clippingIdList[d];t.getDrawableDynamicFlagVertexPositionsDidChange(c)&&(e.setIsCulling(t.getDrawableCulling(c)!=!1),this._clearedFrameBufferFlags.at(a._bufferIndex)||(this.gl.clearColor(1,1,1,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this._clearedFrameBufferFlags.set(a._bufferIndex,!0)),e.setClippingContextBufferForMask(a),e.drawMeshWebGL(t,c))}}this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,Me),e.setClippingContextBufferForMask(null),this.gl.viewport(rt[0],rt[1],rt[2],rt[3])}}getColorBuffer(){return this._maskColorBuffers}getClippingMaskCount(){return this._clippingContextListForMask.getSize()}}class Er{constructor(t,e){this.frameNo=t,this.textures=e}}class Ar extends Ur{constructor(t,e,i){super(e,i),this._owner=t}getClippingManager(){return this._owner}setGl(t){this._owner.setGL(t)}}class go{setGlEnable(t,e){e?this.gl.enable(t):this.gl.disable(t)}setGlEnableVertexAttribArray(t,e){e?this.gl.enableVertexAttribArray(t):this.gl.disableVertexAttribArray(t)}save(){if(this.gl==null){P(`'gl' is null. WebGLRenderingContext is required.
Please call 'CubimRenderer_WebGL.startUp' function.`);return}this._lastArrayBufferBinding=this.gl.getParameter(this.gl.ARRAY_BUFFER_BINDING),this._lastElementArrayBufferBinding=this.gl.getParameter(this.gl.ELEMENT_ARRAY_BUFFER_BINDING),this._lastProgram=this.gl.getParameter(this.gl.CURRENT_PROGRAM),this._lastActiveTexture=this.gl.getParameter(this.gl.ACTIVE_TEXTURE),this.gl.activeTexture(this.gl.TEXTURE1),this._lastTexture1Binding2D=this.gl.getParameter(this.gl.TEXTURE_BINDING_2D),this.gl.activeTexture(this.gl.TEXTURE0),this._lastTexture0Binding2D=this.gl.getParameter(this.gl.TEXTURE_BINDING_2D),this._lastVertexAttribArrayEnabled[0]=this.gl.getVertexAttrib(0,this.gl.VERTEX_ATTRIB_ARRAY_ENABLED),this._lastVertexAttribArrayEnabled[1]=this.gl.getVertexAttrib(1,this.gl.VERTEX_ATTRIB_ARRAY_ENABLED),this._lastVertexAttribArrayEnabled[2]=this.gl.getVertexAttrib(2,this.gl.VERTEX_ATTRIB_ARRAY_ENABLED),this._lastVertexAttribArrayEnabled[3]=this.gl.getVertexAttrib(3,this.gl.VERTEX_ATTRIB_ARRAY_ENABLED),this._lastScissorTest=this.gl.isEnabled(this.gl.SCISSOR_TEST),this._lastStencilTest=this.gl.isEnabled(this.gl.STENCIL_TEST),this._lastDepthTest=this.gl.isEnabled(this.gl.DEPTH_TEST),this._lastCullFace=this.gl.isEnabled(this.gl.CULL_FACE),this._lastBlend=this.gl.isEnabled(this.gl.BLEND),this._lastFrontFace=this.gl.getParameter(this.gl.FRONT_FACE),this._lastColorMask=this.gl.getParameter(this.gl.COLOR_WRITEMASK),this._lastBlending[0]=this.gl.getParameter(this.gl.BLEND_SRC_RGB),this._lastBlending[1]=this.gl.getParameter(this.gl.BLEND_DST_RGB),this._lastBlending[2]=this.gl.getParameter(this.gl.BLEND_SRC_ALPHA),this._lastBlending[3]=this.gl.getParameter(this.gl.BLEND_DST_ALPHA),this._lastFBO=this.gl.getParameter(this.gl.FRAMEBUFFER_BINDING),this._lastViewport=this.gl.getParameter(this.gl.VIEWPORT)}restore(){if(this.gl==null){P(`'gl' is null. WebGLRenderingContext is required.
Please call 'CubimRenderer_WebGL.startUp' function.`);return}this.gl.useProgram(this._lastProgram),this.setGlEnableVertexAttribArray(0,this._lastVertexAttribArrayEnabled[0]),this.setGlEnableVertexAttribArray(1,this._lastVertexAttribArrayEnabled[1]),this.setGlEnableVertexAttribArray(2,this._lastVertexAttribArrayEnabled[2]),this.setGlEnableVertexAttribArray(3,this._lastVertexAttribArrayEnabled[3]),this.setGlEnable(this.gl.SCISSOR_TEST,this._lastScissorTest),this.setGlEnable(this.gl.STENCIL_TEST,this._lastStencilTest),this.setGlEnable(this.gl.DEPTH_TEST,this._lastDepthTest),this.setGlEnable(this.gl.CULL_FACE,this._lastCullFace),this.setGlEnable(this.gl.BLEND,this._lastBlend),this.gl.frontFace(this._lastFrontFace),this.gl.colorMask(this._lastColorMask[0],this._lastColorMask[1],this._lastColorMask[2],this._lastColorMask[3]),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this._lastArrayBufferBinding),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this._lastElementArrayBufferBinding),this.gl.activeTexture(this.gl.TEXTURE1),this.gl.bindTexture(this.gl.TEXTURE_2D,this._lastTexture1Binding2D),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this._lastTexture0Binding2D),this.gl.activeTexture(this._lastActiveTexture),this.gl.blendFuncSeparate(this._lastBlending[0],this._lastBlending[1],this._lastBlending[2],this._lastBlending[3])}setGl(t){this.gl=t}constructor(){this._lastVertexAttribArrayEnabled=new Array(4),this._lastColorMask=new Array(4),this._lastBlending=new Array(4),this._lastViewport=new Array(4)}}class li extends ve{initialize(t,e=1){t.isUsingMasking()&&(this._clippingManager=new Ze,this._clippingManager.initialize(t,e)),this._sortedDrawableIndexList.resize(t.getDrawableCount(),0),super.initialize(t)}bindTexture(t,e){this._textures.setValue(t,e)}getBindedTextures(){return this._textures}setClippingMaskBufferSize(t){if(!this._model.isUsingMasking())return;const e=this._clippingManager.getRenderTextureCount();this._clippingManager.release(),this._clippingManager=void 0,this._clippingManager=null,this._clippingManager=new Ze,this._clippingManager.setClippingMaskBufferSize(t),this._clippingManager.initialize(this.getModel(),e)}getClippingMaskBufferSize(){return this._model.isUsingMasking()?this._clippingManager.getClippingMaskBufferSize():-1}getRenderTextureCount(){return this._model.isUsingMasking()?this._clippingManager.getRenderTextureCount():-1}constructor(){super(),this._clippingContextBufferForMask=null,this._clippingContextBufferForDraw=null,this._rendererProfile=new go,this.firstDraw=!0,this._textures=new H,this._sortedDrawableIndexList=new y,this._bufferData={vertex:WebGLBuffer=null,uv:WebGLBuffer=null,index:WebGLBuffer=null},this._textures.prepareCapacity(32,!0)}release(){this._clippingManager&&(this._clippingManager.release(),this._clippingManager=void 0,this._clippingManager=null),this.gl!=null&&(this.gl.deleteBuffer(this._bufferData.vertex),this._bufferData.vertex=null,this.gl.deleteBuffer(this._bufferData.uv),this._bufferData.uv=null,this.gl.deleteBuffer(this._bufferData.index),this._bufferData.index=null,this._bufferData=null,this._textures=null)}doDrawModel(){if(this.gl==null){P(`'gl' is null. WebGLRenderingContext is required.
Please call 'CubimRenderer_WebGL.startUp' function.`);return}this._clippingManager!=null&&(this.preDraw(),this.isUsingHighPrecisionMask()?this._clippingManager.setupMatrixForHighPrecision(this.getModel(),!1):this._clippingManager.setupClippingContext(this.getModel(),this)),this.preDraw();const t=this.getModel().getDrawableCount(),e=this.getModel().getDrawableRenderOrders();for(let i=0;i<t;++i){const s=e[i];this._sortedDrawableIndexList.set(s,i)}for(let i=0;i<t;++i){const s=this._sortedDrawableIndexList.at(i);if(!this.getModel().getDrawableDynamicFlagIsVisible(s))continue;const a=this._clippingManager!=null?this._clippingManager.getClippingContextListForDraw().at(s):null;if(a!=null&&this.isUsingHighPrecisionMask()){a._isUsing&&(this.gl.viewport(0,0,this._clippingManager.getClippingMaskBufferSize(),this._clippingManager.getClippingMaskBufferSize()),this.preDraw(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,a.getClippingManager().getMaskRenderTexture().at(a._bufferIndex)),this.gl.clearColor(1,1,1,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT));{const o=a._clippingIdCount;for(let n=0;n<o;n++){const l=a._clippingIdList[n];this._model.getDrawableDynamicFlagVertexPositionsDidChange(l)&&(this.setIsCulling(this._model.getDrawableCulling(l)!=!1),this.setClippingContextBufferForMask(a),this.drawMeshWebGL(this._model,l))}}this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,Me),this.setClippingContextBufferForMask(null),this.gl.viewport(rt[0],rt[1],rt[2],rt[3]),this.preDraw()}this.setClippingContextBufferForDraw(a),this.setIsCulling(this.getModel().getDrawableCulling(s)),this.drawMeshWebGL(this._model,s)}}drawMeshWebGL(t,e){this.isCulling()?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this.gl.frontFace(this.gl.CCW),this.isGeneratingMask()?xt.getInstance().setupShaderProgramForMask(this,t,e):xt.getInstance().setupShaderProgramForDraw(this,t,e);{const i=t.getDrawableVertexIndexCount(e);this.gl.drawElements(this.gl.TRIANGLES,i,this.gl.UNSIGNED_SHORT,0)}this.gl.useProgram(null),this.setClippingContextBufferForDraw(null),this.setClippingContextBufferForMask(null)}saveProfile(){this._rendererProfile.save()}restoreProfile(){this._rendererProfile.restore()}static doStaticRelease(){xt.deleteInstance()}setRenderState(t,e){Me=t,rt=e}preDraw(){if(this.firstDraw&&(this.firstDraw=!1),this.gl.disable(this.gl.SCISSOR_TEST),this.gl.disable(this.gl.STENCIL_TEST),this.gl.disable(this.gl.DEPTH_TEST),this.gl.frontFace(this.gl.CW),this.gl.enable(this.gl.BLEND),this.gl.colorMask(!0,!0,!0,!0),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,null),this.getAnisotropy()>0&&this._extension)for(let t=0;t<this._textures.getSize();++t)this.gl.bindTexture(this.gl.TEXTURE_2D,this._textures.getValue(t)),this.gl.texParameterf(this.gl.TEXTURE_2D,this._extension.TEXTURE_MAX_ANISOTROPY_EXT,this.getAnisotropy())}setClippingContextBufferForMask(t){this._clippingContextBufferForMask=t}getClippingContextBufferForMask(){return this._clippingContextBufferForMask}setClippingContextBufferForDraw(t){this._clippingContextBufferForDraw=t}getClippingContextBufferForDraw(){return this._clippingContextBufferForDraw}isGeneratingMask(){return this.getClippingContextBufferForMask()!=null}startUp(t){this.gl=t,this._clippingManager&&this._clippingManager.setGL(t),xt.getInstance().setGl(t),this._rendererProfile.setGl(t),this._extension=this.gl.getExtension("EXT_texture_filter_anisotropic")||this.gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this.gl.getExtension("MOZ_EXT_texture_filter_anisotropic")}}ve.staticRelease=()=>{li.doStaticRelease()};var Ds;(r=>{r.CubismClippingContext=Ar,r.CubismClippingManager_WebGL=Ze,r.CubismRenderTextureResource=Er,r.CubismRenderer_WebGL=li})(Ds||(Ds={}));const ks="Meta",co="UserDataCount",_o="TotalUserDataSize",ze="UserData",mo="Target",po="Id",fo="Value";class Lr{constructor(t,e){this._json=N.create(t,e)}release(){N.delete(this._json)}getUserDataCount(){return this._json.getRoot().getValueByString(ks).getValueByString(co).toInt()}getTotalUserDataSize(){return this._json.getRoot().getValueByString(ks).getValueByString(_o).toInt()}getUserDataTargetType(t){return this._json.getRoot().getValueByString(ze).getValueByIndex(t).getValueByString(mo).getRawString()}getUserDataId(t){return w.getIdManager().getId(this._json.getRoot().getValueByString(ze).getValueByIndex(t).getValueByString(po).getRawString())}getUserDataValue(t){return this._json.getRoot().getValueByString(ze).getValueByIndex(t).getValueByString(fo).getRawString()}}var Os;(r=>{r.CubismModelUserDataJson=Lr})(Os||(Os={}));const yo="ArtMesh";class Dr{}class re{static create(t,e){const i=new re;return i.parseUserData(t,e),i}static delete(t){t!=null&&(t.release(),t=null)}getArtMeshUserDatas(){return this._artMeshUserDataNode}parseUserData(t,e){let i=new Lr(t,e);if(!i){i.release(),i=void 0;return}const s=w.getIdManager().getId(yo),a=i.getUserDataCount();for(let o=0;o<a;o++){const n=new Dr;n.targetId=i.getUserDataId(o),n.targetType=w.getIdManager().getId(i.getUserDataTargetType(o)),n.value=new A(i.getUserDataValue(o)),this._userDataNodes.pushBack(n),n.targetType==s&&this._artMeshUserDataNode.pushBack(n)}i.release(),i=void 0}constructor(){this._userDataNodes=new y,this._artMeshUserDataNode=new y}release(){for(let t=0;t<this._userDataNodes.getSize();++t)this._userDataNodes.set(t,null);this._userDataNodes=null}}var Ns;(r=>{r.CubismModelUserData=re,r.CubismModelUserDataNode=Dr})(Ns||(Ns={}));class Ve{isInitialized(){return this._initialized}setInitialized(t){this._initialized=t}isUpdating(){return this._updating}setUpdating(t){this._updating=t}setDragging(t,e){this._dragManager.set(t,e)}setAcceleration(t,e,i){this._accelerationX=t,this._accelerationY=e,this._accelerationZ=i}getModelMatrix(){return this._modelMatrix}setOpacity(t){this._opacity=t}getOpacity(){return this._opacity}loadModel(t,e=!1){if(this._moc=ae.create(t,e),this._moc==null){P("Failed to CubismMoc.create().");return}if(this._model=this._moc.createModel(),this._model==null){P("Failed to CreateModel().");return}this._model.saveParameters(),this._modelMatrix=new hr(this._model.getCanvasWidth(),this._model.getCanvasHeight())}loadMotion(t,e,i,s){return t==null||e==0?(P("Failed to loadMotion()."),null):Pe.create(t,e,s)}loadExpression(t,e,i){return t==null||e==0?(P("Failed to loadExpression()."),null):gt.create(t,e)}loadPose(t,e){if(t==null||e==0){P("Failed to loadPose().");return}this._pose=ee.create(t,e)}loadUserData(t,e){if(t==null||e==0){P("Failed to loadUserData().");return}this._modelUserData=re.create(t,e)}loadPhysics(t,e){if(t==null||e==0){P("Failed to loadPhysics().");return}this._physics=se.create(t,e)}isHit(t,e,i){const s=this._model.getDrawableIndex(t);if(s<0)return!1;const a=this._model.getDrawableVertexCount(s),o=this._model.getDrawableVertices(s);let n=o[0],l=o[0],u=o[1],h=o[1];for(let d=1;d<a;++d){const c=o[ht.vertexOffset+d*ht.vertexStep],f=o[ht.vertexOffset+d*ht.vertexStep+1];c<n&&(n=c),c>l&&(l=c),f<u&&(u=f),f>h&&(h=f)}const g=this._modelMatrix.invertTransformX(e),p=this._modelMatrix.invertTransformY(i);return n<=g&&g<=l&&u<=p&&p<=h}getModel(){return this._model}getRenderer(){return this._renderer}createRenderer(t=1){this._renderer&&this.deleteRenderer(),this._renderer=new li,this._renderer.initialize(this._model,t)}deleteRenderer(){this._renderer!=null&&(this._renderer.release(),this._renderer=null)}motionEventFired(t){F("{0}",t.s)}static cubismDefaultMotionEventCallback(t,e,i){const s=i;s!=null&&s.motionEventFired(e)}constructor(){this._moc=null,this._model=null,this._motionManager=null,this._expressionManager=null,this._eyeBlink=null,this._breath=null,this._modelMatrix=null,this._pose=null,this._dragManager=null,this._physics=null,this._modelUserData=null,this._initialized=!1,this._updating=!1,this._opacity=1,this._lipsync=!0,this._lastLipSyncValue=0,this._dragX=0,this._dragY=0,this._accelerationX=0,this._accelerationY=0,this._accelerationZ=0,this._mocConsistency=!1,this._debugMode=!1,this._renderer=null,this._motionManager=new vr,this._motionManager.setEventCallback(Ve.cubismDefaultMotionEventCallback,this),this._expressionManager=new pr,this._dragManager=new gr}release(){this._motionManager!=null&&(this._motionManager.release(),this._motionManager=null),this._expressionManager!=null&&(this._expressionManager.release(),this._expressionManager=null),this._moc!=null&&(this._moc.deleteModel(this._model),this._moc.release(),this._moc=null),this._modelMatrix=null,ee.delete(this._pose),Ce.delete(this._eyeBlink),Be.delete(this._breath),this._dragManager=null,se.delete(this._physics),re.delete(this._modelUserData),this.deleteRenderer()}}var zs;(r=>{r.CubismUserModel=Ve})(zs||(zs={}));class kr{}var Us;(r=>{r.ICubismModelSetting=kr})(Us||(Us={}));const ot="FileReferences",So="Groups",Co="Layout",xo="HitAreas",Mo="Moc",vo="Textures",Bo="Physics",bo="Pose",Po="Expressions",Vo="Motions",js="UserData",lt="Name",Xs="File",Io="Id",de="Ids",Ys="Sound",Gs="FadeInTime",$s="FadeOutTime",Ue="LipSync",je="EyeBlink";class Or extends kr{constructor(t,e){super(),this._json=N.create(t,e),this.getJson()&&(this._jsonValue=new y,this._jsonValue.pushBack(this.getJson().getRoot().getValueByString(So)),this._jsonValue.pushBack(this.getJson().getRoot().getValueByString(ot).getValueByString(Mo)),this._jsonValue.pushBack(this.getJson().getRoot().getValueByString(ot).getValueByString(Vo)),this._jsonValue.pushBack(this.getJson().getRoot().getValueByString(ot).getValueByString(Po)),this._jsonValue.pushBack(this.getJson().getRoot().getValueByString(ot).getValueByString(vo)),this._jsonValue.pushBack(this.getJson().getRoot().getValueByString(ot).getValueByString(Bo)),this._jsonValue.pushBack(this.getJson().getRoot().getValueByString(ot).getValueByString(bo)),this._jsonValue.pushBack(this.getJson().getRoot().getValueByString(xo)))}release(){N.delete(this._json),this._jsonValue=null}getJson(){return this._json}getModelFileName(){return this.isExistModelFile()?this._jsonValue.at(1).getRawString():""}getTextureCount(){return this.isExistTextureFiles()?this._jsonValue.at(4).getSize():0}getTextureDirectory(){const e=this._jsonValue.at(4).getValueByIndex(0).getRawString().split("/"),i=e.length-1;let s="";for(let a=0;a<i;a++)s+=e[a],a<i-1&&(s+="/");return s}getTextureFileName(t){return this._jsonValue.at(4).getValueByIndex(t).getRawString()}getHitAreasCount(){return this.isExistHitAreas()?this._jsonValue.at(7).getSize():0}getHitAreaId(t){return w.getIdManager().getId(this._jsonValue.at(7).getValueByIndex(t).getValueByString(Io).getRawString())}getHitAreaName(t){return this._jsonValue.at(7).getValueByIndex(t).getValueByString(lt).getRawString()}getPhysicsFileName(){return this.isExistPhysicsFile()?this._jsonValue.at(5).getRawString():""}getPoseFileName(){return this.isExistPoseFile()?this._jsonValue.at(6).getRawString():""}getExpressionCount(){return this.isExistExpressionFile()?this._jsonValue.at(3).getSize():0}getExpressionName(t){return this._jsonValue.at(3).getValueByIndex(t).getValueByString(lt).getRawString()}getExpressionFileName(t){return this._jsonValue.at(3).getValueByIndex(t).getValueByString(Xs).getRawString()}getMotionGroupCount(){return this.isExistMotionGroups()?this._jsonValue.at(2).getKeys().getSize():0}getMotionGroupName(t){return this.isExistMotionGroups()?this._jsonValue.at(2).getKeys().at(t):null}getMotionCount(t){return this.isExistMotionGroupName(t)?this._jsonValue.at(2).getValueByString(t).getSize():0}getMotionFileName(t,e){return this.isExistMotionGroupName(t)?this._jsonValue.at(2).getValueByString(t).getValueByIndex(e).getValueByString(Xs).getRawString():""}getMotionSoundFileName(t,e){return this.isExistMotionSoundFile(t,e)?this._jsonValue.at(2).getValueByString(t).getValueByIndex(e).getValueByString(Ys).getRawString():""}getMotionFadeInTimeValue(t,e){return this.isExistMotionFadeIn(t,e)?this._jsonValue.at(2).getValueByString(t).getValueByIndex(e).getValueByString(Gs).toFloat():-1}getMotionFadeOutTimeValue(t,e){return this.isExistMotionFadeOut(t,e)?this._jsonValue.at(2).getValueByString(t).getValueByIndex(e).getValueByString($s).toFloat():-1}getUserDataFile(){return this.isExistUserDataFile()?this.getJson().getRoot().getValueByString(ot).getValueByString(js).getRawString():""}getLayoutMap(t){const e=this.getJson().getRoot().getValueByString(Co).getMap();if(e==null)return!1;let i=!1;for(const s=e.begin();s.notEqual(e.end());s.preIncrement())t.setValue(s.ptr().first,s.ptr().second.toFloat()),i=!0;return i}getEyeBlinkParameterCount(){if(!this.isExistEyeBlinkParameters())return 0;let t=0;for(let e=0;e<this._jsonValue.at(0).getSize();e++){const i=this._jsonValue.at(0).getValueByIndex(e);if(!(i.isNull()||i.isError())&&i.getValueByString(lt).getRawString()==je){t=i.getValueByString(de).getVector().getSize();break}}return t}getEyeBlinkParameterId(t){if(!this.isExistEyeBlinkParameters())return null;for(let e=0;e<this._jsonValue.at(0).getSize();e++){const i=this._jsonValue.at(0).getValueByIndex(e);if(!(i.isNull()||i.isError())&&i.getValueByString(lt).getRawString()==je)return w.getIdManager().getId(i.getValueByString(de).getValueByIndex(t).getRawString())}return null}getLipSyncParameterCount(){if(!this.isExistLipSyncParameters())return 0;let t=0;for(let e=0;e<this._jsonValue.at(0).getSize();e++){const i=this._jsonValue.at(0).getValueByIndex(e);if(!(i.isNull()||i.isError())&&i.getValueByString(lt).getRawString()==Ue){t=i.getValueByString(de).getVector().getSize();break}}return t}getLipSyncParameterId(t){if(!this.isExistLipSyncParameters())return null;for(let e=0;e<this._jsonValue.at(0).getSize();e++){const i=this._jsonValue.at(0).getValueByIndex(e);if(!(i.isNull()||i.isError())&&i.getValueByString(lt).getRawString()==Ue)return w.getIdManager().getId(i.getValueByString(de).getValueByIndex(t).getRawString())}return null}isExistModelFile(){const t=this._jsonValue.at(1);return!t.isNull()&&!t.isError()}isExistTextureFiles(){const t=this._jsonValue.at(4);return!t.isNull()&&!t.isError()}isExistHitAreas(){const t=this._jsonValue.at(7);return!t.isNull()&&!t.isError()}isExistPhysicsFile(){const t=this._jsonValue.at(5);return!t.isNull()&&!t.isError()}isExistPoseFile(){const t=this._jsonValue.at(6);return!t.isNull()&&!t.isError()}isExistExpressionFile(){const t=this._jsonValue.at(3);return!t.isNull()&&!t.isError()}isExistMotionGroups(){const t=this._jsonValue.at(2);return!t.isNull()&&!t.isError()}isExistMotionGroupName(t){const e=this._jsonValue.at(2).getValueByString(t);return!e.isNull()&&!e.isError()}isExistMotionSoundFile(t,e){const i=this._jsonValue.at(2).getValueByString(t).getValueByIndex(e).getValueByString(Ys);return!i.isNull()&&!i.isError()}isExistMotionFadeIn(t,e){const i=this._jsonValue.at(2).getValueByString(t).getValueByIndex(e).getValueByString(Gs);return!i.isNull()&&!i.isError()}isExistMotionFadeOut(t,e){const i=this._jsonValue.at(2).getValueByString(t).getValueByIndex(e).getValueByString($s);return!i.isNull()&&!i.isError()}isExistUserDataFile(){const t=this.getJson().getRoot().getValueByString(ot).getValueByString(js);return!t.isNull()&&!t.isError()}isExistEyeBlinkParameters(){if(this._jsonValue.at(0).isNull()||this._jsonValue.at(0).isError())return!1;for(let t=0;t<this._jsonValue.at(0).getSize();++t)if(this._jsonValue.at(0).getValueByIndex(t).getValueByString(lt).getRawString()==je)return!0;return!1}isExistLipSyncParameters(){if(this._jsonValue.at(0).isNull()||this._jsonValue.at(0).isError())return!1;for(let t=0;t<this._jsonValue.at(0).getSize();++t)if(this._jsonValue.at(0).getValueByIndex(t).getValueByString(lt).getRawString()==Ue)return!0;return!1}}var Hs;(r=>{r.CubismModelSettingJson=Or})(Hs||(Hs={}));const wo="FileReferences",To="MotionSync";class Nr extends Or{constructor(t,e){super(t,e),this._motionSyncFilePath=this.getJson().getRoot().getValueByString(wo).getValueByString(To).getRawString()}getMotionSyncFileName(){return this._motionSyncFilePath}getMotionSyncSoundFileList(){const t=new y;for(let e=0;e<this.getMotionGroupCount();e++){const i=this.getMotionGroupName(e);for(let s=0;s<this.getMotionCount(i);s++){const a=this.getMotionSoundFileName(i,s);!a||a.length<1||t.pushBack(new A(a))}}return t}}var Ws;(r=>{r.CubismModelMotionSyncSettingJson=Nr})(Ws||(Ws={}));let Xe=null,qs=!1;class Fo{constructor(t){this._buffer=new Float32Array(t),this._size=0,this._head=0}get size(){return this._size}addLast(t){this._buffer[this._head]=t,this._size=Math.min(this._size+1,this._buffer.length),this._head++,this._head>=this._buffer.length&&(this._head=0)}toVector(){const t=new y(this._size);let e=this._head-this._size;e<0&&(e+=this._buffer.length);for(let i=0;i<this._size;i++)t.pushBack(this._buffer[e]),e++,e>=this._buffer.length&&(e=0);return t}clear(){this._size=0,this._head=0}}class Wt{static getInstance(){return Xe==null&&(Xe=new Wt),Xe}async initialize(){const e=(await navigator.mediaDevices.enumerateDevices()).filter((u,h,g)=>u.kind==="audioinput");if(e.length==0)return P("No audio input devices found."),!1;const i={audio:{deviceId:e[0].deviceId}},a=(await navigator.mediaDevices.getUserMedia(i)).getAudioTracks();if(a.length==0)return!1;const o=a[0].getSettings().sampleRate,n=30,l=2;return this._buffer=new Fo(Math.trunc(o/n*l)),this._context=new AudioContext({sampleRate:o}),this._source=this._context.createMediaStreamSource(new MediaStream([a[0]])),!0}async connect(){if(qs)return;await this._context.audioWorklet.addModule("./src/lappaudioworkletprocessor.js");const t=new AudioWorkletNode(this._context,"lappaudioworkletprocessor");this._source.connect(t),t.connect(this._context.destination),t.port.onmessage=this.onMessage.bind(this),qs=!0}pop(){const t=this._buffer.toVector();return this._buffer.clear(),t}onMessage(t){const e=t.data;if(e.eventType==="data"&&e.audioBuffer)for(let i=0;i<e.audioBuffer.length;i++)this._buffer.addLast(e.audioBuffer[i])}update(){throw new Error("Method not implemented.")}release(){throw new Error("Method not implemented.")}constructor(){}}class Ro extends Ve{loadAssets(t,e){this._modelHomeDir=t,fetch(`${this._modelHomeDir}${e}`).then(i=>i.arrayBuffer()).then(i=>{const s=new Nr(i,i.byteLength);this._state=1,this.setupModel(s)}).catch(i=>{P(`Failed to load file ${this._modelHomeDir}${e}`)})}setupModel(t){if(this._updating=!0,this._initialized=!1,this._modelSetting=t,this._modelSetting.getModelFileName()!=""){const s=this._modelSetting.getModelFileName();fetch(`${this._modelHomeDir}${s}`).then(a=>{if(a.ok)return a.arrayBuffer();if(a.status>=400)return P(`Failed to load file ${this._modelHomeDir}${s}`),new ArrayBuffer(0)}).then(a=>{this.loadModel(a,this._mocConsistency),this._state=15,e()}),this._state=2}else k.printMessage("Model data does not exist.");const e=()=>{const s=new H;if(this._modelSetting==null||this._modelMatrix==null){P("Failed to setupLayout().");return}this._modelSetting.getLayoutMap(s),this._modelMatrix.setupFromLayout(s),this._state=16,i()},i=()=>{if(this._modelSetting.getMotionSyncFileName()!=""){const s=this._modelSetting.getMotionSyncFileName();if(!s||s=="NullValue"){P("Failed to setupMotionSync().");return}fetch(`${this._modelHomeDir}${s}`).then(a=>{if(a.ok)return a.arrayBuffer();if(a.status>=400)return P(`Failed to load file ${this._modelHomeDir}${s}`),new ArrayBuffer(0)}).then(a=>{this.loadMotionSync(a,a.byteLength)}).then(()=>{Wt.getInstance().initialize().then(()=>{Wt.getInstance().connect().then(()=>{this._state=21,this._updating=!1,this._initialized=!0,this.createRenderer(),this.setupTextures(),this.getRenderer().startUp(_)})})})}}}loadMotionSync(t,e){if(t==null||e==0){P("Failed to loadMotionSync().");return}this._motionSync=z.create(this._model,t,e,za)}setupTextures(){if(this._state==21){const e=this._modelSetting.getTextureCount();for(let i=0;i<e;i++){if(this._modelSetting.getTextureFileName(i)==""){console.log("getTextureFileName null");continue}let s=this._modelSetting.getTextureFileName(i);s=this._modelHomeDir+s;const a=o=>{this.getRenderer().bindTexture(i,o.id),this._textureCount++,this._textureCount>=e&&(this._state=23)};I.getInstance().getTextureManager().createTextureFromPngFile(s,!0,a),this.getRenderer().setIsPremultipliedAlpha(!0)}this._state=22}}reloadRenderer(){this.deleteRenderer(),this.createRenderer(),this.setupTextures()}pushFromArray(t,e){t._size>=t._capacity&&t.prepareCapacity(t._capacity==0?y.DefaultSize:t._capacity+e.length),t._ptr.push(...Array.from(e))}updateMotionSync(){const t=performance.now()/1e3,e=Wt.getInstance().pop();this._motionSync.setSoundBuffer(0,e,0),this._motionSync.updateParameters(this._model,t)}update(){if(this._state!=23)return;const t=k.getDeltaTime();this._userTimeSeconds+=t,this._physics!=null&&this._physics.evaluate(this._model,t),this._pose!=null&&this._pose.updateParameters(this._model,t),this.updateMotionSync(),this._model.update()}motionEventFired(t){F("{0} is fired on LAppModel!!",t.s)}hitTest(t,e,i){if(this._opacity<1)return!1;const s=this._modelSetting.getHitAreasCount();for(let a=0;a<s;a++)if(this._modelSetting.getHitAreaName(a)==t){const o=this._modelSetting.getHitAreaId(a);return this.isHit(o,e,i)}return!1}doDraw(){if(this._model==null)return;const t=[0,0,E.width,E.height];this.getRenderer().setRenderState(Qe,t),this.getRenderer().drawModel()}draw(t){this._model!=null&&this._state==23&&(t.multiplyByMatrix(this._modelMatrix),this.getRenderer().setMvpMatrix(t),this.doDraw())}async hasMocConsistencyFromFile(){if(G(this._modelSetting.getModelFileName().localeCompare("")),this._modelSetting.getModelFileName()!=""){const t=this._modelSetting.getModelFileName(),i=await(await fetch(`${this._modelHomeDir}${t}`)).arrayBuffer();return this._consistency=ae.hasMocConsistency(i),this._consistency?F("Consistent MOC3."):F("Inconsistent MOC3."),this._consistency}else k.printMessage("Model data does not exist.")}constructor(){super(),this._modelSetting=null,this._modelHomeDir=null,this._userTimeSeconds=0,this._hitArea=new y,this._userArea=new y,this._mocConsistency=!0,this._state=0,this._expressionCount=0,this._textureCount=0,this._motionCount=0,this._allMotionCount=0,this._consistency=!1,this._lastSampleCount=0}release(){super.release(),this._motionSync&&(this._motionSync.release(),this._motionSync=null)}}let At=null;class jt{static getInstance(){return At==null&&(At=new jt),At}static releaseInstance(){At!=null&&(At=void 0),At=null}getModel(t){return t<this._models.getSize()?this._models.at(t):null}releaseAllModel(){for(let t=0;t<this._models.getSize();t++)this._models.at(t).release(),this._models.set(t,null);this._models.clear()}onTap(t,e){k.printMessage(`[APP]tap point: {x: ${t.toFixed(2)} y: ${e.toFixed(2)}}`)}onUpdate(){const{width:t,height:e}=E;let i=1;navigator.userAgent.includes("Mobile")&&(i=.5);const s=this._models.getSize();for(let a=0;a<s;++a){const o=new L,n=this.getModel(a);n.getModel()&&(n.getModel().getCanvasWidth()>1&&t<e?(n.getModelMatrix().setWidth(2),o.scale(i,t/e*i)):o.scale(e/t*i,i),this._viewMatrix!=null&&o.multiplyByMatrix(this._viewMatrix)),n.update(),n.draw(o)}}changeNextIndexSound(){const t=this._models.at(0);t.isSuspendedCurrentSoundContext()||(t.stopCurrentSound(),t._soundIndex=(t._soundIndex+1)%t._soundFileList.getSize()),t.playCurrentSound()}nextScene(){const t=(this._sceneIndex+1)%Na;this.changeScene(t)}changeScene(t){this._sceneIndex=t,k.printMessage(`[APP]model index: ${this._sceneIndex}`);const e=qe[t],i=Oa+e+"/";let s=qe[t];s+=".model3.json",this.releaseAllModel(),this._models.pushBack(new Ro),this._models.at(0).loadAssets(i,s)}setViewMatrix(t){for(let e=0;e<16;e++)this._viewMatrix.getArray()[e]=t.getArray()[e]}constructor(){this._viewMatrix=new L,this._models=new y,this._sceneIndex=0,this.changeScene(this._sceneIndex)}}class Eo{constructor(){this._programId=null,this._back=null,this._gear=null,this._fastForward=null,this._touchManager=new ka,this._deviceToScreen=new L,this._viewMatrix=new or}initialize(){const{width:t,height:e}=E,i=t/e,s=-i,a=i,o=Wr,n=qr;if(this._viewMatrix.setScreenRect(s,a,o,n),this._viewMatrix.scale(Ci,Ci),this._deviceToScreen.loadIdentity(),t>e){const l=Math.abs(a-s);this._deviceToScreen.scaleRelative(l/t,-l/t)}else{const l=Math.abs(n-o);this._deviceToScreen.scaleRelative(l/e,-l/e)}this._deviceToScreen.translateRelative(-t*.5,-e*.5),this._viewMatrix.setMaxScale($r),this._viewMatrix.setMinScale(Hr),this._viewMatrix.setMaxScreenRect(Jr,Kr,Zr,Qr)}release(){this._viewMatrix=null,this._touchManager=null,this._deviceToScreen=null,this._fastForward.release(),this._fastForward=null,this._gear.release(),this._gear=null,this._back.release(),this._back=null,_.deleteProgram(this._programId),this._programId=null}render(){_.useProgram(this._programId),this._back&&this._back.render(this._programId),this._gear&&this._gear.render(this._programId),this._fastForward&&this._fastForward.render(this._programId),_.flush();const t=jt.getInstance();t.setViewMatrix(this._viewMatrix),t.onUpdate()}initializeSprite(){const t=E.width,e=E.height,i=I.getInstance().getTextureManager(),s=ta;let a="";a=ea;const o=l=>{const u=t*.5,h=e*.5,g=l.width*2,p=e*.95;this._back=new Gi(u,h,g,p,l.id)};i.createTextureFromPngFile(s+a,!1,o),a=ia;const n=l=>{const u=t-l.width*.5,h=e-l.height*.5,g=l.width,p=l.height;this._gear=new Gi(u,h,g,p,l.id)};i.createTextureFromPngFile(s+a,!1,n),this._programId==null&&(this._programId=I.getInstance().createShader())}onTouchesBegan(t,e){this._touchManager.touchesBegan(t*window.devicePixelRatio,e*window.devicePixelRatio)}onTouchesMoved(t,e){this.transformViewX(this._touchManager.getX()),this.transformViewY(this._touchManager.getY()),this._touchManager.touchesMoved(t*window.devicePixelRatio,e*window.devicePixelRatio)}onTouchesEnded(t,e){const i=jt.getInstance();{const s=this._deviceToScreen.transformX(this._touchManager.getX()),a=this._deviceToScreen.transformY(this._touchManager.getY());i.onTap(s,a),this._gear.isHit(t*window.devicePixelRatio,e*window.devicePixelRatio)&&i.nextScene()}}transformViewX(t){const e=this._deviceToScreen.transformX(t);return this._viewMatrix.invertTransformX(e)}transformViewY(t){const e=this._deviceToScreen.transformY(t);return this._viewMatrix.invertTransformY(e)}transformScreenX(t){return this._deviceToScreen.transformX(t)}transformScreenY(t){return this._deviceToScreen.transformY(t)}}let St=null,Qe=null;class I{static getInstance(){return St==null&&(St=new I),St}static releaseInstance(){St!=null&&St.release(),St=null}initialize(){return document.body.appendChild(E),this._resizeCanvas(),Qe||(Qe=_.getParameter(_.FRAMEBUFFER_BINDING)),_.enable(_.BLEND),_.blendFunc(_.SRC_ALPHA,_.ONE_MINUS_SRC_ALPHA),"ontouchend"in E?(E.addEventListener("touchstart",ko,{passive:!0}),E.addEventListener("touchmove",Oo,{passive:!0}),E.addEventListener("touchend",No,{passive:!0}),E.addEventListener("touchcancel",zo,{passive:!0})):(E.addEventListener("mousedown",Ao,{passive:!0}),E.addEventListener("mousemove",Lo,{passive:!0}),E.addEventListener("mouseup",Do,{passive:!0})),this._view.initialize(),this.initializeCubism(),!0}onResize(){this._resizeCanvas(),this._view.initialize(),this._view.initializeSprite()}release(){this._textureManager.release(),this._textureManager=null,this._view.release(),this._view=null,jt.releaseInstance(),w.dispose(),z.dispose()}run(){const t=()=>{St!=null&&(k.updateTime(),_.clearColor(0,0,0,1),_.enable(_.DEPTH_TEST),_.depthFunc(_.LEQUAL),_.clear(_.COLOR_BUFFER_BIT|_.DEPTH_BUFFER_BIT),_.clearDepth(1),_.enable(_.BLEND),_.blendFunc(_.SRC_ALPHA,_.ONE_MINUS_SRC_ALPHA),this._view.render(),requestAnimationFrame(t))};t()}createShader(){const t=_.createShader(_.VERTEX_SHADER);if(t==null)return k.printMessage("failed to create vertexShader"),null;_.shaderSource(t,"precision mediump float;attribute vec3 position;attribute vec2 uv;varying vec2 vuv;void main(void){   gl_Position = vec4(position, 1.0);   vuv = uv;}"),_.compileShader(t);const i=_.createShader(_.FRAGMENT_SHADER);if(i==null)return k.printMessage("failed to create fragmentShader"),null;_.shaderSource(i,"precision mediump float;varying vec2 vuv;uniform sampler2D texture;void main(void){   gl_FragColor = texture2D(texture, vuv);}"),_.compileShader(i);const a=_.createProgram();return _.attachShader(a,t),_.attachShader(a,i),_.deleteShader(t),_.deleteShader(i),_.linkProgram(a),_.useProgram(a),a}getView(){return this._view}getTextureManager(){return this._textureManager}constructor(){this._captured=!1,this._mouseX=0,this._mouseY=0,this._isEnd=!1,this._cubismOption=new Gr,this._cubismMotionSyncOption=new Ea,this._view=new Eo,this._textureManager=new sa}initializeCubism(){this._cubismOption.logFunction=k.printMessage,this._cubismOption.loggingLevel=xi,w.startUp(this._cubismOption),this._cubismMotionSyncOption.logFunction=k.printMessage,this._cubismMotionSyncOption.loggingLevel=xi,z.startUp(this._cubismMotionSyncOption),w.initialize(),z.initialize(),jt.getInstance(),k.updateTime(),this._view.initializeSprite()}_resizeCanvas(){E.width=E.clientWidth*window.devicePixelRatio,E.height=E.clientHeight*window.devicePixelRatio,_.viewport(0,0,_.drawingBufferWidth,_.drawingBufferHeight)}}function Ao(r){if(!I.getInstance()._view){k.printMessage("view notfound");return}I.getInstance()._captured=!0;const t=r.pageX,e=r.pageY;I.getInstance()._view.onTouchesBegan(t,e)}function Lo(r){if(!I.getInstance()._captured)return;if(!I.getInstance()._view){k.printMessage("view notfound");return}const t=r.target.getBoundingClientRect(),e=r.clientX-t.left,i=r.clientY-t.top;I.getInstance()._view.onTouchesMoved(e,i)}function Do(r){if(I.getInstance()._captured=!1,!I.getInstance()._view){k.printMessage("view notfound");return}const t=r.target.getBoundingClientRect(),e=r.clientX-t.left,i=r.clientY-t.top;I.getInstance()._view.onTouchesEnded(e,i)}function ko(r){if(!I.getInstance()._view){k.printMessage("view notfound");return}I.getInstance()._captured=!0;const t=r.changedTouches[0].pageX,e=r.changedTouches[0].pageY;I.getInstance()._view.onTouchesBegan(t,e)}function Oo(r){if(!I.getInstance()._captured)return;if(!I.getInstance()._view){k.printMessage("view notfound");return}const t=r.target.getBoundingClientRect(),e=r.changedTouches[0].clientX-t.left,i=r.changedTouches[0].clientY-t.top;I.getInstance()._view.onTouchesMoved(e,i)}function No(r){if(I.getInstance()._captured=!1,!I.getInstance()._view){k.printMessage("view notfound");return}const t=r.target.getBoundingClientRect(),e=r.changedTouches[0].clientX-t.left,i=r.changedTouches[0].clientY-t.top;I.getInstance()._view.onTouchesEnded(e,i)}function zo(r){if(I.getInstance()._captured=!1,!I.getInstance()._view){k.printMessage("view notfound");return}const t=r.target.getBoundingClientRect(),e=r.changedTouches[0].clientX-t.left,i=r.changedTouches[0].clientY-t.top;I.getInstance()._view.onTouchesEnded(e,i)}window.addEventListener("load",()=>{if(!window.isSecureContext){alert("Not a secure context. Some features may not work."),document.body.innerHTML="`AudioWorklet` may not work with this connection.";return}!ii.getInstance()||!I.getInstance().initialize()||I.getInstance().run()},{passive:!0});window.addEventListener("beforeunload",()=>I.releaseInstance(),{passive:!0});window.addEventListener("resize",()=>{I.getInstance().onResize()},{passive:!0});
//# sourceMappingURL=index-BCtxF0Fc.js.map
